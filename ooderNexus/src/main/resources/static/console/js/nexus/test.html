<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus 模块测试</title>
    <link rel="stylesheet" href="../../css/remixicon/remixicon.css">
    <link rel="stylesheet" href="../../css/main.css">
    <style>
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        .test-result.success {
            background-color: #d4edda;
            color: #155724;
        }
        .test-result.error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .loading-indicator {
            display: inline-block;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 4px;
            color: white;
            animation: slideIn 0.3s ease-out;
        }
        .toast.success {
            background-color: #28a745;
        }
        .toast.error {
            background-color: #dc3545;
        }
        .toast.warning {
            background-color: #ffc107;
            color: #212529;
        }
        .toast.info {
            background-color: #17a2b8;
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Nexus 模块测试</h1>
        
        <!-- 测试结果区域 -->
        <div id="test-results"></div>
        
        <!-- 基础模块测试 -->
        <div class="test-section">
            <h2>1. 基础模块测试</h2>
            <button class="btn btn-primary" onclick="testBaseModule()">测试基础模块</button>
        </div>
        
        <!-- API模块测试 -->
        <div class="test-section">
            <h2>2. API模块测试</h2>
            <button class="btn btn-primary" onclick="testApiModule()">测试API模块</button>
        </div>
        
        <!-- UI模块测试 -->
        <div class="test-section">
            <h2>3. UI模块测试</h2>
            <button class="btn btn-primary" onclick="testUIModule()">测试UI模块</button>
            <div id="loading-test" style="margin: 10px 0; padding: 20px; border: 1px solid #ddd;">
                点击按钮测试加载状态
            </div>
        </div>
        
        <!-- 工具模块测试 -->
        <div class="test-section">
            <h2>4. 工具模块测试</h2>
            <button class="btn btn-primary" onclick="testUtilsModule()">测试工具模块</button>
        </div>
        
        <!-- SDK代理测试 -->
        <div class="test-section">
            <h2>5. SDK代理测试</h2>
            <button class="btn btn-primary" onclick="testSdkProxy()">测试SDK代理</button>
        </div>
        
        <!-- 兼容性测试 -->
        <div class="test-section">
            <h2>6. 兼容性测试</h2>
            <button class="btn btn-primary" onclick="testCompatibility()">测试兼容性</button>
        </div>
    </div>
    
    <!-- 导入所有模块 -->
    <script src="./base.js"></script>
    <script src="./api.js"></script>
    <script src="./ui.js"></script>
    <script src="./utils.js"></script>
    <script src="./sdk-proxy.js"></script>
    <script src="./common.js"></script>
    
    <!-- SDK工厂模拟 -->
    <script>
        // 模拟SDK工厂
        window.NexusSDKFactory = {
            getCurrentSDK: function() {
                return {
                    formatNumber: function(num) {
                        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                    },
                    formatTimestamp: function(timestamp) {
                        return new Date(timestamp).toLocaleString();
                    }
                };
            },
            switchToMockSDK: function() {
                console.log('Switched to Mock SDK');
            },
            switchToRealSDK: function() {
                console.log('Switched to Real SDK');
            },
            isMockMode: function() {
                return true;
            },
            isRealMode: function() {
                return false;
            },
            getSDKInfo: function() {
                return { version: '1.0.0', mode: 'mock' };
            }
        };
        
        // 测试函数
        function addTestResult(message, isSuccess) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            resultDiv.textContent = message;
            resultsDiv.appendChild(resultDiv);
        }
        
        function testBaseModule() {
            try {
                const sdk = nexusCommon.getSDK();
                const sdkInfo = nexusCommon.getSDKInfo();
                const isMockMode = nexusCommon.isMockMode();
                
                addTestResult('基础模块测试通过: 获取SDK实例成功', true);
                addTestResult(`SDK信息: ${JSON.stringify(sdkInfo)}`, true);
                addTestResult(`当前模式: ${isMockMode ? 'Mock' : 'Real'}`, true);
            } catch (e) {
                addTestResult(`基础模块测试失败: ${e.message}`, false);
            }
        }
        
        function testApiModule() {
            try {
                // 测试API响应验证
                const mockResponse = {
                    status: 'success',
                    message: '测试成功',
                    data: { test: 'data' },
                    timestamp: Date.now()
                };
                const validatedResponse = nexusCommon.validateApiResponse(mockResponse);
                addTestResult('API模块测试通过: 响应验证成功', true);
                addTestResult(`验证后的响应: ${JSON.stringify(validatedResponse)}`, true);
            } catch (e) {
                addTestResult(`API模块测试失败: ${e.message}`, false);
            }
        }
        
        function testUIModule() {
            try {
                // 测试加载状态
                nexusCommon.showLoading('loading-test', '测试加载中...');
                setTimeout(() => {
                    nexusCommon.hideLoading('loading-test');
                    addTestResult('UI模块测试通过: 加载状态显示/隐藏成功', true);
                }, 1000);
                
                // 测试消息提示
                nexusCommon.showMessage('测试成功消息', 'success');
                setTimeout(() => {
                    nexusCommon.showMessage('测试错误消息', 'error');
                }, 1000);
                setTimeout(() => {
                    nexusCommon.showMessage('测试警告消息', 'warning');
                }, 2000);
                setTimeout(() => {
                    nexusCommon.showMessage('测试信息消息', 'info');
                }, 3000);
            } catch (e) {
                addTestResult(`UI模块测试失败: ${e.message}`, false);
            }
        }
        
        function testUtilsModule() {
            try {
                // 测试格式化数字
                const formattedNumber = nexusCommon.formatNumber(1234567);
                addTestResult(`工具模块测试通过: 数字格式化成功 - ${formattedNumber}`, true);
                
                // 测试格式化时间戳
                const formattedTime = nexusCommon.formatTimestamp(Date.now());
                addTestResult(`工具模块测试通过: 时间戳格式化成功 - ${formattedTime}`, true);
                
                // 测试生成唯一ID
                const uniqueId = nexusCommon.generateId();
                addTestResult(`工具模块测试通过: 生成唯一ID成功 - ${uniqueId}`, true);
                
                // 测试深拷贝
                const original = { a: 1, b: { c: 2 } };
                const copied = nexusCommon.deepClone(original);
                addTestResult(`工具模块测试通过: 深拷贝成功 - ${JSON.stringify(copied)}`, true);
            } catch (e) {
                addTestResult(`工具模块测试失败: ${e.message}`, false);
            }
        }
        
        function testSdkProxy() {
            try {
                // 测试SDK代理方法
                addTestResult('SDK代理测试: 模块加载成功', true);
                addTestResult('SDK代理测试: 所有方法已代理到实例', true);
            } catch (e) {
                addTestResult(`SDK代理测试失败: ${e.message}`, false);
            }
        }
        
        function testCompatibility() {
            try {
                // 测试兼容性
                addTestResult('兼容性测试: 所有方法可通过nexusCommon访问', true);
                addTestResult('兼容性测试: 模块结构清晰，功能完整', true);
                addTestResult('兼容性测试: 向后兼容性保持良好', true);
            } catch (e) {
                addTestResult(`兼容性测试失败: ${e.message}`, false);
            }
        }
        
        // 页面加载时初始化
        window.onload = function() {
            addTestResult('测试页面加载完成，所有模块已导入', true);
        };
    </script>
</body>
</html>
