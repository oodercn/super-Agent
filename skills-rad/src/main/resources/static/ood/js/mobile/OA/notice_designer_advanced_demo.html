<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>通知公告高级设计器版本演示</title>
    <link rel="stylesheet" type="text/css" href="../../../css/ood.css"/>
    <link rel="stylesheet" type="text/css" href="../../../css/mobile/oa-mobile.css"/>
    <script type="text/javascript" src="../../../js/ood.js"></script>
    <script type="text/javascript" src="../OA/NoticeDesignerAdvanced.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--mobile-bg-primary);
        }
        
        .demo-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px 0;
            border-bottom: 1px solid var(--mobile-border-color);
        }
        
        .demo-header h1 {
            color: var(--mobile-text-primary);
            font-size: var(--mobile-font-lg);
            margin: 0;
        }
        
        .demo-description {
            color: var(--mobile-text-secondary);
            font-size: var(--mobile-font-sm);
            text-align: center;
            margin-top: 10px;
        }
        
        .implementation-details {
            background-color: var(--mobile-bg-secondary);
            border-radius: var(--mobile-border-radius);
            padding: 15px;
            margin: 20px 0;
            border: 1px solid var(--mobile-border-color);
        }
        
        .implementation-details h3 {
            margin-top: 0;
            color: var(--mobile-text-primary);
            font-size: var(--mobile-font-md);
        }
        
        .implementation-details ul {
            color: var(--mobile-text-secondary);
            font-size: var(--mobile-font-sm);
            padding-left: 20px;
        }
        
        .implementation-details li {
            margin-bottom: 8px;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .action-button {
            padding: 10px 15px;
            background-color: var(--mobile-primary);
            color: white;
            border: none;
            border-radius: var(--mobile-border-radius);
            cursor: pointer;
            font-size: var(--mobile-font-sm);
            transition: background-color 0.2s;
        }
        
        .action-button:hover {
            background-color: var(--mobile-primary-dark);
        }
        
        .action-button.secondary {
            background-color: var(--mobile-secondary);
        }
        
        .action-button.secondary:hover {
            background-color: var(--mobile-secondary-dark);
        }
        
        .selected-notice {
            background-color: var(--mobile-bg-secondary);
            border-radius: var(--mobile-border-radius);
            padding: 15px;
            margin: 20px 0;
            border: 1px solid var(--mobile-border-color);
        }
        
        .selected-notice h3 {
            margin-top: 0;
            color: var(--mobile-text-primary);
            font-size: var(--mobile-font-md);
        }
        
        .selected-notice p {
            margin: 5px 0;
            color: var(--mobile-text-secondary);
            font-size: var(--mobile-font-sm);
        }
        
        .api-config {
            background-color: var(--mobile-bg-secondary);
            border-radius: var(--mobile-border-radius);
            padding: 15px;
            margin: 20px 0;
            border: 1px solid var(--mobile-border-color);
        }
        
        .api-config h3 {
            margin-top: 0;
            color: var(--mobile-text-primary);
            font-size: var(--mobile-font-md);
        }
        
        .api-config input, .api-config select {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            border: 1px solid var(--mobile-border-color);
            border-radius: var(--mobile-border-radius);
            background-color: var(--mobile-bg-input);
            color: var(--mobile-text-primary);
            font-size: var(--mobile-font-sm);
        }
        
        .api-config button {
            width: 100%;
            padding: 10px;
            background-color: var(--mobile-primary);
            color: white;
            border: none;
            border-radius: var(--mobile-border-radius);
            cursor: pointer;
            font-size: var(--mobile-font-sm);
        }
        
        .api-config button:hover {
            background-color: var(--mobile-primary-dark);
        }
        
        .event-log {
            background-color: var(--mobile-bg-secondary);
            border-radius: var(--mobile-border-radius);
            padding: 15px;
            margin: 20px 0;
            border: 1px solid var(--mobile-border-color);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .event-log h3 {
            margin-top: 0;
            color: var(--mobile-text-primary);
            font-size: var(--mobile-font-md);
        }
        
        .log-entry {
            font-size: var(--mobile-font-xs);
            color: var(--mobile-text-secondary);
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--mobile-border-color);
        }
        
        .log-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>通知公告高级设计器版本</h1>
            <p class="demo-description">演示更详细的事件处理和动作函数调用</p>
        </div>
        
        <div class="implementation-details">
            <h3>实现特点</h3>
            <ul>
                <li>使用 KEY:VALUE 方式组合样式，符合设计器的虚拟DOM读取CSS要求</li>
                <li>使用 OOD APICall 组件完成数据源交互</li>
                <li>事件处理放在具体的组件中，而非全局events</li>
                <li>采用组件对象添加方式，而非直接添加模板</li>
                <li>遵循通用业务组件开发规范，支持数据关联和动作关联</li>
                <li>提供更详细的事件处理和动作函数调用示例</li>
            </ul>
        </div>
        
        <div class="action-buttons">
            <button class="action-button" onclick="addSampleNotice()">添加示例通知</button>
            <button class="action-button secondary" onclick="clearNotices()">清空通知</button>
            <button class="action-button" onclick="markAllAsRead()">全部标记为已读</button>
        </div>
        
        <div class="api-config">
            <h3>API数据源配置</h3>
            <input type="text" id="apiUrl" placeholder="API URL (例如: /api/notices)" value="/api/notices">
            <select id="apiMethod">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
            </select>
            <button onclick="loadFromAPI()">从API加载数据</button>
        </div>
        
        <div class="event-log">
            <h3>事件日志</h3>
            <div id="eventLog"></div>
        </div>
        
        <div id="noticeDesignerContainer"></div>
        
        <div class="selected-notice" id="selectedNoticePanel" style="display: none;">
            <h3>选中的通知</h3>
            <p>标题: <span id="selectedTitle"></span></p>
            <p>时间: <span id="selectedTime"></span></p>
            <p>摘要: <span id="selectedSummary"></span></p>
            <p>状态: <span id="selectedStatus"></span></p>
        </div>
    </div>

    <script>
        var noticeDesigner;
        var eventLog = [];
        
        // 添加日志条目
        function addLogEntry(message) {
            var timestamp = new Date().toLocaleTimeString();
            var logEntry = '[' + timestamp + '] ' + message;
            eventLog.unshift(logEntry);
            
            // 只保留最近的20条日志
            if (eventLog.length > 20) {
                eventLog = eventLog.slice(0, 20);
            }
            
            // 更新UI
            var logContainer = document.getElementById('eventLog');
            logContainer.innerHTML = '';
            eventLog.forEach(function(entry) {
                var div = document.createElement('div');
                div.className = 'log-entry';
                div.textContent = entry;
                logContainer.appendChild(div);
            });
        }
        
        ood.ready(function() {
            // 创建通知公告设计器组件
            noticeDesigner = ood.create("ood.Mobile.OA.NoticeDesignerAdvanced");
            noticeDesigner.setHost(null, "noticeDesigner");
            
            // 设置组件属性
            noticeDesigner.setWidth("100%");
            noticeDesigner.setHeight("auto");
            
            // 设置事件处理
            noticeDesigner.events.onNoticeClick = function(profile, index, notice) {
                addLogEntry("通知点击事件: " + notice.title);
                showSelectedNotice(notice);
            };
            
            noticeDesigner.events.onNoticeStatusChange = function(profile, index, notice, status) {
                addLogEntry("通知状态改变事件: " + notice.title + " -> " + status);
            };
            
            noticeDesigner.events.onDataLoad = function(profile, data) {
                addLogEntry("数据加载完成事件: 加载了 " + (data ? data.length : 0) + " 条通知");
            };
            
            noticeDesigner.events.onDataError = function(profile, error) {
                addLogEntry("数据加载错误事件: " + error);
            };
            
            // 设置动作关联，使用标准的 OOD 动作定义方式
            noticeDesigner.properties.actions = {
                onClick: {
                    actions: [
                        {
                            "desc": "执行onClick动作",
                            "type": "other",
                            "target": "msg",
                            "method": "alert",
                            "args": ["点击了通知"]
                        }
                    ]
                },
                onStatusChange: {
                    actions: [
                        {
                            "desc": "执行onStatusChange动作",
                            "type": "other",
                            "target": "msg",
                            "method": "alert",
                            "args": ["通知状态已改变"]
                        }
                    ]
                },
                onLoad: {
                    actions: [
                        {
                            "desc": "执行onLoad动作",
                            "type": "other",
                            "target": "msg",
                            "method": "alert",
                            "args": ["数据加载完成"]
                        }
                    ]
                },
                onError: {
                    actions: [
                        {
                            "desc": "执行onError动作",
                            "type": "other",
                            "target": "msg",
                            "method": "alert",
                            "args": ["数据加载出错"]
                        }
                    ]
                },
                onBatchRead: {
                    actions: [
                        {
                            "desc": "执行onBatchRead动作",
                            "type": "other",
                            "target": "msg",
                            "method": "alert",
                            "args": ["批量标记为已读完成"]
                        }
                    ]
                }
            };
            
            // 添加到页面
            document.getElementById("noticeDesignerContainer").appendChild(noticeDesigner.get(0));
            
            // 初始化一些示例数据
            var sampleNotices = [
                {
                    id: '1',
                    title: '关于五一假期安排的通知',
                    time: '2025-04-25',
                    summary: '根据国家规定，结合公司实际情况，现将2025年五一劳动节放假安排通知如下...',
                    important: true,
                    read: false,
                    disabled: false
                },
                {
                    id: '2',
                    title: '新员工入职培训安排',
                    time: '2025-04-20',
                    summary: '欢迎新员工加入公司，现将入职培训相关安排通知如下...',
                    important: false,
                    read: true,
                    disabled: false
                },
                {
                    id: '3',
                    title: '办公系统升级通知',
                    time: '2025-04-15',
                    summary: '为了提供更好的办公体验，系统将于本周末进行升级...',
                    important: false,
                    read: false,
                    disabled: false
                }
            ];
            
            noticeDesigner.functions.setNotices(sampleNotices);
            addLogEntry("初始化完成，加载了 " + sampleNotices.length + " 条示例通知");
        });
        
        function addSampleNotice() {
            if (noticeDesigner) {
                var newNotice = {
                    id: Date.now().toString(),
                    title: '新通知 - ' + new Date().toLocaleString(),
                    time: new Date().toISOString().split('T')[0],
                    summary: '这是一条新添加的通知示例...',
                    important: Math.random() > 0.5,
                    read: false,
                    disabled: false
                };
                
                noticeDesigner.functions.addNotice(newNotice);
                addLogEntry("添加新通知: " + newNotice.title);
            }
        }
        
        function clearNotices() {
            if (noticeDesigner) {
                noticeDesigner.functions.setNotices([]);
                addLogEntry("清空所有通知");
            }
        }
        
        function markAllAsRead() {
            if (noticeDesigner) {
                noticeDesigner.functions.markAllAsRead();
                addLogEntry("执行批量标记为已读");
            }
        }
        
        function showSelectedNotice(notice) {
            document.getElementById("selectedNoticePanel").style.display = "block";
            document.getElementById("selectedTitle").textContent = notice.title;
            document.getElementById("selectedTime").textContent = notice.time;
            document.getElementById("selectedSummary").textContent = notice.summary;
            document.getElementById("selectedStatus").textContent = notice.read ? "已读" : "未读";
        }
        
        function loadFromAPI() {
            if (noticeDesigner) {
                var url = document.getElementById("apiUrl").value;
                var method = document.getElementById("apiMethod").value;
                
                // 模拟API调用
                var mockData = [
                    {
                        id: 'api-1',
                        title: 'API加载的通知1',
                        time: '2025-04-30',
                        summary: '这是从API加载的通知数据示例1...',
                        important: true,
                        read: false,
                        disabled: false
                    },
                    {
                        id: 'api-2',
                        title: 'API加载的通知2',
                        time: '2025-04-29',
                        summary: '这是从API加载的通知数据示例2...',
                        important: false,
                        read: true,
                        disabled: false
                    }
                ];
                
                // 模拟异步请求
                setTimeout(function() {
                    noticeDesigner.functions.setNotices(mockData);
                    addLogEntry("从API加载数据完成");
                }, 1000);
            }
        }
    </script>
</body>
</html>