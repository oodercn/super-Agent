<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OA办公组件测试页面</title>
    <link rel="stylesheet" href="../../mobile.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .component-container {
            min-height: 200px;
        }
        
        .tab-container {
            display: flex;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            background: #f8f8f8;
        }
        
        .tab.active {
            background: #007AFF;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #0056cc;
        }
        
        .btn.secondary {
            background: #8E8E93;
        }
        
        .btn.secondary:hover {
            background: #6e6e73;
        }
        
        .btn.success {
            background: #4CD964;
        }
        
        .btn.success:hover {
            background: #2ac845;
        }
        
        .btn.danger {
            background: #FF3B30;
        }
        
        .btn.danger:hover {
            background: #ff0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #333; padding: 20px 0;">OA办公组件测试页面</h1>
        
        <div class="controls">
            <button class="btn" onclick="resizeComponents()">调整组件尺寸</button>
            <button class="btn secondary" onclick="toggleTheme()">切换主题</button>
            <button class="btn success" onclick="addTestData()">添加测试数据</button>
            <button class="btn danger" onclick="clearData()">清空数据</button>
        </div>
        
        <!-- 通知公告组件 -->
        <div class="section">
            <div class="section-title">通知公告组件</div>
            <div id="notice-container" class="component-container"></div>
        </div>
        
        <!-- 待办事项组件 -->
        <div class="section">
            <div class="section-title">待办事项组件</div>
            <div id="todo-container" class="component-container"></div>
        </div>
        
        <!-- 审批流程组件 -->
        <div class="section">
            <div class="section-title">审批流程组件</div>
            <div id="approval-container" class="component-container"></div>
        </div>
        
        <!-- 日程安排组件 -->
        <div class="section">
            <div class="section-title">日程安排组件</div>
            <div id="schedule-container" class="component-container"></div>
        </div>
        
        <!-- 通讯录组件 -->
        <div class="section">
            <div class="section-title">通讯录组件</div>
            <div id="contact-container" class="component-container" style="height: 300px;"></div>
        </div>
        
        <!-- 文件管理组件 -->
        <div class="section">
            <div class="section-title">文件管理组件</div>
            <div id="file-container" class="component-container" style="height: 400px;"></div>
        </div>
        
        <!-- 会议管理组件 -->
        <div class="section">
            <div class="section-title">会议管理组件</div>
            <div id="meeting-container" class="component-container" style="height: 400px;"></div>
        </div>
        
        <!-- 考勤打卡组件 -->
        <div class="section">
            <div class="section-title">考勤打卡组件</div>
            <div id="attendance-container" class="component-container" style="height: 500px;"></div>
        </div>
    </div>

    <!-- 引入依赖 -->
    <script src="../../../ood.js"></script>
    <script src="../../index.js"></script>
    
    <!-- 引入OA组件 -->
    <script src="./Notice.js"></script>
    <script src="./TodoList.js"></script>
    <script src="./ApprovalFlow.js"></script>
    <script src="./Schedule.js"></script>
    <script src="./ContactList.js"></script>
    <script src="./FileManager.js"></script>
    <script src="./MeetingManager.js"></script>
    <script src="./Attendance.js"></script>
    
    <script>
        // 全局变量存储组件实例
        var components = {};
        
        // 等待框架加载完成
        document.addEventListener('ood-ready', function() {
            initAllComponents();
        });
        
        // 初始化所有组件
        function initAllComponents() {
            try {
                // 创建通知公告组件
                components.notice = new (ood.Class.getInstance('ood.Mobile.OA.Notice'))({
                    notices: [
                        {
                            id: '1',
                            title: '系统维护通知',
                            time: '2025-09-15 14:30',
                            summary: '系统将于今晚00:00-02:00进行例行维护，期间服务可能中断，请提前做好数据保存工作。',
                            important: true,
                            read: false,
                            disabled: false
                        },
                        {
                            id: '2',
                            title: '新功能上线',
                            time: '2025-09-14 09:15',
                            summary: 'OA系统新增了在线会议功能，支持多人视频会议和屏幕共享。',
                            important: false,
                            read: true,
                            disabled: false
                        },
                        {
                            id: '3',
                            title: '安全提醒',
                            time: '2025-09-13 16:45',
                            summary: '请注意保护账号安全，定期修改密码，不要在公共场合泄露个人信息。',
                            important: true,
                            read: false,
                            disabled: false
                        }
                    ],
                    onNoticeClick: function(profile, index, notice) {
                        alert('点击了通知: ' + notice.title + '\n\n' + notice.summary);
                    }
                });
                components.notice.render(document.getElementById('notice-container'));
                
                // 创建待办事项组件
                components.todoList = new (ood.Class.getInstance('ood.Mobile.OA.TodoList'))({
                    todos: [
                        {
                            id: '1',
                            title: '完成季度报告',
                            dueDate: '2025-09-20',
                            priority: 'high',
                            completed: false,
                            disabled: false
                        },
                        {
                            id: '2',
                            title: '准备会议材料',
                            dueDate: '2025-09-18',
                            priority: 'medium',
                            completed: true,
                            disabled: false
                        },
                        {
                            id: '3',
                            title: '回复客户邮件',
                            dueDate: '2025-09-15',
                            priority: 'low',
                            completed: false,
                            disabled: false
                        }
                    ],
                    onTodoClick: function(profile, index, todo) {
                        alert('点击了待办事项: ' + todo.title + '\n截止日期: ' + todo.dueDate);
                    },
                    onTodoCompleteChange: function(profile, index, todo) {
                        console.log('待办事项状态改变:', todo.title, '完成状态:', todo.completed);
                    }
                });
                components.todoList.render(document.getElementById('todo-container'));
                
                // 创建审批流程组件
                components.approvalFlow = new (ood.Class.getInstance('ood.Mobile.OA.ApprovalFlow'))({
                    approvals: [
                        {
                            id: '1',
                            title: '请假申请',
                            applicant: '张三',
                            applyTime: '2025-09-14 09:30',
                            type: '请假',
                            status: 'pending',
                            urgent: false,
                            disabled: false
                        },
                        {
                            id: '2',
                            title: '出差申请',
                            applicant: '李四',
                            applyTime: '2025-09-13 14:20',
                            type: '出差',
                            status: 'approved',
                            urgent: true,
                            disabled: false
                        },
                        {
                            id: '3',
                            title: '报销申请',
                            applicant: '王五',
                            applyTime: '2025-09-12 11:15',
                            type: '报销',
                            status: 'rejected',
                            urgent: false,
                            disabled: false
                        }
                    ],
                    onApprovalClick: function(profile, index, approval) {
                        alert('点击了审批: ' + approval.title + '\n申请人: ' + approval.applicant);
                    },
                    onActionClick: function(profile, index, approval, action) {
                        if (action === 'approve') {
                            alert('已同意审批: ' + approval.title);
                        } else if (action === 'reject') {
                            alert('已拒绝审批: ' + approval.title);
                        }
                    }
                });
                components.approvalFlow.render(document.getElementById('approval-container'));
                
                // 创建日程安排组件
                components.schedule = new (ood.Class.getInstance('ood.Mobile.OA.Schedule'))({
                    schedules: [
                        {
                            id: '1',
                            date: '2025-09-15',
                            time: '09:00-10:00',
                            title: '部门周会',
                            location: '会议室A',
                            participants: ['张三', '李四', '王五'],
                            important: true,
                            disabled: false
                        },
                        {
                            id: '2',
                            date: '2025-09-15',
                            time: '14:00-15:30',
                            title: '项目评审',
                            location: '会议室B',
                            participants: ['赵六', '钱七'],
                            important: false,
                            disabled: false
                        },
                        {
                            id: '3',
                            date: '2025-09-16',
                            time: '10:00-11:00',
                            title: '客户拜访',
                            location: '客户公司',
                            participants: ['孙八'],
                            important: true,
                            disabled: false
                        }
                    ],
                    onScheduleClick: function(profile, index, schedule) {
                        alert('点击了日程: ' + schedule.title + '\n时间: ' + schedule.time + '\n地点: ' + schedule.location);
                    }
                });
                components.schedule.render(document.getElementById('schedule-container'));
                
                // 创建通讯录组件
                components.contactList = new (ood.Class.getInstance('ood.Mobile.OA.ContactList'))({
                    contacts: [
                        {
                            id: '1',
                            name: '张三',
                            position: '产品经理',
                            department: '产品部',
                            avatar: '',
                            phone: '13800138001',
                            email: 'zhangsan@company.com',
                            disabled: false
                        },
                        {
                            id: '2',
                            name: '李四',
                            position: '前端工程师',
                            department: '技术部',
                            avatar: '',
                            phone: '13800138002',
                            email: 'lisi@company.com',
                            disabled: false
                        },
                        {
                            id: '3',
                            name: '王五',
                            position: '设计师',
                            department: '设计部',
                            avatar: '',
                            phone: '13800138003',
                            email: 'wangwu@company.com',
                            disabled: false
                        },
                        {
                            id: '4',
                            name: '赵六',
                            position: '后端工程师',
                            department: '技术部',
                            avatar: '',
                            phone: '13800138004',
                            email: 'zhaoliu@company.com',
                            disabled: false
                        }
                    ],
                    onContactClick: function(profile, index, contact) {
                        alert('点击了联系人: ' + contact.name + '\n职位: ' + contact.position + '\n电话: ' + contact.phone);
                    }
                });
                components.contactList.render(document.getElementById('contact-container'));
                
                // 创建文件管理组件
                components.fileManager = new (ood.Class.getInstance('ood.Mobile.OA.FileManager'))({
                    files: [
                        {
                            id: '1',
                            name: '项目计划书.docx',
                            type: 'doc',
                            size: 102400,
                            modifiedTime: '2025-09-14 10:30',
                            disabled: false
                        },
                        {
                            id: '2',
                            name: '产品需求文档.pdf',
                            type: 'pdf',
                            size: 204800,
                            modifiedTime: '2025-09-13 15:45',
                            disabled: false
                        },
                        {
                            id: '3',
                            name: '设计素材',
                            type: 'folder',
                            size: 0,
                            modifiedTime: '2025-09-12 09:15',
                            disabled: false
                        },
                        {
                            id: '4',
                            name: '会议照片.jpg',
                            type: 'image',
                            size: 512000,
                            modifiedTime: '2025-09-11 14:20',
                            disabled: false
                        }
                    ],
                    onFileClick: function(profile, index, file) {
                        alert('点击了文件: ' + file.name + '\n类型: ' + file.type);
                    },
                    onActionClick: function(profile, index, file, action) {
                        if (action === 'download') {
                            alert('开始下载文件: ' + file.name);
                        } else if (action === 'share') {
                            alert('分享文件: ' + file.name);
                        } else if (action === 'delete') {
                            alert('删除文件: ' + file.name);
                        }
                    }
                });
                components.fileManager.render(document.getElementById('file-container'));
                
                // 创建会议管理组件
                components.meetingManager = new (ood.Class.getInstance('ood.Mobile.OA.MeetingManager'))({
                    meetings: [
                        {
                            id: '1',
                            title: '项目周会',
                            startTime: '2025-09-15 09:00',
                            endTime: '2025-09-15 10:00',
                            room: '会议室A',
                            participants: ['张三', '李四', '王五'],
                            status: 'scheduled',
                            disabled: false
                        },
                        {
                            id: '2',
                            title: '产品评审会',
                            startTime: '2025-09-15 14:00',
                            endTime: '2025-09-15 15:30',
                            room: '会议室B',
                            participants: ['赵六', '钱七', '孙八'],
                            status: 'in-progress',
                            disabled: false
                        },
                        {
                            id: '3',
                            title: '季度总结会',
                            startTime: '2025-09-14 10:00',
                            endTime: '2025-09-14 12:00',
                            room: '大会议室',
                            participants: ['全体成员'],
                            status: 'completed',
                            disabled: false
                        }
                    ],
                    onMeetingClick: function(profile, index, meeting) {
                        alert('点击了会议: ' + meeting.title + '\n时间: ' + meeting.startTime + ' - ' + meeting.endTime);
                    },
                    onActionClick: function(profile, index, meeting, action) {
                        if (action === 'join') {
                            alert('加入会议: ' + meeting.title);
                        } else if (action === 'cancel') {
                            alert('取消会议: ' + meeting.title);
                        }
                    }
                });
                components.meetingManager.render(document.getElementById('meeting-container'));
                
                // 创建考勤打卡组件
                components.attendance = new (ood.Class.getInstance('ood.Mobile.OA.Attendance'))({
                    attendanceData: {
                        attendanceDays: 18,
                        lateCount: 2,
                        earlyLeaveCount: 1,
                        records: [
                            {
                                date: '2025-09-14',
                                punchInTime: '08:55',
                                punchOutTime: '18:10',
                                status: 'normal'
                            },
                            {
                                date: '2025-09-13',
                                punchInTime: '09:15',
                                punchOutTime: '18:05',
                                status: 'late'
                            },
                            {
                                date: '2025-09-12',
                                punchInTime: '08:50',
                                punchOutTime: '17:30',
                                status: 'early'
                            }
                        ]
                    },
                    onPunch: function(profile, type, time, record) {
                        alert((type === 'in' ? '上班' : '下班') + '打卡成功: ' + time);
                    }
                });
                components.attendance.render(document.getElementById('attendance-container'));
                
                console.log('所有OA办公组件初始化完成');
            } catch (error) {
                console.error('组件初始化失败:', error);
            }
        }
        
        // 调整组件尺寸
        function resizeComponents() {
            var widths = ['100%', '300px', '400px', '500px'];
            var heights = ['100%', '200px', '300px', '400px'];
            var randomWidth = widths[Math.floor(Math.random() * widths.length)];
            var randomHeight = heights[Math.floor(Math.random() * heights.length)];
            
            // 调整部分组件的尺寸
            if (components.notice) {
                components.notice.get(0).boxing()._onresize(components.notice.get(0), randomWidth, 'auto');
            }
            
            if (components.todoList) {
                components.todoList.get(0).boxing()._onresize(components.todoList.get(0), randomWidth, randomHeight);
            }
            
            alert('已调整组件尺寸为: ' + randomWidth + ' x ' + randomHeight);
        }
        
        // 切换主题
        function toggleTheme() {
            var currentTheme = document.body.classList.contains('dark-theme') ? 'light' : 'dark';
            if (currentTheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.body.style.backgroundColor = '#1c1c1e';
                document.body.style.color = '#ffffff';
            } else {
                document.body.classList.remove('dark-theme');
                document.body.style.backgroundColor = '#f5f5f5';
                document.body.style.color = '#000000';
            }
            alert('已切换到' + (currentTheme === 'dark' ? '深色' : '浅色') + '主题');
        }
        
        // 添加测试数据
        function addTestData() {
            // 添加通知
            if (components.notice) {
                components.notice.get(0).boxing().addNotice({
                    id: 'new-' + Date.now(),
                    title: '新增测试通知',
                    time: new Date().toLocaleString(),
                    summary: '这是一条新增的测试通知',
                    important: Math.random() > 0.5,
                    read: false,
                    disabled: false
                });
            }
            
            // 添加待办事项
            if (components.todoList) {
                components.todoList.get(0).boxing().addTodo({
                    id: 'new-' + Date.now(),
                    title: '新增待办事项',
                    dueDate: '2025-09-25',
                    priority: ['high', 'medium', 'low'][Math.floor(Math.random() * 3)],
                    completed: false,
                    disabled: false
                });
            }
            
            alert('已添加测试数据');
        }
        
        // 清空数据
        function clearData() {
            if (confirm('确定要清空所有数据吗？')) {
                // 清空通知
                if (components.notice) {
                    components.notice.get(0).boxing().setNotices([]);
                }
                
                // 清空待办事项
                if (components.todoList) {
                    components.todoList.get(0).boxing().setTodos([]);
                }
                
                alert('已清空所有数据');
            }
        }
    </script>
</body>
</html>