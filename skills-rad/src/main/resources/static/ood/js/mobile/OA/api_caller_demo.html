<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>APICaller 使用示例</title>
    <link rel="stylesheet" type="text/css" href="../../../css/ood.css"/>
    <link rel="stylesheet" type="text/css" href="../../../css/mobile/oa-mobile.css"/>
    <script type="text/javascript" src="../../../js/ood.js"></script>
    <script type="text/javascript" src="../OA/APICallerExample.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--mobile-bg-primary);
        }
        
        .demo-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px 0;
            border-bottom: 1px solid var(--mobile-border-color);
        }
        
        .demo-header h1 {
            color: var(--mobile-text-primary);
            font-size: var(--mobile-font-lg);
            margin: 0;
        }
        
        .demo-description {
            color: var(--mobile-text-secondary);
            font-size: var(--mobile-font-sm);
            text-align: center;
            margin-top: 10px;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .action-button {
            padding: 10px 15px;
            background-color: var(--mobile-primary);
            color: white;
            border: none;
            border-radius: var(--mobile-border-radius);
            cursor: pointer;
            font-size: var(--mobile-font-sm);
            transition: background-color 0.2s;
        }
        
        .action-button:hover {
            background-color: var(--mobile-primary-dark);
        }
        
        .action-button.secondary {
            background-color: var(--mobile-secondary);
        }
        
        .action-button.secondary:hover {
            background-color: var(--mobile-secondary-dark);
        }
        
        .api-config {
            background-color: var(--mobile-bg-secondary);
            border-radius: var(--mobile-border-radius);
            padding: 15px;
            margin: 20px 0;
            border: 1px solid var(--mobile-border-color);
        }
        
        .api-config h3 {
            margin-top: 0;
            color: var(--mobile-text-primary);
            font-size: var(--mobile-font-md);
        }
        
        .api-config input, .api-config select {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            border: 1px solid var(--mobile-border-color);
            border-radius: var(--mobile-border-radius);
            background-color: var(--mobile-bg-input);
            color: var(--mobile-text-primary);
            font-size: var(--mobile-font-sm);
        }
        
        .api-config button {
            width: 100%;
            padding: 10px;
            background-color: var(--mobile-primary);
            color: white;
            border: none;
            border-radius: var(--mobile-border-radius);
            cursor: pointer;
            font-size: var(--mobile-font-sm);
        }
        
        .api-config button:hover {
            background-color: var(--mobile-primary-dark);
        }
        
        .event-log {
            background-color: var(--mobile-bg-secondary);
            border-radius: var(--mobile-border-radius);
            padding: 15px;
            margin: 20px 0;
            border: 1px solid var(--mobile-border-color);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .event-log h3 {
            margin-top: 0;
            color: var(--mobile-text-primary);
            font-size: var(--mobile-font-md);
        }
        
        .log-entry {
            font-size: var(--mobile-font-xs);
            color: var(--mobile-text-secondary);
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--mobile-border-color);
        }
        
        .log-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .notice-list {
            background-color: var(--mobile-bg-secondary);
            border-radius: var(--mobile-border-radius);
            padding: 15px;
            margin: 20px 0;
            border: 1px solid var(--mobile-border-color);
        }
        
        .notice-list h3 {
            margin-top: 0;
            color: var(--mobile-text-primary);
            font-size: var(--mobile-font-md);
        }
        
        .notice-item {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: var(--mobile-border-radius);
            background-color: var(--mobile-bg-primary);
            border: 1px solid var(--mobile-border-color);
        }
        
        .notice-item:last-child {
            margin-bottom: 0;
        }
        
        .notice-title {
            font-weight: bold;
            color: var(--mobile-text-primary);
            margin-bottom: 5px;
        }
        
        .notice-time {
            font-size: var(--mobile-font-xs);
            color: var(--mobile-text-secondary);
            margin-bottom: 5px;
        }
        
        .notice-summary {
            font-size: var(--mobile-font-sm);
            color: var(--mobile-text-secondary);
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>APICaller 使用示例</h1>
            <p class="demo-description">演示如何在业务组件中使用 APICaller 进行数据交互</p>
        </div>
        
        <div class="action-buttons">
            <button class="action-button" onclick="loadNotices()">加载通知</button>
            <button class="action-button secondary" onclick="createNotice()">创建通知</button>
        </div>
        
        <div class="api-config">
            <h3>API配置</h3>
            <input type="text" id="apiUrl" placeholder="API URL (例如: /api/notices)" value="/api/notices">
            <select id="apiMethod">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
            </select>
            <button onclick="updateApiConfig()">更新配置</button>
        </div>
        
        <div class="event-log">
            <h3>事件日志</h3>
            <div id="eventLog"></div>
        </div>
        
        <div class="notice-list">
            <h3>通知列表</h3>
            <div id="noticeList"></div>
        </div>
        
        <div id="apiCallerContainer"></div>
    </div>

    <script>
        var apiCallerExample;
        var eventLog = [];
        
        // 添加日志条目
        function addLogEntry(message) {
            var timestamp = new Date().toLocaleTimeString();
            var logEntry = '[' + timestamp + '] ' + message;
            eventLog.unshift(logEntry);
            
            // 只保留最近的20条日志
            if (eventLog.length > 20) {
                eventLog = eventLog.slice(0, 20);
            }
            
            // 更新UI
            var logContainer = document.getElementById('eventLog');
            logContainer.innerHTML = '';
            eventLog.forEach(function(entry) {
                var div = document.createElement('div');
                div.className = 'log-entry';
                div.textContent = entry;
                logContainer.appendChild(div);
            });
        }
        
        // 显示通知列表
        function displayNotices(notices) {
            var noticeListContainer = document.getElementById('noticeList');
            noticeListContainer.innerHTML = '';
            
            if (!notices || notices.length === 0) {
                noticeListContainer.innerHTML = '<p>暂无通知</p>';
                return;
            }
            
            notices.forEach(function(notice) {
                var noticeItem = document.createElement('div');
                noticeItem.className = 'notice-item';
                noticeItem.innerHTML = `
                    <div class="notice-title">${notice.title}</div>
                    <div class="notice-time">${notice.time}</div>
                    <div class="notice-summary">${notice.summary}</div>
                `;
                noticeListContainer.appendChild(noticeItem);
            });
        }
        
        ood.ready(function() {
            // 创建 APICaller 示例组件
            apiCallerExample = ood.create("ood.Mobile.OA.APICallerExample");
            apiCallerExample.setHost(null, "apiCallerExample");
            
            // 设置组件属性
            apiCallerExample.setWidth("100%");
            apiCallerExample.setHeight("auto");
            
            // 设置事件处理
            apiCallerExample.events.onDataLoad = function(profile, data) {
                addLogEntry("数据加载完成: " + (data ? data.length : 0) + " 条通知");
                displayNotices(data);
            };
            
            apiCallerExample.events.onDataError = function(profile, error) {
                addLogEntry("数据加载错误: " + error);
            };
            
            // 添加到页面
            document.getElementById("apiCallerContainer").appendChild(apiCallerExample.get(0));
            
            addLogEntry("APICaller 示例组件初始化完成");
        });
        
        function loadNotices() {
            if (apiCallerExample) {
                addLogEntry("开始加载通知数据");
                apiCallerExample.functions.loadNotices();
            }
        }
        
        function createNotice() {
            if (apiCallerExample) {
                var newNotice = {
                    title: '新通知 - ' + new Date().toLocaleString(),
                    time: new Date().toISOString().split('T')[0],
                    summary: '这是一条通过 APICaller 创建的通知示例...',
                    important: Math.random() > 0.5,
                    read: false
                };
                
                addLogEntry("开始创建新通知: " + newNotice.title);
                apiCallerExample.functions.createNotice(newNotice);
            }
        }
        
        function updateApiConfig() {
            var url = document.getElementById("apiUrl").value;
            var method = document.getElementById("apiMethod").value;
            addLogEntry("API配置已更新 - URL: " + url + ", Method: " + method);
        }
    </script>
</body>
</html>