#!/bin/sh /etc/rc.common
# ooderNexus OpenWrt 启动脚本
# 版本: 2.0.0

START=99
STOP=10

USE_PROCD=1

PROG=/opt/ooder-nexus/bin/start.sh
PID_FILE=/var/run/ooder-nexus.pid
CONFIG_FILE=/opt/ooder-nexus/config/application.yml

start_service() {
    procd_open_instance
    procd_set_param command $PROG
    procd_set_param respawn
    procd_set_param pidfile $PID_FILE
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_close_instance
    
    echo "ooderNexus 服务已启动"
}

stop_service() {
    if [ -f $PID_FILE ]; then
        PID=$(cat $PID_FILE)
        kill $PID 2>/dev/null
        rm -f $PID_FILE
        echo "ooderNexus 服务已停止"
    fi
}

restart() {
    stop
    start
}

status() {
    if [ -f $PID_FILE ]; then
        PID=$(cat $PID_FILE)
        if kill -0 $PID 2>/dev/null; then
            echo "ooderNexus 正在运行 (PID: $PID)"
            return 0
        else
            echo "ooderNexus 未运行 (PID 文件存在但进程不存在)"
            return 1
        fi
    else
        echo "ooderNexus 未运行"
        return 1
    fi
}

boot() {
    # 等待网络就绪
    sleep 10
    start
}
