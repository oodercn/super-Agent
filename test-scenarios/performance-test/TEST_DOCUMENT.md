# 性能测试场景文档 (Nexus)

## 1. 测试场景概述

本测试场景旨在评估P2P网络中代理节点的性能表现，包括负载测试、压力测试和可扩展性测试，针对Nexus版本的优化特性。通过模拟不同规模的网络环境和业务负载，验证系统在各种条件下的性能指标和稳定性，特别关注Nexus版本的性能提升。

## 2. 测试环境配置

### 2.1 硬件要求

| 设备类型 | 配置要求 | 数量 |
|---------|---------|------|
| 测试服务器 | CPU: 8核+，内存: 16GB+，磁盘: 200GB+ | 3台 |
| 网络设备 | 千兆以太网交换机 | 1台 |
| 监控设备 | 性能监控工具 | 1套 |

### 2.2 软件要求

| 软件类型 | 版本 | 用途 |
|---------|------|------|
| JDK | 1.8+ | 运行Java应用 |
| Maven | 3.6+ | 构建和依赖管理 |
| Spring Boot | 2.7.x | 应用框架 |
| JMeter | 5.4+ | 性能测试工具 |
| Grafana | 8.0+ | 监控可视化 |
| Prometheus | 2.30+ | 监控数据采集 |
| Agent SDK | 0.6.5 Nexus | Nexus版本Agent SDK |
| Skill VFS | 0.6.5 Nexus | Nexus版本Skill VFS |

### 2.3 网络配置

| 网络参数 | 配置值 | 说明 |
|---------|--------|------|
| 网络类型 | 局域网 | 用于性能测试的稳定网络环境 |
| 带宽 | 1Gbps | 确保网络带宽不会成为性能瓶颈 |
| 延迟 | <1ms | 本地局域网环境 |
| 丢包率 | <0.1% | 确保网络稳定性 |

## 3. 测试用例设计

### 3.1 负载测试 (Load Test) - Nexus

#### 3.1.1 测试目标
- 评估Nexus版本在正常负载下的性能表现
- 确定Nexus版本的最大吞吐量
- 验证Nexus版本在持续负载下的稳定性
- 对比Nexus版本与之前版本的性能提升

#### 3.1.2 测试配置

| 配置项 | 值 | 说明 |
|--------|-----|------|
| 代理节点数量 | 10个 | 包括1个MCP代理、3个路由代理、6个终端代理（Nexus） |
| 并发请求数 | 100, 500, 1000 | 逐步增加并发数 |
| 测试持续时间 | 30分钟 | 每个负载级别运行30分钟 |
| 请求类型 | 服务发现、任务执行、心跳同步 | 混合测试不同类型的请求（Nexus） |
| 版本对比 | 同时测试Nexus和之前版本 | 对比性能提升 |

#### 3.1.3 测试步骤
1. 启动所有代理节点（Nexus版本）
2. 配置JMeter测试计划，设置初始并发数为100
3. 运行测试30分钟，记录性能指标
4. 增加并发数至500，重复测试
5. 增加并发数至1000，重复测试
6. 切换到之前版本，重复相同测试
7. 分析测试结果，确定Nexus版本的性能提升

#### 3.1.4 监控指标
- 响应时间（平均、最大、95%分位）
- 吞吐量（每秒处理请求数）
- CPU使用率
- 内存使用率
- 网络带宽使用率
- 服务发现成功率
- 心跳同步成功率（Nexus）
- 版本性能对比数据

### 3.2 压力测试 (Stress Test) - Nexus

#### 3.2.1 测试目标
- 评估Nexus版本在极限负载下的表现
- 确定Nexus版本的崩溃点
- 验证Nexus版本的故障恢复能力
- 测试Nexus版本的心跳机制在高负载下的稳定性

#### 3.2.2 测试配置

| 配置项 | 值 | 说明 |
|--------|-----|------|
| 代理节点数量 | 20个 | 包括1个MCP代理、5个路由代理、14个终端代理（Nexus） |
| 并发请求数 | 2000, 5000, 10000 | 逐步增加至系统崩溃 |
| 测试持续时间 | 10分钟 | 每个负载级别运行10分钟 |
| 请求类型 | 服务发现、任务执行、状态同步、心跳 | 混合测试各类请求（Nexus） |
| 故障注入 | 模拟节点故障和网络抖动 | 测试Nexus版本的故障恢复能力 |

#### 3.2.3 测试步骤
1. 启动所有代理节点（Nexus版本）
2. 配置JMeter测试计划，设置初始并发数为2000
3. 运行测试10分钟，记录性能指标
4. 增加并发数至5000，重复测试
5. 继续增加并发数，直至系统崩溃
6. 记录系统崩溃时的各项指标
7. 重启系统，验证故障恢复能力
8. 模拟节点故障，测试Nexus版本的自愈能力

#### 3.2.4 监控指标
- 响应时间（平均、最大、95%分位）
- 错误率
- CPU使用率（峰值）
- 内存使用率（峰值）
- 网络带宽使用率（峰值）
- 系统崩溃时的并发数
- 故障恢复时间
- 心跳丢失率（Nexus）
- 故障自愈时间（Nexus）

### 3.3 可扩展性测试 (Scalability Test) - Nexus

#### 3.3.1 测试目标
- 评估Nexus版本的水平扩展能力
- 验证代理节点数量增加时的性能变化（Nexus）
- 确定Nexus版本的最佳节点配置
- 测试Nexus版本在大规模节点下的稳定性

#### 3.3.2 测试配置

| 配置项 | 值 | 说明 |
|--------|-----|------|
| 代理节点数量 | 5, 10, 20, 50 | 逐步增加节点数量（Nexus） |
| 并发请求数 | 1000 | 固定并发数 |
| 测试持续时间 | 20分钟 | 每个节点数量级别运行20分钟 |
| 网络拓扑 | 分层架构 | 保持MCP:路由:终端=1:3:6的比例（Nexus） |
| 版本对比 | 同时测试Nexus和之前版本 | 对比可扩展性提升 |

#### 3.3.3 测试步骤
1. 启动初始5个代理节点（Nexus版本）
2. 配置JMeter测试计划，设置并发数为1000
3. 运行测试20分钟，记录性能指标
4. 增加节点数量至10个，重复测试
5. 增加节点数量至20个，重复测试
6. 增加节点数量至50个，重复测试
7. 切换到之前版本，重复相同测试
8. 分析测试结果，评估Nexus版本的可扩展性

#### 3.3.4 监控指标
- 响应时间（平均、最大、95%分位）
- 吞吐量（每秒处理请求数）
- 每个节点的CPU使用率
- 每个节点的内存使用率
- 网络带宽使用率
- 系统整体性能与节点数量的关系
- 节点发现时间（Nexus）
- 负载均衡效果（Nexus）
- 版本可扩展性对比数据

## 4. 测试执行流程

### 4.1 测试准备
1. 搭建测试环境，配置硬件和软件（Nexus版本）
2. 部署代理节点，确保网络连接正常（Nexus版本）
3. 配置监控工具，设置关键指标监控（包括Nexus特有指标）
4. 准备测试数据和测试脚本（针对Nexus版本优化）
5. 准备版本对比测试环境（同时部署Nexus和之前版本）

### 4.2 测试执行
1. 按照测试用例顺序执行测试（先Nexus版本，后之前版本）
2. 记录测试过程中的各项指标（包括Nexus特有指标）
3. 监控系统状态，及时发现异常（特别关注Nexus的心跳机制）
4. 保存测试日志和监控数据（分别保存Nexus和之前版本的数据）
5. 执行故障注入测试，验证Nexus版本的故障恢复能力

### 4.3 测试后处理
1. 停止所有测试进程和代理节点
2. 收集和整理测试数据（对比Nexus和之前版本）
3. 分析测试结果，生成测试报告（突出Nexus版本的性能提升）
4. 总结性能瓶颈和优化建议（针对Nexus版本）
5. 提供Nexus版本的最佳配置建议

## 5. 预期结果 - Nexus

### 5.1 负载测试预期结果
- Nexus版本在100并发下响应时间<80ms（比之前版本提升20%）
- Nexus版本在500并发下响应时间<400ms（比之前版本提升20%）
- Nexus版本在1000并发下响应时间<800ms（比之前版本提升20%）
- Nexus版本最大吞吐量>1200请求/秒（比之前版本提升20%）
- Nexus版本在持续负载下稳定运行，无错误
- Nexus版本的心跳同步成功率>99.9%

### 5.2 压力测试预期结果
- Nexus版本在2000并发下正常运行
- Nexus版本在5000并发下性能下降但不崩溃
- Nexus版本崩溃时的并发数>10000（比之前版本提升25%）
- Nexus版本故障恢复时间<20秒（比之前版本提升33%）
- Nexus版本在故障注入后能快速自愈
- Nexus版本的心跳机制在高负载下保持稳定

### 5.3 可扩展性测试预期结果
- Nexus版本性能随节点数量增加而线性提升（斜率更高）
- 50个节点时Nexus版本吞吐量>6000请求/秒（比之前版本提升20%）
- Nexus版本节点间负载均衡良好（负载偏差<5%）
- Nexus版本在大规模节点下保持稳定（50节点无性能下降）
- Nexus版本的节点发现时间<2秒（比之前版本提升50%）

## 6. 风险评估 - Nexus

| 风险因素 | 影响程度 | 应对措施 |
|---------|---------|----------|
| 网络带宽不足 | 高 | 确保测试环境使用千兆以太网，监控带宽使用情况 |
| 硬件资源限制 | 高 | 使用配置充足的测试服务器，监控资源使用情况 |
| 测试工具性能瓶颈 | 中 | 确保JMeter服务器配置足够，使用分布式测试 |
| 系统监控开销 | 低 | 合理配置监控频率，避免监控本身影响性能 |
| 测试数据不一致 | 低 | 使用标准化的测试数据和脚本，确保版本对比的公平性 |
| Nexus特有功能测试 | 中 | 确保测试覆盖Nexus的所有新功能，特别是心跳机制 |
| 版本对比测试 | 中 | 确保两个版本的测试环境和配置完全一致 |

## 7. 测试工具使用 - Nexus

### 7.1 JMeter配置
- 线程组：设置并发用户数和测试持续时间
- HTTP请求：模拟服务发现、任务执行和心跳请求（Nexus）
- 监听器：收集响应时间、吞吐量等指标
- 定时器：控制请求发送速率
- 故障注入：模拟节点故障和网络抖动（Nexus）

### 7.2 监控工具配置
- Prometheus：采集系统和应用指标（包括Nexus特有指标）
- Grafana：创建性能监控仪表板（包含Nexus对比视图）
- 自定义监控脚本：监控P2P网络特定指标（特别是Nexus的心跳机制）
- 版本对比仪表板：同时展示Nexus和之前版本的性能指标

## 8. 测试报告模板 - Nexus

### 8.1 测试概述
- 测试时间：
- 测试环境：
- 测试人员：
- 测试版本：Nexus 0.6.5 vs 之前版本

### 8.2 测试结果摘要

| 测试类型 | 并发数/节点数 | 平均响应时间 (Nexus/之前版本) | 最大响应时间 (Nexus/之前版本) | 吞吐量 (Nexus/之前版本) | 错误率 (Nexus/之前版本) | 性能提升 | 结论 |
|---------|--------------|----------------------------|----------------------------|------------------------|------------------------|----------|------|
| 负载测试 | 100 | / | / | / | / | % | |
| 负载测试 | 500 | / | / | / | / | % | |
| 负载测试 | 1000 | / | / | / | / | % | |
| 压力测试 | 2000 | / | / | / | / | % | |
| 压力测试 | 5000 | / | / | / | / | % | |
| 压力测试 | 崩溃点 | / | / | / | / | % | |
| 可扩展性测试 | 5节点 | / | / | / | / | % | |
| 可扩展性测试 | 10节点 | / | / | / | / | % | |
| 可扩展性测试 | 20节点 | / | / | / | / | % | |
| 可扩展性测试 | 50节点 | / | / | / | / | % | |

### 8.3 Nexus特有指标

| 指标名称 | Nexus版本 | 之前版本 | 性能提升 | 结论 |
|---------|----------|----------|----------|------|
| 心跳同步成功率 | % | % | % | |
| 节点发现时间 | ms | ms | % | |
| 故障恢复时间 | s | s | % | |
| 负载均衡偏差 | % | % | % | |
| 心跳丢失率 | % | % | % | |

### 8.4 性能分析
- 系统瓶颈分析（Nexus vs 之前版本）
- Nexus版本的性能优化建议
- 与预期结果的对比
- Nexus特有功能的性能表现分析

### 8.5 测试结论
- 系统性能评估（Nexus版本）
- 是否满足性能要求
- Nexus版本的优势和改进空间
- 后续测试建议

## 9. 附录

### 9.1 测试脚本
- JMeter测试计划文件（Nexus版本）
- 监控配置文件（包含Nexus特有指标）
- 启动和停止脚本（Nexus版本）
- 故障注入脚本（Nexus版本）

### 9.2 网络拓扑图
- 测试环境网络拓扑
- 节点部署示意图（Nexus版本）

### 9.3 参考文档
- P2P网络架构文档（Nexus版本）
- 代理节点配置指南（Nexus版本）
- 性能测试最佳实践
- Nexus版本性能优化指南