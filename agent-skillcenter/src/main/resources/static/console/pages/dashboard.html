<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>仪表盘 - SkillCenter 控制台</title>
    <link rel="stylesheet" href="/skillcenter/console/css/style.css">
    <link href="/skillcenter/console/assets/css/remixicon/remixicon.css" rel="stylesheet">
    <script src="/skillcenter/console/js/menu.js"></script>
</head>
<body>
    <div class="container">
        <aside class="sidebar" id="sidebar">
            <!-- 菜单将通过menu.js动态加载 -->
        </aside>
        <main class="main-content">
            <header class="header">
                <h1><span>⚡</span> 仪表盘</h1>
                <div class="subtitle">
                    <span class="badge" style="background-color: #3b82f6; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-right: 16px;">v0.6.5</span>
                    <span>Ooder Rad Style</span> | 
                    <span id="timestamp"></span>
                </div>
            </header>
            
            <!-- 系统概览 -->
            <div class="dashboard-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ri-server-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3>系统状态</h3>
                            <div class="stat-value" id="system-status">运行中</div>
                            <div class="label">SkillCenter 状态</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ri-briefcase-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3>技能数量</h3>
                            <div class="stat-value" id="skill-count">24</div>
                            <div class="label">已注册技能数</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ri-check-circle-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3>执行成功率</h3>
                            <div class="stat-value" id="execution-success-rate">97.5%</div>
                            <div class="label">技能执行成功率</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ri-trending-up-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3>市场活跃度</h3>
                            <div class="stat-value" id="market-activity">85</div>
                            <div class="label">最近7天活跃度</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ri-cpu-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3>CPU 使用率</h3>
                            <div class="stat-value" id="cpu-usage">23%</div>
                            <div class="label">当前使用率</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ri-memory-card-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3>内存使用率</h3>
                            <div class="stat-value" id="memory-usage">45%</div>
                            <div class="label">当前使用率</div>
                        </div>
                    </div>
                </div>
                
                <!-- 技能执行监控 -->
                <div class="recent-activities">
                    <h2>技能执行监控</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>今日执行次数</h3>
                                <div class="stat-value">128</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>成功次数</h3>
                                <div class="stat-value">125</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>失败次数</h3>
                                <div class="stat-value">3</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>平均执行时间</h3>
                                <div class="stat-value">2.3s</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 市场活跃度 -->
                <div class="recent-activities">
                    <h2>市场活跃度</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>发布技能数</h3>
                                <div class="stat-value">8</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>下载技能数</h3>
                                <div class="stat-value">42</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>技能评分</h3>
                                <div class="stat-value">4.8/5.0</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>活跃用户数</h3>
                                <div class="stat-value">15</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // 初始化菜单
        initMenu('dashboard');
        
        // API基础URL
        const API_BASE_URL = '/skillcenter/api';
        
        // 更新时间戳
        function updateTimestamp() {
            const now = new Date();
            const timestamp = document.getElementById('timestamp');
            if (timestamp) {
                timestamp.textContent = now.toLocaleString('zh-CN');
            }
        }
        
        // 加载仪表盘数据
        async function loadDashboardData() {
            try {
                // 获取系统概览统计数据
                const statsResponse = await fetch(`${API_BASE_URL}/dashboard/stats`);
                if (statsResponse.ok) {
                    const statsData = await statsResponse.json();
                    if (statsData.data) {
                        const skillCount = document.getElementById('skill-count');
                        if (skillCount) skillCount.textContent = statsData.data.totalSkills || 0;
                    }
                }
                
                // 获取技能执行统计数据
                const executionStatsResponse = await fetch(`${API_BASE_URL}/dashboard/execution-stats`);
                if (executionStatsResponse.ok) {
                    const executionStatsData = await executionStatsResponse.json();
                    if (executionStatsData.data) {
                        const executionSuccessRate = document.getElementById('execution-success-rate');
                        if (executionSuccessRate) executionSuccessRate.textContent = `${executionStatsData.data.successRate || 0}%`;
                    }
                }
                
                // 获取市场活跃度统计数据
                const marketStatsResponse = await fetch(`${API_BASE_URL}/dashboard/market-stats`);
                if (marketStatsResponse.ok) {
                    const marketStatsData = await marketStatsResponse.json();
                    if (marketStatsData.data) {
                        // 计算市场活跃度得分（基于下载量和评论数）
                        const downloads = marketStatsData.data.totalDownloads || 0;
                        const reviews = marketStatsData.data.totalReviews || 0;
                        const activityScore = Math.min(100, Math.floor((downloads + reviews) / 40));
                        
                        const marketActivity = document.getElementById('market-activity');
                        if (marketActivity) marketActivity.textContent = activityScore;
                    }
                }
                
                // 获取系统资源使用统计数据
                const systemStatsResponse = await fetch(`${API_BASE_URL}/dashboard/system-stats`);
                if (systemStatsResponse.ok) {
                    const systemStatsData = await systemStatsResponse.json();
                    if (systemStatsData.data) {
                        const cpuUsage = document.getElementById('cpu-usage');
                        if (cpuUsage) cpuUsage.textContent = `${systemStatsData.data.cpuUsage || 0}%`;
                        
                        const memoryUsage = document.getElementById('memory-usage');
                        if (memoryUsage) memoryUsage.textContent = `${systemStatsData.data.memoryUsage || 0}%`;
                    }
                }
                
                // 系统状态默认为运行中
                const systemStatus = document.getElementById('system-status');
                if (systemStatus) systemStatus.textContent = '运行中';
                
            } catch (error) {
                console.error('加载仪表盘数据错误:', error);
                // 加载失败时显示默认值
                const systemStatus = document.getElementById('system-status');
                if (systemStatus) systemStatus.textContent = '运行中';
                
                const skillCount = document.getElementById('skill-count');
                if (skillCount) skillCount.textContent = '0';
                
                const executionSuccessRate = document.getElementById('execution-success-rate');
                if (executionSuccessRate) executionSuccessRate.textContent = '0%';
                
                const marketActivity = document.getElementById('market-activity');
                if (marketActivity) marketActivity.textContent = '0';
                
                const cpuUsage = document.getElementById('cpu-usage');
                if (cpuUsage) cpuUsage.textContent = '0%';
                
                const memoryUsage = document.getElementById('memory-usage');
                if (memoryUsage) memoryUsage.textContent = '0%';
            }
        }
        
        // 初始化页面
        function init() {
            updateTimestamp();
            loadDashboardData();
            setInterval(updateTimestamp, 60000); // 每分钟更新时间戳
            setInterval(loadDashboardData, 300000); // 每5分钟更新仪表盘数据
        }
        
        // 页面加载完成后初始化
        window.onload = init;
    </script>
</body>
</html>
