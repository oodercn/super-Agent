<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实例管理 - SkillCenter</title>
    <link rel="stylesheet" href="/skillcenter/console/css/remixicon/remixicon.css">
    <link rel="stylesheet" href="/skillcenter/console/css/theme.css">
    <link rel="stylesheet" href="/skillcenter/console/css/nexus.css">
    <style>
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-card {
            background: var(--nx-card-bg);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--nx-border-color);
        }
        .stat-card .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--nx-text-primary);
        }
        .stat-card .stat-label {
            font-size: 14px;
            color: var(--nx-text-secondary);
            margin-top: 4px;
        }
        .stat-card.total .stat-value { color: #3b82f6; }
        .stat-card.running .stat-value { color: #10b981; }
        .stat-card.stopped .stat-value { color: #f59e0b; }
        .stat-card.error .stat-value { color: #ef4444; }
        .hosting-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .hosting-status.status-running { background: #d1fae5; color: #065f46; }
        .hosting-status.status-stopped { background: #fef3c7; color: #92400e; }
        .hosting-status.status-pending { background: #dbeafe; color: #1e40af; }
        .hosting-status.status-error { background: #fee2e2; color: #991b1b; }
        .hosting-status.status-unknown { background: #f3f4f6; color: #4b5563; }
        .health-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .health-status.status-healthy { background: #d1fae5; color: #065f46; }
        .health-status.status-unhealthy { background: #fee2e2; color: #991b1b; }
        .health-status.status-unknown { background: #f3f4f6; color: #4b5563; }
        .filter-bar {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
        }
        .filter-bar .nx-input {
            flex: 1;
            max-width: 300px;
        }
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .action-buttons .nx-btn {
            padding: 4px 8px;
            font-size: 12px;
        }
        .detail-section {
            margin-bottom: 20px;
        }
        .detail-section h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--nx-text-primary);
            border-bottom: 1px solid var(--nx-border-color);
            padding-bottom: 8px;
        }
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .detail-item {
            display: flex;
            justify-content: space-between;
        }
        .detail-item .label {
            color: var(--nx-text-secondary);
        }
        .detail-item .value {
            font-weight: 500;
        }
        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .log-entry {
            margin-bottom: 4px;
        }
        .log-entry.info { color: #4fc3f7; }
        .log-entry.warn { color: #ffb74d; }
        .log-entry.error { color: #ef5350; }
    </style>
</head>
<body>
    <div class="nx-page">
        <aside class="nx-page__sidebar">
            <div class="nx-p-4 nx-mb-4">
                <h1 class="nx-text-lg nx-font-bold" style="display: flex; align-items: center; gap: 8px;">
                    <i class="ri-bolt-line"></i> SkillCenter
                </h1>
            </div>
            <ul class="nav-menu" id="nav-menu"></ul>
        </aside>
        
        <main class="nx-page__content">
            <header class="nx-page__header">
                <div class="nx-flex nx-items-center nx-gap-3">
                    <button class="nx-btn nx-btn--ghost nx-btn--icon" data-nx-sidebar-toggle>
                        <i class="ri-menu-line"></i>
                    </button>
                    <h2 class="nx-text-lg nx-font-semibold">实例管理</h2>
                </div>
                <div class="nx-flex nx-items-center nx-gap-3">
                    <button class="nx-btn nx-btn--primary" onclick="openAddHostingModal()">
                        <i class="ri-add-line"></i> 创建实例
                    </button>
                    <button class="nx-btn nx-btn--ghost nx-btn--icon" data-nx-theme-toggle>
                        <i class="ri-sun-line"></i>
                    </button>
                </div>
            </header>
            
            <div class="nx-page__main">
                <div class="nx-container">
                    <div class="stats-grid">
                        <div class="stat-card total">
                            <div class="stat-value" id="totalInstances">0</div>
                            <div class="stat-label">总实例</div>
                        </div>
                        <div class="stat-card running">
                            <div class="stat-value" id="runningInstances">0</div>
                            <div class="stat-label">运行中</div>
                        </div>
                        <div class="stat-card stopped">
                            <div class="stat-value" id="stoppedInstances">0</div>
                            <div class="stat-label">已停止</div>
                        </div>
                        <div class="stat-card error">
                            <div class="stat-value" id="errorInstances">0</div>
                            <div class="stat-label">异常</div>
                        </div>
                    </div>
                    
                    <div class="nx-card nx-mb-4">
                        <div class="nx-card__body">
                            <div class="filter-bar">
                                <input type="text" id="hostingSearch" class="nx-input" placeholder="搜索实例名称或ID...">
                                <select id="statusFilter" class="nx-input" style="width: 150px;">
                                    <option value="">全部状态</option>
                                    <option value="running">运行中</option>
                                    <option value="stopped">已停止</option>
                                    <option value="error">异常</option>
                                </select>
                                <button class="nx-btn nx-btn--primary" id="btnSearchHosting">
                                    <i class="ri-search-line"></i> 搜索
                                </button>
                                <button class="nx-btn nx-btn--ghost" id="btnResetFilters">
                                    <i class="ri-refresh-line"></i> 重置
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="nx-card">
                        <div class="nx-card__header">
                            <h3 class="nx-card__title">托管实例列表</h3>
                        </div>
                        <div class="nx-card__body">
                            <div class="nx-table-container">
                                <table class="nx-table nx-table--striped">
                                    <thead>
                                        <tr>
                                            <th>实例ID</th>
                                            <th>实例名称</th>
                                            <th>关联技能</th>
                                            <th>状态</th>
                                            <th>健康状态</th>
                                            <th>创建时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="hostingTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div id="hostingModal" class="modal" style="display: none;">
        <div class="modal-content" style="width: 600px;">
            <div class="modal-header">
                <h3 id="modalTitle">添加托管实例</h3>
                <button class="modal-close" onclick="closeHostingModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="hostingId">
                <div class="nx-form-group nx-mb-4">
                    <label class="nx-label">实例名称 <span style="color: red;">*</span></label>
                    <input type="text" id="hostingName" class="nx-input" placeholder="请输入实例名称">
                </div>
                <div class="nx-form-group nx-mb-4">
                    <label class="nx-label">关联技能 <span style="color: red;">*</span></label>
                    <select id="skillId" class="nx-input">
                        <option value="">请选择技能</option>
                    </select>
                </div>
                <div class="nx-form-group nx-mb-4">
                    <label class="nx-label">描述</label>
                    <textarea id="hostingDescription" class="nx-input" rows="3" placeholder="请输入描述"></textarea>
                </div>
                <div class="nx-form-group nx-mb-4">
                    <label class="nx-label">初始状态</label>
                    <select id="hostingStatus" class="nx-input">
                        <option value="stopped">已停止</option>
                        <option value="running">运行中</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="nx-btn nx-btn--ghost" onclick="closeHostingModal()">取消</button>
                <button class="nx-btn nx-btn--primary" onclick="submitHostingForm()">保存</button>
            </div>
        </div>
    </div>
    
    <div id="instanceDetailModal" class="modal" style="display: none;">
        <div class="modal-content" style="width: 800px;">
            <div class="modal-header">
                <h3>实例详情</h3>
                <button class="modal-close" onclick="closeDetailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-section">
                    <h4>基本信息</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="label">实例ID:</span>
                            <span class="value" id="detailId">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">实例名称:</span>
                            <span class="value" id="detailName">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">关联技能:</span>
                            <span class="value" id="detailSkill">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">状态:</span>
                            <span class="value" id="detailStatus">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">创建时间:</span>
                            <span class="value" id="detailCreatedAt">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">健康状态:</span>
                            <span class="value" id="detailHealth">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4>资源配置</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="label">CPU限制:</span>
                            <span class="value" id="detailCpu">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">内存限制:</span>
                            <span class="value" id="detailMemory">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">当前副本:</span>
                            <span class="value" id="detailReplicas">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">最大副本:</span>
                            <span class="value" id="detailMaxReplicas">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4>网络配置</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="label">主机:</span>
                            <span class="value" id="detailHost">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">端口:</span>
                            <span class="value" id="detailPort">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">协议:</span>
                            <span class="value" id="detailProtocol">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">端点:</span>
                            <span class="value" id="detailEndpoint">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4>执行日志</h4>
                    <div class="log-container" id="detailLogs">
                        <div class="log-entry info">[INFO] 暂无日志记录</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="nx-btn nx-btn--ghost" onclick="closeDetailModal()">关闭</button>
                <button class="nx-btn nx-btn--success" id="detailStartBtn" onclick="startFromDetail()">启动</button>
                <button class="nx-btn nx-btn--warning" id="detailStopBtn" onclick="stopFromDetail()">停止</button>
                <button class="nx-btn nx-btn--primary" onclick="restartFromDetail()">重启</button>
            </div>
        </div>
    </div>
    
    <div id="scaleModal" class="modal" style="display: none;">
        <div class="modal-content" style="width: 400px;">
            <div class="modal-header">
                <h3>扩缩容配置</h3>
                <button class="modal-close" onclick="closeScaleModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="scaleInstanceId">
                <div class="nx-form-group nx-mb-4">
                    <label class="nx-label">当前副本数</label>
                    <input type="text" id="currentReplicas" class="nx-input" readonly>
                </div>
                <div class="nx-form-group nx-mb-4">
                    <label class="nx-label">目标副本数</label>
                    <input type="number" id="targetReplicas" class="nx-input" min="0" max="10" value="1">
                </div>
                <div class="nx-alert nx-alert--info">
                    <i class="ri-information-line"></i>
                    <span>副本数范围: 0-10，设置为0等同于停止实例</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="nx-btn nx-btn--ghost" onclick="closeScaleModal()">取消</button>
                <button class="nx-btn nx-btn--primary" onclick="submitScale()">确认扩缩容</button>
            </div>
        </div>
    </div>
    
    <script src="/skillcenter/console/js/theme-manager.js"></script>
    <script src="/skillcenter/console/js/nexus-menu.js"></script>
    <script src="/skillcenter/console/js/utils.js"></script>
    <script src="/skillcenter/console/js/remote-hosting.js"></script>
    <script src="/skillcenter/console/js/page-init.js" data-auto-init></script>
</body>
</html>
