# 管理员指南

## 1. 系统概述

Nexus 是一个基于 ooderAgent 架构的 P2P AI 能力分发枢纽产品，采用 MIT 开源协议。本指南旨在帮助系统管理员了解如何配置、管理和维护 Nexus 系统，确保系统的稳定运行和最佳性能。

### SDK 0.6.6 与示例程序说明

SDK 0.6.6 实现了完整的 ooderAgent 协议，为 Nexus 提供了稳定的底层通信能力。Nexus 在 SDK 基础的通讯和能力管理上，针对常见的路由器安装、智能设备安装提供了网络和路由管理示例页面，同时针对家庭网关的特殊设备也提供了相应的开发示例。

开发者可以通过 skillsCenter 下载相应的 skills 插件，安装在自己的路由器或网关上，就可以有针对性地进行开发，使其支持跨生态的 AI 分发服务。

## 2. 系统架构

### 2.1 核心组件
- **ooderAgent**：提供 P2P 网络通信、服务发现等基础功能
- **Nexus**：基于 ooderAgent 构建的 AI 能力分发枢纽
- **MCP Agent**：主控节点，负责协调和管理

### 2.2 部署模式
- **单节点部署**：适用于测试和小规模使用
- **多节点部署**：适用于生产环境，提供高可用性
- **混合部署**：结合云服务和本地部署

## 3. 系统配置

### 3.1 配置文件
主要配置文件为 `application.yml`，位于 `src/main/resources/` 目录。

### 3.2 核心配置项

#### 3.2.1 服务器配置
```yaml
server:
  port: 8091  # 服务端口
  servlet:
    context-path: /  # 上下文路径
```

#### 3.2.2 应用配置
```yaml
spring:
  application:
    name: ooder-nexus  # 应用名称
```

#### 3.2.3 Agent 配置
```yaml
ooder:
  agent:
    id: "nexus-001"  # Agent ID
    name: "Nexus"  # Agent 名称
    type: "nexus"  # Agent 类型
    description: "P2P AI Capability Distribution Hub"  # 描述
```

#### 3.2.4 P2P 网络配置
```yaml
ooder:
  network:
    mode: "p2p"  # 网络模式
    discovery:
      enabled: true  # 是否启用发现
      interval: 30000  # 发现间隔（毫秒）
    security:
      enabled: true  # 是否启用安全
      encryption: "AES-256"  # 加密方式
  p2p:
    port: 9876  # P2P 端口
    host: 0.0.0.0  # 绑定地址
    timeout: 30000  # 超时时间（毫秒）
    retry: 3  # 重试次数
    max-nodes: 100  # 最大节点数
```

#### 3.2.5 技能配置
```yaml
ooder:
  skill:
    base-package: "net.ooder.nexus.skill"  # 技能基础包
    auto-discovery: true  # 是否自动发现技能
```

#### 3.2.6 存储配置
```yaml
ooder:
  storage:
    type: "local"  # 存储类型
    local:
      root-path: "./data/storage"  # 存储根路径
      cache-path: "./data/cache"  # 缓存路径
      temp-path: "./data/temp"  # 临时文件路径
    version:
      enabled: true  # 是否启用版本控制
      max-versions: 10  # 最大版本数
    hash:
      algorithm: "MD5"  # 哈希算法
    cleanup:
      enabled: true  # 是否启用清理
      interval: 86400  # 清理间隔（秒）
```

## 4. 系统安装与部署

### 4.1 环境准备

#### 4.1.1 硬件要求
- **CPU**：至少 2 核心
- **内存**：至少 2GB，推荐 4GB+
- **磁盘**：至少 500MB，推荐 2GB+
- **网络**：稳定的网络连接

#### 4.1.2 软件要求
- **Java**：JDK 8 或更高版本
- **Maven**：3.6 或更高版本（仅源码构建需要）
- **操作系统**：Windows、Linux、macOS

### 4.2 安装步骤

#### 4.2.1 从源码构建
1. **克隆代码仓库**
   ```bash
   git clone https://gitee.com/ooderCN/ooder-nexus.git
   cd ooder-nexus
   ```

2. **编译打包**
   ```bash
   mvn clean package
   ```

3. **部署**
   将生成的 JAR 文件复制到部署目录。

#### 4.2.2 容器化部署
1. **构建 Docker 镜像**
   ```bash
   docker build -t ooder-nexus:latest .
   ```

2. **运行容器**
   ```bash
   docker run -d -p 8091:8091 --name ooder-nexus ooder-nexus:latest
   ```

### 4.3 服务管理

#### 4.3.1 启动服务
```bash
# 启动服务
java -jar independent-nexus-0.6.6.jar

# 后台运行
nohup java -jar independent-nexus-0.6.6.jar > ooder-nexus.log 2>&1 &
```

#### 4.3.2 停止服务
```bash
# 查找进程
ps aux | grep independent-nexus

# 终止进程
kill <PID>
```

#### 4.3.3 重启服务
```bash
# 停止服务
kill <PID>

# 启动服务
java -jar independent-nexus-0.6.6.jar
```

## 5. 网络管理

### 5.1 节点管理

#### 5.1.1 节点发现
- **自动发现**：系统会自动发现网络中的其他节点
- **手动添加**：通过管理界面手动添加节点

#### 5.1.2 节点监控
- **状态监控**：实时监控节点状态
- **健康检查**：定期检查节点健康状况
- **告警机制**：节点异常时触发告警

### 5.2 网络拓扑

#### 5.2.1 拓扑可视化
通过管理界面查看网络拓扑结构，了解节点间的连接关系。

#### 5.2.2 链路管理
- **链路创建**：建立节点间的通信链路
- **链路监控**：监控链路状态和性能
- **链路优化**：优化网络拓扑结构

### 5.3 网络安全

#### 5.3.1 通信加密
- **AES-256 加密**：保护节点间通信
- **证书管理**：管理 TLS/SSL 证书

#### 5.3.2 访问控制
- **防火墙规则**：配置网络访问规则
- **IP 白名单**：限制允许访问的 IP
- **认证机制**：节点身份认证

## 6. 存储管理

### 6.1 存储架构

#### 6.1.1 存储类型
- **本地存储**：基于本地文件系统
- **网络存储**：支持 NAS、SAN 等网络存储
- **对象存储**：支持 S3 兼容的对象存储

#### 6.1.2 目录结构
```
./data/
├── storage/  # 主存储目录
├── cache/    # 缓存目录
└── temp/     # 临时文件目录
```

### 6.2 存储配置

#### 6.2.1 本地存储配置
```yaml
ooder:
  storage:
    type: "local"
    local:
      root-path: "./data/storage"
      cache-path: "./data/cache"
      temp-path: "./data/temp"
```

#### 6.2.2 存储优化
- **磁盘配额**：设置存储空间限制
- **文件压缩**：启用文件压缩
- **缓存策略**：优化缓存使用

### 6.3 数据备份

#### 6.3.1 备份策略
- **定期备份**：设置自动备份计划
- **增量备份**：仅备份变更数据
- **异地备份**：存储备份到不同位置

#### 6.3.2 备份操作
1. **手动备份**
   ```bash
   # 备份存储目录
   tar -czf ooder-nexus-backup-$(date +%Y%m%d).tar.gz ./data/storage
   ```

2. **自动备份**
   配置定时任务，定期执行备份操作。

#### 6.3.3 恢复操作
1. **停止服务**
2. **恢复备份**
   ```bash
   # 恢复备份
   tar -xzf ooder-nexus-backup-20251104.tar.gz -C ./
   ```
3. **启动服务**

## 7. 技能管理

### 7.1 技能发布

#### 7.1.1 发布流程
1. **技能开发**：开发符合规范的 AI 技能
2. **技能测试**：测试技能功能和性能
3. **技能发布**：通过管理界面或 API 发布技能

#### 7.1.2 发布权限
- **管理员**：可以发布和管理所有技能
- **普通用户**：只能发布和管理自己的技能

### 7.2 技能监控

#### 7.2.1 执行监控
- **执行统计**：监控技能执行次数和成功率
- **性能监控**：监控技能执行时间和资源使用
- **错误监控**：监控技能执行错误

#### 7.2.2 技能治理
- **质量评估**：评估技能质量和可靠性
- **安全审计**：审计技能的安全性
- **生命周期管理**：管理技能的版本和更新

### 7.3 技能市场管理

#### 7.3.1 市场配置
- **分类管理**：管理技能分类
- **推荐系统**：配置技能推荐算法
- **评分系统**：配置技能评分机制

#### 7.3.2 市场监控
- **下载统计**：监控技能下载次数
- **用户评价**：管理用户评价和反馈
- **趋势分析**：分析技能使用趋势

## 8. 系统监控

### 8.1 监控指标

#### 8.1.1 系统指标
- **CPU 使用率**：系统 CPU 使用情况
- **内存使用率**：系统内存使用情况
- **磁盘使用率**：存储磁盘使用情况
- **网络流量**：网络输入/输出流量

#### 8.1.2 应用指标
- **请求数**：API 请求数量
- **响应时间**：API 响应时间
- **错误率**：API 错误率
- **技能执行**：技能执行统计

#### 8.1.3 网络指标
- **节点状态**：网络节点状态
- **链路质量**：节点间链路质量
- **消息延迟**：消息传递延迟
- **网络拓扑**：网络拓扑变化

### 8.2 告警系统

#### 8.2.1 告警配置
- **阈值设置**：设置监控指标阈值
- **告警级别**：配置告警严重程度
- **通知方式**：配置告警通知方式

#### 8.2.2 告警处理
- **告警触发**：指标超过阈值时触发告警
- **告警通知**：通过邮件、短信等方式通知
- **告警处理**：处理和解决告警问题
- **告警记录**：记录告警历史和处理结果

### 8.3 日志管理

#### 8.3.1 日志配置
```yaml
logging:
  level:
    root: info  # 根日志级别
    net.ooder: debug  # 应用日志级别
  file:
    name: logs/system.log  # 日志文件
```

#### 8.3.2 日志类型
- **系统日志**：`logs/system.log`
- **错误日志**：`logs/error.log`
- **审计日志**：`logs/audit.log`

#### 8.3.3 日志轮转
- **大小轮转**：日志文件达到一定大小时轮转
- **时间轮转**：按时间周期轮转日志
- **保留策略**：设置日志保留时间

## 9. 安全管理

### 9.1 认证与授权

#### 9.1.1 认证机制
- **基于 KEY 的认证**：使用预共享密钥
- **证书认证**：使用 TLS/SSL 证书
- **令牌认证**：使用访问令牌

#### 9.1.2 授权管理
- **角色基础访问控制**：基于角色分配权限
- **细粒度权限**：针对具体资源的权限控制
- **权限审计**：审计权限使用情况

### 9.2 网络安全

#### 9.2.1 防火墙配置
- **入站规则**：限制外部访问
- **出站规则**：限制内部访问外部
- **DMZ 配置**：配置隔离区

#### 9.2.2 加密通信
- **TLS/SSL**：加密 HTTP 通信
- **AES-256**：加密 P2P 通信
- **密钥管理**：安全管理加密密钥

### 9.3 数据安全

#### 9.3.1 数据保护
- **数据加密**：加密存储敏感数据
- **数据脱敏**：处理敏感信息
- **数据备份**：定期备份数据

#### 9.3.2 安全审计
- **访问审计**：记录系统访问情况
- **操作审计**：记录用户操作
- **合规检查**：检查安全合规性

## 10. 性能优化

### 10.1 系统优化

#### 10.1.1 JVM 优化
- **内存配置**：调整 JVM 内存参数
  ```bash
  java -Xms2G -Xmx4G -jar independent-nexus-0.6.6.jar
  ```

- **垃圾回收**：选择合适的垃圾回收器
  ```bash
  java -XX:+UseG1GC -jar independent-nexus-0.6.6.jar
  ```

#### 10.1.2 操作系统优化
- **文件系统**：选择合适的文件系统
- **网络调优**：优化网络参数
- **内核参数**：调整系统内核参数

### 10.2 应用优化

#### 10.2.1 代码优化
- **性能分析**：使用性能分析工具
- **热点优化**：优化性能热点
- **内存泄漏**：检测和修复内存泄漏

#### 10.2.2 配置优化
- **连接池**：优化数据库连接池
- **缓存**：合理使用缓存
- **线程池**：优化线程池配置

### 10.3 网络优化

#### 10.3.1 P2P 网络优化
- **节点选择**：选择最优节点
- **消息路由**：优化消息路由算法
- **带宽管理**：合理分配带宽

#### 10.3.2 负载均衡
- **节点负载**：监控和平衡节点负载
- **请求分发**：优化请求分发策略
- **故障转移**：配置故障转移机制

## 11. 故障处理

### 11.1 常见故障

#### 11.1.1 服务启动失败
- **可能原因**：端口被占用、配置错误、依赖缺失
- **解决方案**：检查端口、验证配置、安装依赖

#### 11.1.2 节点无法发现
- **可能原因**：网络隔离、防火墙阻止、配置错误
- **解决方案**：检查网络、配置防火墙、验证 P2P 配置

#### 11.1.3 技能执行失败
- **可能原因**：参数错误、依赖缺失、权限不足
- **解决方案**：检查参数、安装依赖、验证权限

#### 11.1.4 存储问题
- **可能原因**：磁盘空间不足、权限错误、文件系统损坏
- **解决方案**：清理空间、修复权限、检查文件系统

### 11.2 故障诊断

#### 11.2.1 日志分析
- **系统日志**：分析 `logs/system.log`
- **错误日志**：分析 `logs/error.log`
- **应用日志**：分析应用特定日志

#### 11.2.2 监控分析
- **指标分析**：分析监控指标趋势
- **告警分析**：分析告警触发原因
- **性能分析**：分析系统性能瓶颈

#### 11.2.3 网络诊断
- **网络连通性**：检查网络连通性
- **节点状态**：检查节点状态
- **链路质量**：检查链路质量

### 11.3 故障恢复

#### 11.3.1 服务恢复
- **重启服务**：重启故障服务
- **恢复配置**：恢复正确配置
- **修复依赖**：修复缺失依赖

#### 11.3.2 数据恢复
- **从备份恢复**：使用备份恢复数据
- **数据修复**：修复损坏数据
- **一致性检查**：检查数据一致性

#### 11.3.3 网络恢复
- **重建链路**：重建网络链路
- **重启节点**：重启故障节点
- **拓扑重构**：重构网络拓扑

## 12. 系统升级

### 12.1 升级策略

#### 12.1.1 版本管理
- **版本命名**：遵循语义化版本规范
- **发布计划**：制定定期发布计划
- **升级路径**：定义版本升级路径

#### 12.1.2 升级类型
- **补丁升级**：修复 bug 和安全问题
- ** minor 升级**：添加新功能，保持向后兼容
- ** major 升级**：重大变更，可能不兼容

### 12.2 升级步骤

#### 12.2.1 准备工作
- **备份数据**：备份所有重要数据
- **测试环境**：在测试环境验证升级
- **升级文档**：阅读升级文档和发布说明

#### 12.2.2 执行升级
1. **停止服务**
   ```bash
   kill <PID>
   ```

2. **备份配置**
   ```bash
   cp application.yml application.yml.backup
   ```

3. **替换文件**
   ```bash
   # 替换 JAR 文件
   cp new-independent-nexus-0.6.6.jar independent-nexus-0.6.6.jar
   ```

4. **更新配置**
   ```bash
   # 根据需要更新配置文件
   ```

5. **启动服务**
   ```bash
   java -jar independent-nexus-0.6.6.jar
   ```

6. **验证升级**
   - 检查服务状态
   - 验证功能正常
   - 检查日志错误

### 12.3 回滚策略

#### 12.3.1 回滚条件
- **升级失败**：服务无法启动
- **功能异常**：核心功能异常
- **性能下降**：系统性能严重下降

#### 12.3.2 回滚步骤
1. **停止服务**
   ```bash
   kill <PID>
   ```

2. **恢复文件**
   ```bash
   # 恢复旧版本 JAR 文件
   cp independent-nexus-0.6.6.jar.bak independent-nexus-0.6.6.jar
   ```

3. **恢复配置**
   ```bash
   # 恢复备份的配置
   cp application.yml.backup application.yml
   ```

4. **启动服务**
   ```bash
   java -jar independent-nexus-0.6.6.jar
   ```

5. **验证回滚**
   - 检查服务状态
   - 验证功能正常
   - 检查数据完整性

## 13. 灾难恢复

### 13.1 灾难计划

#### 13.1.1 风险评估
- **识别风险**：识别可能的灾难事件
- **影响分析**：分析灾难对系统的影响
- **恢复目标**：定义恢复时间和点目标

#### 13.1.2 恢复策略
- **备份策略**：制定数据备份策略
- **恢复流程**：定义灾难恢复流程
- **角色责任**：分配灾难恢复角色和责任

### 13.2 恢复演练

#### 13.2.1 演练计划
- **定期演练**：定期执行恢复演练
- **场景模拟**：模拟不同灾难场景
- **评估结果**：评估演练结果和改进点

#### 13.2.2 演练步骤
1. **准备演练**：制定演练计划和场景
2. **执行演练**：按照计划执行恢复流程
3. **评估结果**：评估恢复时间和数据完整性
4. **改进计划**：根据演练结果改进恢复计划

### 13.3 恢复执行

#### 13.3.1 灾难响应
- **启动响应**：启动灾难响应计划
- **评估情况**：评估灾难影响范围
- **激活团队**：激活灾难恢复团队

#### 13.3.2 恢复执行
1. **环境准备**：准备恢复环境
2. **数据恢复**：从备份恢复数据
3. **服务恢复**：恢复系统服务
4. **验证恢复**：验证系统功能和数据完整性

#### 13.3.3 恢复后处理
- **系统验证**：全面验证系统功能
- **数据验证**：验证数据一致性和完整性
- **文档更新**：更新灾难恢复文档
- **经验总结**：总结恢复经验和改进点

## 14. 合规与审计

### 14.1 合规要求

#### 14.1.1 数据保护
- **数据隐私**：保护用户数据隐私
- **数据安全**：确保数据安全存储和传输
- **数据保留**：遵守数据保留政策

#### 14.1.2 安全合规
- **安全标准**：遵循安全标准和最佳实践
- **漏洞管理**：定期漏洞扫描和修复
- **渗透测试**：定期进行渗透测试

### 14.2 审计流程

#### 14.2.1 审计计划
- **审计范围**：定义审计范围和目标
- **审计频率**：制定审计频率
- **审计标准**：确定审计标准和方法

#### 14.2.2 审计执行
- **系统审计**：审计系统配置和状态
- **安全审计**：审计安全控制和措施
- **操作审计**：审计用户操作和系统事件

#### 14.2.3 审计报告
- **发现问题**：记录审计发现的问题
- **风险评估**：评估问题的风险等级
- **改进建议**：提出改进建议
- **跟踪整改**：跟踪问题整改情况

## 15. 附录

### 15.1 命令参考

#### 15.1.1 服务管理命令
| 命令 | 描述 | 示例 |
|------|------|------|
| 启动服务 | 启动 Nexus 服务 | `java -jar independent-nexus-0.6.6.jar` |
| 停止服务 | 停止 Nexus 服务 | `kill <PID>` |
| 查看状态 | 查看服务状态 | `ps aux | grep independent-nexus` |
| 查看日志 | 查看服务日志 | `tail -f logs/system.log` |

#### 15.1.2 网络管理命令
| 命令 | 描述 | 示例 |
|------|------|------|
| 查看网络 | 查看网络连接 | `netstat -an` |
| 检查端口 | 检查端口占用 | `lsof -i :8091` |
| 测试连接 | 测试网络连接 | `ping <ip>` |

#### 15.1.3 存储管理命令
| 命令 | 描述 | 示例 |
|------|------|------|
| 查看磁盘 | 查看磁盘使用情况 | `df -h` |
| 查看目录 | 查看目录大小 | `du -sh ./data` |
| 备份数据 | 备份存储数据 | `tar -czf backup.tar.gz ./data` |

### 15.2 配置参考

#### 15.2.1 完整配置示例
```yaml
server:
  port: 8091

spring:
  application:
    name: ooder-nexus

ooder:
  agent:
    id: "nexus-001"
    name: "ooderNexus"
    type: "nexus"
    description: "P2P AI Capability Distribution Hub"
  network:
    mode: "p2p"
    discovery:
      enabled: true
      interval: 30000
    security:
      enabled: true
      encryption: "AES-256"
  p2p:
    port: 9876
    host: 0.0.0.0
    timeout: 30000
    retry: 3
    max-nodes: 100
  skill:
    base-package: "net.ooder.nexus.skill"
    auto-discovery: true
  storage:
    type: "local"
    local:
      root-path: "./data/storage"
      cache-path: "./data/cache"
      temp-path: "./data/temp"
    version:
      enabled: true
      max-versions: 10
    hash:
      algorithm: "MD5"
    cleanup:
      enabled: true
      interval: 86400

logging:
  level:
    root: info
    net.ooder: debug
  file:
    name: logs/system.log
```

### 15.3 故障排查流程

#### 15.3.1 服务无法启动
1. **检查端口**：确认端口未被占用
2. **检查配置**：验证配置文件正确性
3. **检查依赖**：确认所有依赖已安装
4. **查看日志**：分析启动日志错误

#### 15.3.2 节点无法通信
1. **检查网络**：确认网络连接正常
2. **检查防火墙**：确认防火墙配置正确
3. **检查配置**：验证 P2P 配置
4. **查看日志**：分析网络错误日志

#### 15.3.3 技能执行失败
1. **检查参数**：验证执行参数正确
2. **检查依赖**：确认技能依赖已安装
3. **检查权限**：验证执行权限
4. **查看日志**：分析执行错误日志

## 16. 总结

本管理员指南提供了 Nexus 系统的配置、管理和维护的全面参考。通过遵循本指南中的最佳实践，系统管理员可以确保 Nexus 系统的稳定运行、最佳性能和安全性。

系统管理是一个持续的过程，需要定期检查、优化和更新。建议管理员定期查看项目文档和社区资源，了解最新的功能和最佳实践。

---

**最后更新时间**：2025-11-04
**版本**：v1.0.0
