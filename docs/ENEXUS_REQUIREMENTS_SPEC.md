# eNexus 团队需求规格说明书

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | eNexus 团队需求规格说明书 |
| 版本 | v0.8.0 |
| 日期 | 2026-02-23 |
| 状态 | 草稿 |
| 团队 | eNexus 企业团队 |

## 2. 需求概述

### 2.1 项目背景

Ooder Agent Platform v0.8.0 架构升级，引入 Scene=Agent 模型，建立 CAP 标准化体系，实现能力驱动的发现协议。eNexus 团队作为企业版 Nexus 团队，负责实现三层发现协调器、mDNS 服务集成和部门级配置中心部署，支持企业级能力共享和管理。

### 2.2 目标

- 实现 UDP 广播发现服务，支持局域网内的 Agent 发现
- 集成 mDNS 协议，支持跨平台服务发现
- 实现三层应用场景的发现协调器，支持个人网络、部门共享和企业管理
- 部署部门级配置中心，支持能力共享配置
- 确保企业级部署的安全性和可靠性

### 2.3 范围

| 功能模块 | 包含 | 不包含 |
|---------|------|--------|
| UDP 发现服务 | UDP 广播、消息编解码、Agent 公告 | 复杂的网络协议栈实现 |
| mDNS 服务集成 | mDNS 服务注册、发现、跨平台支持 | 底层 mDNS 协议实现 |
| 三层发现协调器 | 个人网络管理、部门共享管理、企业中心连接 | 具体业务场景实现 |
| 配置中心部署 | 多租户配置、配置热更新、高可用部署 | 配置中心底层实现 |

## 3. 功能需求

### 3.1 UDP 发现服务

| 功能点 | 描述 | 输入/输出 | 验收标准 |
|--------|------|-----------|----------|
| UDP 广播服务 | 实现 UDP 广播服务，发送和接收发现消息 | 输入：广播配置<br>输出：广播状态 | 成功启动并接收广播消息 |
| 消息编解码 | 实现发现消息的编码和解码 | 输入：消息对象/二进制数据<br>输出：二进制数据/消息对象 | 正确编解码所有消息类型 |
| Agent 公告 | 实现 Agent 公告消息的发送和接收 | 输入：Agent 信息<br>输出：公告结果 | 成功发送公告并接收其他 Agent 公告 |
| CAP 共享消息 | 实现 CAP 共享消息的处理 | 输入：CAP 信息<br>输出：共享结果 | 成功共享和接收 CAP 信息 |
| 发现缓存 | 缓存发现结果，减少重复广播 | 输入：发现结果<br>输出：缓存状态 | 缓存命中率 > 80% |
| 异常处理 | 处理网络异常和消息格式错误 | 输入：异常情况<br>输出：处理结果 | 网络异常后能自动恢复 |

### 3.2 mDNS 服务集成

| 功能点 | 描述 | 输入/输出 | 验收标准 |
|--------|------|-----------|----------|
| mDNS 服务注册 | 注册 Ooder 服务到 mDNS | 输入：服务信息<br>输出：注册结果 | 服务成功注册到 mDNS |
| mDNS 服务发现 | 发现网络中的 Ooder 服务 | 输入：服务类型<br>输出：服务列表 | 成功发现网络中的 Ooder 服务 |
| 跨平台支持 | 支持 Windows/macOS/Linux 平台 | 输入：平台信息<br>输出：支持状态 | 在所有支持的平台上正常工作 |
| 服务类型定义 | 定义 Ooder 服务类型和属性 | 输入：服务属性<br>输出：服务类型 | 服务类型符合 mDNS 规范 |
| 与 UDP 协同 | 与 UDP 发现服务协同工作 | 输入：协同配置<br>输出：协同状态 | 两种发现方式协同工作，避免冲突 |

### 3.3 三层发现协调器

| 功能点 | 描述 | 输入/输出 | 验收标准 |
|--------|------|-----------|----------|
| 个人网络管理 | 管理个人网络内的 Agent 发现 | 输入：网络配置<br>输出：网络状态 | 个人网络内 Agent 发现延迟 < 2s |
| 部门共享管理 | 管理部门内的能力共享 | 输入：部门配置<br>输出：共享状态 | 部门内能力共享正常，权限控制有效 |
| 企业中心连接 | 连接企业级 SkillCenter | 输入：中心配置<br>输出：连接状态 | 成功连接企业 SkillCenter，同步能力信息 |
| 层级自动切换 | 根据网络环境自动切换发现层级 | 输入：环境信息<br>输出：切换结果 | 在不同网络环境下自动切换到合适的层级 |
| 发现结果聚合 | 聚合不同层级的发现结果 | 输入：多源发现结果<br>输出：聚合结果 | 聚合结果完整，无重复 |
| 权限管理 | 管理不同层级的访问权限 | 输入：权限配置<br>输出：权限状态 | 权限控制有效，未授权访问被拒绝 |

### 3.4 配置中心部署

| 功能点 | 描述 | 输入/输出 | 验收标准 |
|--------|------|-----------|----------|
| 多租户配置 | 支持多租户配置管理 | 输入：租户配置<br>输出：配置状态 | 不同租户配置隔离，互不影响 |
| 配置热更新 | 支持配置的热更新，无需重启 | 输入：更新配置<br>输出：更新结果 | 配置更新后立即生效，无需重启服务 |
| 高可用部署 | 支持配置中心的高可用部署 | 输入：部署配置<br>输出：部署状态 | 配置中心集群正常运行，故障自动切换 |
| 配置模板 | 提供配置模板，简化配置管理 | 输入：模板参数<br>输出：配置结果 | 配置模板正确生成配置文件 |
| 部署脚本 | 提供自动化部署脚本 | 输入：部署参数<br>输出：部署结果 | 脚本执行成功，配置中心正常运行 |
| 监控告警 | 监控配置中心状态，提供告警 | 输入：监控配置<br>输出：监控状态 | 配置中心异常时及时告警 |

## 4. 非功能需求

| 需求点 | 描述 | 验收标准 |
|--------|------|----------|
| 性能 | 个人网络发现延迟 < 2s，部门网络发现延迟 < 5s | 性能测试验证 |
| 可靠性 | 配置中心高可用，故障自动切换时间 < 30s | 高可用测试通过 |
| 安全性 | 支持配置加密，访问控制，审计日志 | 安全测试通过 |
| 可扩展性 | 支持配置中心集群水平扩展 | 扩展性测试通过 |
| 兼容性 | 支持 Windows/macOS/Linux 平台 | 兼容性测试通过 |
| 可维护性 | 提供配置管理界面，日志管理 | 维护测试通过 |
| 可监控性 | 提供配置中心和发现服务的监控 | 监控测试通过 |

## 5. 数据需求

### 5.1 数据模型

| 数据模型 | 描述 | 存储方式 |
|---------|------|----------|
| DiscoveryMessage | 发现消息，包含消息类型和内容 | 内存对象 + 网络传输 |
| AgentAnnouncement | Agent 公告消息，包含 Agent 信息 | 内存对象 + 网络传输 |
| CapShareMessage | CAP 共享消息，包含 CAP 信息 | 内存对象 + 网络传输 |
| DiscoveryResult | 发现结果，包含发现的 Agent 和 CAP | 内存缓存 |
| ServiceInfo | mDNS 服务信息，包含服务类型和属性 | 内存对象 + mDNS 注册 |
| NetworkConfig | 网络配置，包含不同层级的网络设置 | 配置文件 |
| TenantConfig | 租户配置，包含租户的配置信息 | 配置中心存储 |

### 5.2 存储需求

| 存储类型 | 用途 | 技术选型 |
|---------|------|----------|
| 配置存储 | 网络配置、租户配置 | 配置中心 (Consul/Etcd) |
| 发现缓存 | 发现结果缓存 | 内存缓存 + Redis |
| 日志存储 | 发现服务日志、配置中心日志 | 文件系统 |
| 监控数据 | 系统运行状态、性能指标 | 时序数据库 (InfluxDB) |

## 6. 范围限定

| 边界 | 说明 |
|------|------|
| 不包含底层网络协议实现 | 只集成和使用现有网络协议库，不实现底层协议 |
| 不包含具体业务场景实现 | 只提供发现和配置基础设施，不实现具体业务逻辑 |
| 不包含企业级认证系统 | 集成现有认证系统，不重新实现 |
| 不包含大规模集群管理 | 支持中小型集群，不支持超大规模部署 |

## 7. 验收标准

### 7.1 功能验收

| 测试项 | 验收标准 |
|--------|----------|
| UDP 发现服务 | 成功启动 UDP 服务，发送和接收广播消息 |
| 消息编解码 | 正确编解码所有消息类型，无格式错误 |
| Agent 公告 | 成功发送和接收 Agent 公告，发现网络中的 Agent |
| CAP 共享 | 成功共享和接收 CAP 信息，能力发现正常 |
| mDNS 集成 | 服务成功注册到 mDNS，能发现网络中的服务 |
| 跨平台支持 | 在 Windows/macOS/Linux 平台上正常工作 |
| 三层发现 | 个人网络、部门共享、企业中心三层发现正常 |
| 层级切换 | 根据网络环境自动切换到合适的发现层级 |
| 配置中心部署 | 配置中心成功部署，支持多租户和热更新 |
| 高可用 | 配置中心集群正常运行，故障自动切换 |

### 7.2 非功能验收

| 测试项 | 验收标准 |
|--------|----------|
| 性能 | 个人网络发现延迟 < 2s，部门网络发现延迟 < 5s |
| 可靠性 | 配置中心故障后 30s 内自动切换到备用节点 |
| 安全性 | 配置加密有效，未授权访问被拒绝，审计日志完整 |
| 可扩展性 | 配置中心集群能水平扩展，支持更多租户 |
| 兼容性 | 在所有支持的平台上正常工作，无平台特定问题 |
| 可维护性 | 配置管理界面操作流畅，日志查询方便 |
| 可监控性 | 监控数据正确采集和展示，异常及时告警 |

## 8. 风险/依赖备注

| 类型 | 关联项 | 内容 | 备注 |
|------|--------|------|------|
| 依赖 | 底层网络库 | UDP 和 mDNS 功能依赖第三方网络库 | 需选择稳定可靠的网络库 |
| 依赖 | 配置中心 | 配置中心功能依赖第三方配置中心产品 | 需选择适合企业环境的配置中心 |
| 风险 | 网络环境 | 不同网络环境可能影响发现效果 | 需进行多网络环境测试 |
| 风险 | 跨平台兼容性 | 不同平台的网络实现可能有差异 | 需在所有支持的平台上测试 |
| 风险 | 企业网络限制 | 企业网络可能有防火墙和安全限制 | 需提供网络要求文档 |
| 风险 | 大规模部署 | 大规模部署时可能面临性能挑战 | 需进行性能测试和优化 |

## 9. 附件

| 附件 | 说明 | 路径 |
|------|------|------|
| CAPABILITY-DISCOVERY-PROTOCOL.md | 能力发现协议规范 | docs/v0.8.0/CAPABILITY-DISCOVERY-PROTOCOL.md |
| ARCHITECTURE-V0.8.0.md | 架构设计总览 | docs/v0.8.0/ARCHITECTURE-V0.8.0.md |
| 配置中心部署文档 | 配置中心部署指南 | docs/deployment/config-center.md |
| 网络要求文档 | 网络环境要求 | docs/deployment/network-requirements.md |