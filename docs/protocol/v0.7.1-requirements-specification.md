# Ooder Agent SDK 0.7.1 需求规格说明书

> 本文档定义了Ooder Agent SDK 0.7.1版本的功能需求规格，作为开发和测试的基准文档。

## 文档信息

- 版本：v0.7.1
- 创建日期：2026-02-17
- 状态：已发布

---

## 一、概述

### 1.1 项目背景

Ooder Agent SDK 0.7.1版本是对0.7.0版本的重要增强，主要完善了核心服务模块，提供了更丰富的API能力，支持Nexus协作场景。

### 1.2 项目目标

1. 实现类型安全的存储服务
2. 提供流式输出的LLM服务
3. 实现发布订阅事件总线
4. 增强网络链路质量监控
5. 实现任务调度服务
6. 增强安全服务支持场景组密钥
7. 实现协议中枢支持

### 1.3 适用范围

- 单机/小团队开发环境
- 企业级生产环境
- P2P个人技能共享场景
- 边缘计算场景
- Nexus协作平台

---

## 二、功能需求

### 2.1 存储服务模块 (StorageService)

#### FR-001: 类型安全存储

| 属性 | 值 |
|------|-----|
| 优先级 | 高 |
| 状态 | ✅ 已实现 |
| 描述 | 提供类型安全的JSON存储能力，支持泛型和TypeReference |

**验收标准：**
1. 支持泛型类型的存取操作
2. 支持TypeReference处理复杂类型
3. 提供同步和异步API
4. 支持批量操作
5. 支持缓存机制

**API定义：**
```java
public interface StorageService {
    String save(String key, Object data);
    <T> Optional<T> load(String key, Class<T> type);
    <T> Optional<T> load(String key, TypeReference<T> typeRef);
    CompletableFuture<String> saveAsync(String key, Object data);
    void saveBatch(Map<String, Object> batch);
    Map<String, Object> loadBatch(List<String> keys);
}
```

### 2.2 LLM服务模块 (LlmService)

#### FR-002: 流式输出支持

| 属性 | 值 |
|------|-----|
| 优先级 | 高 |
| 状态 | ✅ 已实现 |
| 描述 | 支持LLM流式输出，提升用户体验 |

**验收标准：**
1. 支持流式回调输出
2. 支持多模型切换
3. 提供Token计数和统计
4. 支持Embedding生成

**API定义：**
```java
public interface LlmService {
    String chat(ChatRequest request);
    void chatStream(ChatRequest request, 
                    Consumer<String> onChunk, 
                    Consumer<Void> onComplete, 
                    Consumer<Throwable> onError);
    List<String> getAvailableModels();
    int countTokens(String text);
    TokenUsage getTokenUsage();
    float[] embed(String text);
    String chatWithFunctions(ChatRequest request, List<FunctionDef> functions);
}
```

### 2.3 事件总线模块 (EventBus)

#### FR-003: 发布订阅模式

| 属性 | 值 |
|------|-----|
| 优先级 | 高 |
| 状态 | ✅ 已实现 |
| 描述 | 实现发布订阅模式的事件总线 |

**验收标准：**
1. 支持Topic订阅
2. 支持过滤订阅
3. 支持异步发布
4. 支持类型安全的事件处理

**API定义：**
```java
public interface EventBus {
    <T> void publish(String topic, T event);
    <T> CompletableFuture<Void> publishAsync(String topic, T event);
    <T> Subscription subscribe(String topic, Class<T> eventType, Consumer<T> handler);
    <T> Subscription subscribe(String topic, Class<T> eventType, 
                               Predicate<T> filter, Consumer<T> handler);
    void unsubscribe(String subscriptionId);
}
```

### 2.4 网络服务模块 (NetworkService)

#### FR-004: 链路质量监控

| 属性 | 值 |
|------|-----|
| 优先级 | 高 |
| 状态 | ✅ 已实现 |
| 描述 | 提供网络链路管理和质量监控能力 |

**验收标准：**
1. 支持链路创建和管理
2. 支持链路质量监控
3. 支持最优路径计算
4. 支持链路事件监听

**API定义：**
```java
public interface NetworkService {
    LinkInfo createLink(String sourceId, String targetId, LinkType type);
    LinkQualityInfo getLinkQuality(String linkId);
    void enableQualityMonitor(long intervalMs);
    List<LinkInfo> findOptimalPath(String sourceId, String targetId);
    void addLinkListener(LinkListener listener);
}
```

### 2.5 任务调度模块 (TaskScheduler)

#### FR-005: 定时任务调度

| 属性 | 值 |
|------|-----|
| 优先级 | 中 |
| 状态 | ✅ 已实现 |
| 描述 | 提供定时任务调度能力 |

**验收标准：**
1. 支持延迟任务
2. 支持固定频率任务
3. 支持Cron表达式
4. 支持任务持久化

**API定义：**
```java
public interface TaskScheduler {
    String schedule(Runnable task, long delayMs);
    String scheduleAtFixedRate(Runnable task, long initialDelayMs, long periodMs);
    String scheduleWithCron(Runnable task, String cronExpression);
    void cancel(String taskId);
    boolean pause(String taskId);
    boolean resume(String taskId);
    void enablePersistence(StorageService storage);
}
```

### 2.6 安全服务模块 (SecurityService)

#### FR-006: 场景组密钥管理

| 属性 | 值 |
|------|-----|
| 优先级 | 中 |
| 状态 | ✅ 已实现 |
| 描述 | 提供场景组密钥管理和端到端加密 |

**验收标准：**
1. 支持RSA非对称加密
2. 支持数字签名
3. 支持Token管理
4. 支持场景组密钥生成和轮换
5. 支持端到端加密

**API定义：**
```java
public interface SecurityService {
    KeyPair generateKeyPair();
    String encrypt(String data, String publicKey);
    String decrypt(String encryptedData, String privateKey);
    String sign(String data, String privateKey);
    boolean verify(String data, String signature, String publicKey);
    String generateToken(String subject, long expireInMillis);
    TokenInfo validateToken(String token);
    KeyPair generateSceneKey(String sceneId);
    String encryptForPeer(String sceneId, String peerId, String data);
    String decryptFromPeer(String sceneId, String peerId, String encryptedData);
}
```

### 2.7 协议中枢模块 (ProtocolHub)

#### FR-007: 协议注册和路由

| 属性 | 值 |
|------|-----|
| 优先级 | 高 |
| 状态 | ✅ 已实现 |
| 描述 | 提供协议中枢支持，支持动态协议注册和命令路由 |

**验收标准：**
1. 支持动态协议处理器注册
2. 支持命令路由分发
3. 支持协议统计
4. 支持异步命令处理

**API定义：**
```java
public interface ProtocolHub {
    void registerProtocolHandler(String protocolType, ProtocolHandler handler);
    CommandResult handleCommand(CommandPacket packet);
    CompletableFuture<CommandResult> handleCommandAsync(CommandPacket packet);
    ProtocolStats getProtocolStats(String protocolType);
}
```

---

## 三、非功能需求

### 3.1 性能要求

| 指标 | 要求 |
|------|------|
| 存储操作延迟 | < 10ms |
| 事件发布延迟 | < 5ms |
| 加密操作延迟 | < 50ms |
| 任务调度精度 | ±100ms |

### 3.2 可靠性要求

| 指标 | 要求 |
|------|------|
| 服务可用性 | 99.9% |
| 数据持久化 | 支持任务恢复 |
| 错误处理 | 所有异常可捕获 |

### 3.3 安全要求

| 指标 | 要求 |
|------|------|
| 加密算法 | RSA-2048 |
| Token过期 | 可配置 |
| 密钥轮换 | 支持 |

---

## 四、模块实现状态

| 模块 | 接口 | 实现 | 状态 |
|------|------|------|------|
| StorageService | ✅ | ✅ | 完成 |
| LlmService | ✅ | ✅ | 完成 |
| EventBus | ✅ | ✅ | 完成 |
| NetworkService | ✅ | ✅ | 完成 |
| TaskScheduler | ✅ | ✅ | 完成 |
| SecurityService | ✅ | ✅ | 完成 |
| ProtocolHub | ✅ | ✅ | 完成 |

---

## 五、版本历史

| 版本 | 日期 | 变更说明 |
|------|------|---------|
| 0.7.0 | 2026-02-15 | 初始版本，技能闭环设计 |
| 0.7.1 | 2026-02-17 | 新增7个核心服务模块 |

---

**文档维护者**: ooder Team  
**最后更新**: 2026-02-17
