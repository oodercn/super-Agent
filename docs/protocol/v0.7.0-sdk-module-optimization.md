# Ooder Agent SDK v0.7.0 模块结构优化方案

> 本文档基于v0.7.0新特性，对SDK模块划分和包结构进行优化设计。

## 文档信息

- 版本：v0.7.0
- 创建日期：2026-02-15
- 状态：设计中

---

## 一、现有结构分析

### 1.1 当前模块结构

```
net.ooder.sdk/
├── agent/              # Agent核心（MCP/Route/End）
├── async/              # 异步处理
├── command/            # 命令系统
├── config/             # 配置管理
├── examples/           # 示例代码
├── llm/                # LLM集成
├── monitoring/         # 监控告警
├── network/            # 网络通信
├── persistence/        # 持久化
├── route/              # 路由管理
├── security/           # 安全认证
├── skill/              # 技能管理
├── storage/            # 存储服务
├── system/             # 系统工具
├── terminal/           # 终端管理
├── test/               # 测试代码
├── topology/           # 拓扑管理
└── AgentSDK.java       # SDK入口
```

### 1.2 现有结构问题

| 问题 | 描述 | 影响 |
|------|------|------|
| 模块职责不清晰 | system包包含过多不相关功能 | 维护困难 |
| 新特性无归属 | 场景组、故障切换等无处放置 | 扩展困难 |
| 层次结构混乱 | 部分模块层次过深 | 理解困难 |
| 命名不统一 | 部分模块命名不一致 | 使用困难 |

---

## 二、优化原则

### 2.1 分层原则

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           SDK分层架构                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Layer 1: API Layer（对外API层）                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 提供统一的对外接口，隐藏内部实现细节                                    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  Layer 2: Core Layer（核心业务层）                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Agent管理、技能管理、场景管理、能力调用等核心业务                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  Layer 3: Service Layer（服务支撑层）                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 网络、存储、安全、监控等支撑服务                                        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  Layer 4: Infrastructure Layer（基础设施层）                                │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 配置、工具、异常处理等基础设施                                          │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 命名规范

| 规范 | 说明 | 示例 |
|------|------|------|
| 包名小写 | 全部使用小写字母 | `net.ooder.sdk.core` |
| 功能导向 | 包名体现功能 | `skill.packageManager` |
| 层次清晰 | 不超过4层 | `sdk.core.agent` |
| 接口分离 | 接口与实现分离 | `api/` + `impl/` |

---

## 三、优化后的模块结构

### 3.1 顶层模块

```
net.ooder.sdk/
├── api/                 # Layer 1: 对外API
├── core/                # Layer 2: 核心业务
├── service/             # Layer 3: 服务支撑
├── infra/               # Layer 4: 基础设施
├── common/              # 公共模块
└── OoderSDK.java        # SDK入口（重命名）
```

### 3.2 详细模块结构

```
net.ooder.sdk/
│
├── api/                          # Layer 1: 对外API
│   ├── agent/                    # Agent API
│   │   ├── McpAgent.java
│   │   ├── RouteAgent.java
│   │   ├── EndAgent.java
│   │   └── AgentFactory.java
│   ├── skill/                    # Skill API
│   │   ├── SkillPackageManager.java
│   │   ├── SkillRegistry.java
│   │   ├── SkillInstaller.java
│   │   └── SkillCenterClient.java
│   ├── scene/                    # Scene API
│   │   ├── SceneGroupManager.java
│   │   ├── SceneManager.java
│   │   └── CapabilityInvoker.java
│   ├── metadata/                 # Metadata API（新增）
│   │   ├── MetadataQueryService.java
│   │   └── ChangeLogService.java
│   └── OoderSDK.java             # SDK主入口
│
├── core/                         # Layer 2: 核心业务
│   ├── agent/                    # Agent核心实现
│   │   ├── impl/
│   │   │   ├── McpAgentImpl.java
│   │   │   ├── RouteAgentImpl.java
│   │   │   └── EndAgentImpl.java
│   │   ├── model/
│   │   │   ├── AgentConfig.java
│   │   │   ├── AgentState.java
│   │   │   └── AgentRole.java
│   │   └── factory/
│   │       └── AgentFactoryImpl.java
│   │
│   ├── skill/                    # Skill核心实现
│   │   ├── impl/
│   │   │   ├── SkillPackageManagerImpl.java
│   │   │   ├── LocalSkillRegistry.java
│   │   │   └── LocalSkillInstaller.java
│   │   ├── discovery/            # 技能发现（新增）
│   │   │   ├── SkillDiscoverer.java
│   │   │   ├── DiscoveryMethod.java
│   │   │   ├── UdpDiscoverer.java
│   │   │   ├── DhtDiscoverer.java
│   │   │   ├── SkillCenterDiscoverer.java
│   │   │   └── LocalDiscoverer.java
│   │   ├── installer/            # 技能安装
│   │   │   ├── SkillInstaller.java
│   │   │   ├── InstallContext.java
│   │   │   ├── InstallPipeline.java
│   │   │   └── RollbackManager.java
│   │   ├── model/
│   │   │   ├── SkillPackage.java
│   │   │   ├── SkillIdentity.java
│   │   │   ├── SkillManifest.java
│   │   │   ├── SkillStatus.java
│   │   │   └── InstallRequest.java
│   │   └── lifecycle/            # 生命周期（新增）
│   │       ├── SkillLifecycle.java
│   │       └── SkillState.java
│   │
│   ├── scene/                    # Scene核心实现
│   │   ├── impl/
│   │   │   ├── SceneGroupManagerImpl.java
│   │   │   └── SceneManagerImpl.java
│   │   ├── group/                # 场景组（新增）
│   │   │   ├── SceneGroup.java
│   │   │   ├── SceneGroupKey.java
│   │   │   ├── MemberRole.java
│   │   │   └── KeyShareManager.java
│   │   ├── failover/             # 故障切换（新增）
│   │   │   ├── FailoverManager.java
│   │   │   ├── HeartbeatMonitor.java
│   │   │   ├── RoleChanger.java
│   │   │   └── FailoverStrategy.java
│   │   ├── capability/           # 能力管理
│   │   │   ├── Capability.java
│   │   │   ├── CapabilityProvider.java
│   │   │   ├── CapabilityConsumer.java
│   │   │   └── CapabilityRegistry.java
│   │   └── model/
│   │       ├── SceneDefinition.java
│   │       ├── SceneMember.java
│   │       └── SceneSnapshot.java
│   │
│   ├── metadata/                 # 元数据核心（新增）
│   │   ├── impl/
│   │   │   ├── MetadataQueryServiceImpl.java
│   │   │   └── ChangeLogServiceImpl.java
│   │   ├── model/
│   │   │   ├── FourDimensionMetadata.java
│   │   │   ├── WhoMetadata.java
│   │   │   ├── WhereMetadata.java
│   │   │   ├── WhenMetadata.java
│   │   │   ├── WhatMetadata.java
│   │   │   └── ChangeRecord.java
│   │   └── observer/
│   │       ├── MetadataObserver.java
│   │       └── ChangeNotifier.java
│   │
│   └── command/                  # 命令系统
│       ├── api/
│       │   ├── Command.java
│       │   ├── CommandTask.java
│       │   └── CommandHandler.java
│       ├── impl/
│       │   ├── CommandExecutor.java
│       │   └── CommandDispatcher.java
│       ├── model/
│       │   ├── CommandResult.java
│       │   └── CommandType.java
│       └── tasks/
│           └── ... (各种CommandTask)
│
├── service/                      # Layer 3: 服务支撑
│   ├── network/                  # 网络服务
│   │   ├── udp/
│   │   │   ├── UdpServer.java
│   │   │   ├── UdpClient.java
│   │   │   └── PacketHandler.java
│   │   ├── p2p/
│   │   │   ├── DhtNode.java
│   │   │   ├── GossipProtocol.java
│   │   │   └── PeerDiscovery.java
│   │   ├── link/
│   │   │   ├── LinkManager.java
│   │   │   ├── LinkTable.java
│   │   │   └── LinkMonitor.java
│   │   └── route/
│   │       ├── RouteManager.java
│   │       ├── RouteCalculator.java
│   │       └── RouteDiscoverer.java
│   │
│   ├── storage/                  # 存储服务
│   │   ├── vfs/
│   │   │   ├── VfsManager.java
│   │   │   ├── VfsClient.java
│   │   │   └── VfsPermission.java
│   │   ├── persistence/
│   │   │   ├── PersistenceService.java
│   │   │   ├── JsonStorage.java
│   │   │   └── StorageManager.java
│   │   └── cache/
│   │       ├── CacheManager.java
│   │       └── CacheStrategy.java
│   │
│   ├── security/                 # 安全服务
│   │   ├── auth/
│   │   │   ├── AuthManager.java
│   │   │   ├── AuthProvider.java
│   │   │   └── TokenManager.java
│   │   ├── crypto/
│   │   │   ├── KeyManager.java
│   │   │   ├── KeyShare.java
│   │   │   └── CipherService.java
│   │   ├── cert/
│   │   │   ├── CertificateManager.java
│   │   │   └── SceneCA.java
│   │   └── permission/
│   │       ├── PermissionManager.java
│   │       └── RoleManager.java
│   │
│   ├── monitoring/               # 监控服务
│   │   ├── health/
│   │   │   ├── HealthMonitor.java
│   │   │   └── HealthStatus.java
│   │   ├── metrics/
│   │   │   ├── MetricsCollector.java
│   │   │   └── MetricsReporter.java
│   │   └── alert/
│   │       ├── AlertManager.java
│   │       └── AlertRule.java
│   │
│   └── llm/                      # LLM服务
│       ├── LlmClient.java
│       ├── LlmService.java
│       └── LlmConfig.java
│
├── infra/                        # Layer 4: 基础设施
│   ├── config/                   # 配置管理
│   │   ├── SDKConfiguration.java
│   │   ├── ConfigLoader.java
│   │   └── ConfigProperties.java
│   ├── exception/                # 异常处理
│   │   ├── SDKException.java
│   │   ├── ErrorCode.java
│   │   └── ErrorHandler.java
│   ├── utils/                    # 工具类
│   │   ├── JsonUtils.java
│   │   ├── NetUtils.java
│   │   ├── FileUtils.java
│   │   └── ValidationUtils.java
│   ├── retry/                    # 重试机制
│   │   ├── RetryManager.java
│   │   └── RetryStrategy.java
│   ├── async/                    # 异步处理
│   │   ├── AsyncExecutor.java
│   │   └── AsyncTask.java
│   └── lifecycle/                # 生命周期管理
│       ├── LifecycleManager.java
│       └── ShutdownHook.java
│
├── common/                       # 公共模块
│   ├── constants/                # 常量定义
│   │   ├── SDKConstants.java
│   │   ├── ErrorCodes.java
│   │   └── Defaults.java
│   ├── enums/                    # 枚举定义
│   │   ├── AgentType.java
│   │   ├── SkillStatus.java
│   │   ├── SceneType.java
│   │   ├── MemberRole.java
│   │   └── ChangeType.java
│   └── annotation/               # 注解定义
│       ├── Command.java
│       └── Skill.java
│
└── OoderSDK.java                 # SDK主入口
```

---

## 四、模块迁移映射

### 4.1 迁移对照表

| 原路径 | 新路径 | 说明 |
|--------|--------|------|
| `sdk.agent` | `sdk.api.agent` + `sdk.core.agent` | 接口分离 |
| `sdk.skill` | `sdk.api.skill` + `sdk.core.skill` | 接口分离 |
| `sdk.network` | `sdk.service.network` | 归入服务层 |
| `sdk.persistence` | `sdk.service.storage.persistence` | 归入存储服务 |
| `sdk.storage` | `sdk.service.storage.vfs` | 归入存储服务 |
| `sdk.security` | `sdk.service.security` | 归入服务层 |
| `sdk.monitoring` | `sdk.service.monitoring` | 归入服务层 |
| `sdk.route` | `sdk.service.network.route` | 归入网络服务 |
| `sdk.terminal` | `sdk.core.agent.terminal` | 归入Agent模块 |
| `sdk.topology` | `sdk.service.network.topology` | 归入网络服务 |
| `sdk.command` | `sdk.core.command` | 归入核心层 |
| `sdk.config` | `sdk.infra.config` | 归入基础设施 |
| `sdk.async` | `sdk.infra.async` | 归入基础设施 |
| `sdk.system` | 拆分到各模块 | 按职责拆分 |
| `sdk.llm` | `sdk.service.llm` | 归入服务层 |
| `sdk.examples` | 移到examples模块 | 独立示例模块 |
| `sdk.test` | 移到test模块 | 独立测试模块 |

### 4.2 新增模块

| 新路径 | 功能 | 来源 |
|--------|------|------|
| `sdk.core.skill.discovery` | 技能发现 | v0.7.0新增 |
| `sdk.core.skill.installer` | 技能安装管道 | v0.7.0新增 |
| `sdk.core.skill.lifecycle` | 技能生命周期 | v0.7.0新增 |
| `sdk.core.scene.group` | 场景组管理 | v0.7.0新增 |
| `sdk.core.scene.failover` | 故障切换 | v0.7.0新增 |
| `sdk.core.scene.capability` | 能力管理 | v0.7.0新增 |
| `sdk.core.metadata` | 元数据管理 | v0.7.0新增 |
| `sdk.api.metadata` | 元数据API | v0.7.0新增 |
| `sdk.service.security.crypto` | 密钥管理 | v0.7.0新增 |
| `sdk.service.security.cert` | 证书管理 | v0.7.0新增 |

---

## 五、包命名规范

### 5.1 包命名格式

```
net.ooder.sdk.{layer}.{module}.{submodule}

layer: api | core | service | infra | common
module: agent | skill | scene | metadata | network | storage | security | ...
submodule: 具体功能模块
```

### 5.2 类命名规范

| 类型 | 命名格式 | 示例 |
|------|----------|------|
| 接口 | 名词 | `SkillPackageManager` |
| 实现类 | 接口名 + Impl | `SkillPackageManagerImpl` |
| 工厂类 | 对象名 + Factory | `AgentFactory` |
| 管理类 | 对象名 + Manager | `SceneManager` |
| 配置类 | 对象名 + Config/Properties | `AgentConfig` |
| 工具类 | 功能名 + Utils | `JsonUtils` |
| 异常类 | 功能名 + Exception | `SkillException` |
| 常量类 | 功能名 + Constants | `SDKConstants` |

### 5.3 方法命名规范

| 操作类型 | 命名格式 | 示例 |
|----------|----------|------|
| 查询单个 | get + 实体名 | `getSkillById` |
| 查询列表 | list + 实体名 | `listInstalledSkills` |
| 创建 | create + 实体名 | `createSceneGroup` |
| 更新 | update + 实体名 | `updateSkillConfig` |
| 删除 | delete + 实体名 | `deleteSkill` |
| 注册 | register + 实体名 | `registerAgent` |
| 注销 | deregister + 实体名 | `deregisterAgent` |
| 启动 | start + 实体名 | `startSkill` |
| 停止 | stop + 实体名 | `stopSkill` |
| 验证 | validate + 实体名 | `validatePermission` |

---

## 六、迁移计划

### 6.1 迁移阶段

| 阶段 | 内容 | 时间 |
|------|------|------|
| Phase 1 | 创建新包结构 | 1天 |
| Phase 2 | 迁移API层 | 2天 |
| Phase 3 | 迁移Core层 | 3天 |
| Phase 4 | 迁移Service层 | 2天 |
| Phase 5 | 迁移Infra层 | 1天 |
| Phase 6 | 更新测试和文档 | 2天 |

### 6.2 兼容性处理

```java
// 保留旧包的兼容性别名
package net.ooder.sdk.agent;

// 兼容性别名，指向新位置
@Deprecated(since = "0.7.0", forRemoval = true)
public interface McpAgent extends net.ooder.sdk.api.agent.McpAgent {}
```

---

## 七、版本历史

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| v0.1 | 2026-02-15 | 初始版本，模块结构优化方案 |
