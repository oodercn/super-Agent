# MCP Agent 三端用户手册

## 1. 系统概述

MCP Agent 是一个功能强大的网络管理和设备控制平台，采用三层架构设计，包括主控节点（MCP）、路由节点（Route）和终端节点（End）。这三个节点协同工作，构成了一个完整的网络管理生态系统。

### 1.1 三端架构说明

| 节点类型 | 英文全称 | 中文名称 | 主要职责 |
|---------|---------|---------|----------|
| MCP | Master Control Point | 主控节点 | 系统核心，负责整体协调和管理 |
| Route | Route Agent | 路由节点 | 网络通信，负责数据传输和路由管理 |
| End | End Agent | 终端节点 | 设备控制，负责具体设备的操作和执行 |

### 1.2 系统架构图

```
┌─────────────────────────────────────────────────────────┐
│                    前端控制台                           │
│  (Web Console)                                          │
└───────────────────────┬─────────────────────────────────┘
                        │
┌───────────────────────▼─────────────────────────────────┐
│                    API 层                               │
│  (RESTful API)                                          │
└───────────────────────┬─────────────────────────────────┘
                        │
┌───────────────────────▼─────────────────────────────────┐
│                    控制器层                             │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐ │
│  │  MCP 控制器   │  │  Route控制器  │  │  End 控制器    │ │
│  └───────────────┘  └───────────────┘  └───────────────┘ │
└───────────────────────┬─────────────────────────────────┘
                        │
┌───────────────────────▼─────────────────────────────────┐
│                    服务层                               │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐ │
│  │  MCP 服务     │  │  Route服务    │  │  End 服务      │ │
│  └───────────────┘  └───────────────┘  └───────────────┘ │
└───────────────────────┬─────────────────────────────────┘
                        │
┌───────────────────────▼─────────────────────────────────┐
│                    存储层                               │
│  (配置数据、设备信息、系统状态)                          │
└─────────────────────────────────────────────────────────┘
```

## 2. 主控节点 (MCP) 使用指南

### 2.1 节点概述

主控节点是整个系统的核心，负责协调和管理其他所有节点。它提供了系统级的监控、配置和管理功能，是用户与系统交互的主要入口。

### 2.2 主要功能

#### 2.2.1 系统监控

- **健康检查**：监控系统整体健康状态
- **系统状态**：查看CPU、内存、磁盘等系统资源使用情况
- **服务状态**：监控各服务的运行状态
- **网络状态**：查看网络连接和拓扑结构

#### 2.2.2 配置管理

- **MCP 配置**：管理主控节点的基本配置参数
- **服务配置**：配置系统服务的运行参数
- **系统配置**：管理系统级别的配置选项
- **配置历史**：查看配置变更历史记录

#### 2.2.3 服务管理

- **服务状态**：查看和管理系统服务
- **服务启动/停止**：控制服务的运行状态
- **服务重启**：重启指定服务
- **服务检查**：检查服务的健康状态

### 2.3 使用流程

#### 2.3.1 访问主控节点

1. 打开浏览器，访问控制台地址：`http://localhost:8091/console/index.html`
2. 在导航菜单中选择「仪表盘」或「系统管理」
3. 查看系统概览信息

#### 2.3.2 配置主控节点

1. 在导航菜单中选择「配置管理」→「MCP 配置」
2. 查看当前配置参数
3. 修改需要调整的配置项
4. 保存配置更改

#### 2.3.3 监控系统状态

1. 在导航菜单中选择「健康检查」
2. 查看系统健康状态概览
3. 查看详细的系统指标
4. 检查服务运行状态

### 2.4 常见操作

| 操作 | 路径 | 说明 |
|------|------|------|
| 查看健康状态 | `GET /api/health/overview` | 获取系统健康状态概览 |
| 查看系统状态 | `GET /api/health/system/status` | 获取系统详细状态 |
| 检查服务状态 | `POST /api/health/service/check-all` | 检查所有服务状态 |
| 获取MCP配置 | `GET /api/config/mcp` | 获取主控节点配置 |
| 更新MCP配置 | `PUT /api/config/mcp` | 更新主控节点配置 |
| 重置MCP配置 | `POST /api/config/reset/mcp` | 重置MCP配置为默认值 |

### 2.5 故障排除

| 问题 | 可能原因 | 解决方案 |
|------|---------|----------|
| MCP服务启动失败 | 端口占用或配置错误 | 检查端口占用情况，查看日志文件 |
| 系统性能下降 | 资源不足或负载过高 | 增加系统资源，优化配置参数 |
| 服务状态异常 | 服务依赖问题或配置错误 | 检查服务依赖，查看服务日志 |
| 配置更新失败 | 参数格式错误或权限问题 | 检查参数格式，确保有正确权限 |

## 3. 路由节点 (Route) 使用指南

### 3.1 节点概述

路由节点负责网络通信和数据传输，是MCP和End节点之间的桥梁。它管理网络路由、链路和拓扑结构，确保数据能够正确、高效地在网络中传输。

### 3.2 主要功能

#### 3.2.1 路由管理

- **路由列表**：查看所有路由节点
- **路由详情**：查看路由节点的详细信息
- **路由配置**：配置路由节点的参数
- **路由发现**：自动发现网络中的路由节点

#### 3.2.2 链路管理

- **链路列表**：查看所有网络链路
- **链路详情**：查看链路的详细信息
- **添加链路**：创建新的网络链路
- **删除链路**：移除不需要的链路
- **链路状态**：监控链路的连接状态

#### 3.2.3 网络拓扑

- **拓扑视图**：可视化查看网络拓扑结构
- **拓扑发现**：自动发现网络拓扑
- **拓扑分析**：分析网络拓扑的健康状态

### 3.3 使用流程

#### 3.3.1 访问路由管理

1. 在导航菜单中选择「网络管理」→「路由管理」
2. 查看路由节点列表
3. 选择需要操作的路由节点

#### 3.3.2 配置路由节点

1. 在导航菜单中选择「配置管理」→「Route 配置」
2. 查看当前路由配置参数
3. 修改需要调整的配置项
4. 保存配置更改

#### 3.3.3 管理网络链路

1. 在导航菜单中选择「网络管理」→「链路管理」
2. 查看当前链路列表
3. 点击「添加链路」创建新链路
4. 填写链路信息并保存

### 3.4 常见操作

| 操作 | 路径 | 说明 |
|------|------|------|
| 获取路由列表 | `GET /api/network/route/list` | 获取路由节点列表 |
| 获取路由详情 | `GET /api/network/route/detail/{routeId}` | 获取指定路由节点详情 |
| 添加路由 | `POST /api/network/route/add` | 添加新的路由节点 |
| 删除路由 | `DELETE /api/network/route/delete/{routeId}` | 删除指定路由节点 |
| 发现路由 | `POST /api/network/route/discover` | 自动发现路由节点 |
| 获取Route配置 | `GET /api/config/route` | 获取路由节点配置 |
| 更新Route配置 | `PUT /api/config/route` | 更新路由节点配置 |

### 3.5 故障排除

| 问题 | 可能原因 | 解决方案 |
|------|---------|----------|
| 路由连接失败 | 网络连接问题或配置错误 | 检查网络连接，验证路由配置 |
| 链路状态异常 | 网络中断或链路配置错误 | 检查网络连接，验证链路配置 |
| 拓扑发现失败 | 网络扫描问题或权限不足 | 检查网络权限，确保网络可达 |
| 路由配置无效 | 参数格式错误或范围超出限制 | 检查配置参数，确保在有效范围内 |

## 4. 终端节点 (End) 使用指南

### 4.1 节点概述

终端节点是直接与设备交互的执行单元，负责具体设备的控制和操作。它接收来自MCP和Route的指令，执行相应的操作，并将结果反馈回系统。

### 4.2 主要功能

#### 4.2.1 设备管理

- **设备列表**：查看所有终端设备
- **设备详情**：查看设备的详细信息
- **设备控制**：控制设备的开关、属性等
- **设备状态**：监控设备的运行状态

#### 4.2.2 终端管理

- **终端列表**：查看所有终端节点
- **终端详情**：查看终端节点的详细信息
- **终端操作**：对终端节点执行操作
- **终端状态**：监控终端节点的运行状态

#### 4.2.3 命令执行

- **命令发送**：向终端节点发送命令
- **命令队列**：管理待执行的命令
- **命令执行**：监控命令的执行状态
- **命令结果**：查看命令执行结果

### 4.3 使用流程

#### 4.3.1 访问终端管理

1. 在导航菜单中选择「终端管理」
2. 查看终端节点列表
3. 选择需要操作的终端节点

#### 4.3.2 配置终端节点

1. 在导航菜单中选择「配置管理」→「End 配置」
2. 查看当前终端配置参数
3. 修改需要调整的配置项
4. 保存配置更改

#### 4.3.3 控制设备

1. 在导航菜单中选择「终端管理」→「设备管理」
2. 选择需要控制的设备
3. 点击「控制设备」按钮
4. 选择操作类型并执行

### 4.4 常见操作

| 操作 | 路径 | 说明 |
|------|------|------|
| 获取终端列表 | `GET /api/network/endagent/list` | 获取终端节点列表 |
| 获取终端详情 | `GET /api/network/endagent/detail/{agentId}` | 获取指定终端节点详情 |
| 添加终端 | `POST /api/network/endagent/add` | 添加新的终端节点 |
| 删除终端 | `DELETE /api/network/endagent/delete/{agentId}` | 删除指定终端节点 |
| 发现终端 | `POST /api/network/endagent/discover` | 自动发现终端节点 |
| 控制设备 | `POST /api/devices/control/{deviceId}` | 控制指定设备 |
| 获取End配置 | `GET /api/config/end` | 获取终端节点配置 |
| 更新End配置 | `PUT /api/config/end` | 更新终端节点配置 |

### 4.5 故障排除

| 问题 | 可能原因 | 解决方案 |
|------|---------|----------|
| 终端连接失败 | 网络连接问题或设备离线 | 检查网络连接，确认设备电源 |
| 设备控制失败 | 设备无响应或命令错误 | 检查设备状态，验证命令参数 |
| 终端发现失败 | 网络扫描问题或设备未启用 | 检查网络权限，确保设备已启用 |
| 命令执行超时 | 设备响应缓慢或网络延迟 | 增加超时时间，检查网络连接 |

## 5. 三端协同操作

### 5.1 端到端流程

MCP Agent 系统的典型操作流程涉及三个节点的协同工作：

1. **指令发起**：用户通过MCP控制台发起操作请求
2. **指令传递**：MCP将指令通过Route节点传递给相应的End节点
3. **指令执行**：End节点执行具体操作并控制设备
4. **结果反馈**：执行结果通过Route节点返回给MCP
5. **结果展示**：MCP处理并展示执行结果给用户

### 5.2 常见端到端场景

#### 5.2.1 设备控制流程

1. 用户在MCP控制台选择「终端管理」→「设备管理」
2. 选择需要控制的设备，点击「控制设备」
3. MCP接收控制请求，通过Route节点传递给对应的End节点
4. End节点执行控制操作，控制目标设备
5. 执行结果通过Route节点返回给MCP
6. MCP更新设备状态并展示给用户

#### 5.2.2 网络拓扑发现流程

1. 用户在MCP控制台选择「网络管理」→「拓扑管理」
2. 点击「发现拓扑」按钮
3. MCP发起拓扑发现请求，通过Route节点进行网络扫描
4. Route节点发现网络中的设备和连接
5. 发现结果通过Route节点返回给MCP
6. MCP更新网络拓扑图并展示给用户

#### 5.2.3 系统健康检查流程

1. 用户在MCP控制台选择「健康检查」
2. 点击「检查所有服务」按钮
3. MCP发起健康检查请求，分别检查自身、Route和End节点
4. 各节点执行健康检查并返回结果
5. MCP汇总检查结果，计算健康评分
6. MCP展示健康检查结果和健康评分给用户

## 6. 配置管理

### 6.1 三端配置概述

MCP Agent 系统提供了统一的配置管理界面，用于管理三个节点的配置参数。配置管理模块位于控制台的「配置管理」菜单下。

### 6.2 MCP 配置

MCP配置包含主控节点的基本参数，如：

- 版本信息
- 服务端口
- 心跳间隔
- 日志级别
- 最大连接数
- 连接超时时间
- 线程池大小
- 缓冲区大小

### 6.3 Route 配置

Route配置包含路由节点的网络参数，如：

- 最大路由数
- 路由超时时间
- 路由重试次数
- 路由重试延迟
- 路由发现间隔
- 路由健康检查间隔
- 路由延迟阈值
- 路由可靠性阈值

### 6.4 End 配置

End配置包含终端节点的设备参数，如：

- 最大终端数
- 终端超时时间
- 终端心跳间隔
- 终端最大心跳丢失次数
- 终端发现间隔
- 终端连接超时
- 终端读写超时
- 最大终端命令数

### 6.5 配置最佳实践

- **合理设置超时时间**：根据网络环境和设备性能调整
- **优化心跳间隔**：平衡实时性和网络负载
- **设置合理的最大连接数**：根据系统资源调整
- **定期备份配置**：防止配置丢失
- **记录配置变更**：便于问题追溯

## 7. 监控与维护

### 7.1 系统监控

MCP Agent 提供了全面的系统监控功能，包括：

- **系统指标监控**：CPU、内存、磁盘等资源使用情况
- **网络监控**：网络连接、延迟、带宽使用等
- **服务监控**：各服务的运行状态
- **设备监控**：终端设备的运行状态

### 7.2 告警管理

- **告警信息**：查看系统产生的告警
- **告警级别**：根据严重程度分类告警
- **告警处理**：处理和清除告警
- **告警阈值**：设置告警触发阈值

### 7.3 日志管理

- **系统日志**：查看系统运行日志
- **操作日志**：查看用户操作日志
- **错误日志**：查看系统错误日志
- **日志导出**：导出日志文件

### 7.4 定期维护

| 维护任务 | 频率 | 说明 |
|---------|------|------|
| 系统健康检查 | 每日 | 检查系统整体健康状态 |
| 配置备份 | 每周 | 备份系统配置文件 |
| 日志清理 | 每周 | 清理过期日志文件 |
| 性能评估 | 每月 | 评估系统性能并优化 |
| 安全检查 | 每月 | 检查系统安全状态 |

## 8. 故障排除

### 8.1 常见问题

| 问题 | 可能原因 | 解决方案 |
|------|---------|----------|
| 控制台访问失败 | 网络连接问题 | 检查网络连接和防火墙设置 |
| 服务启动失败 | 端口占用或配置错误 | 检查端口占用情况，查看日志文件 |
| 设备控制失败 | 设备离线或无响应 | 检查设备连接状态和电源 |
| 网络拓扑发现失败 | 网络扫描问题 | 检查网络权限，确保网络可达 |
| 系统性能下降 | 资源不足 | 增加系统资源或优化配置 |
| 配置保存失败 | 参数格式错误 | 检查配置参数格式是否正确 |
| 命令执行超时 | 设备响应缓慢 | 增加超时时间，检查设备状态 |
| 告警频繁触发 | 阈值设置不合理 | 调整告警阈值，优化系统配置 |

### 8.2 诊断工具

| 工具 | 路径 | 说明 |
|------|------|------|
| 健康检查 | `GET /api/health/overview` | 检查系统健康状态 |
| 系统状态 | `GET /api/health/system/status` | 获取系统详细状态 |
| 网络状态 | `GET /api/health/network/status` | 获取网络状态 |
| 服务检查 | `POST /api/health/service/check-all` | 检查所有服务状态 |
| 系统日志 | `GET /api/log/system` | 查看系统日志 |
| 操作日志 | `GET /api/log/operation` | 查看操作日志 |
| 网络拓扑 | `GET /api/network/topology` | 查看网络拓扑 |
| 终端发现 | `POST /api/network/endagent/discover` | 发现终端节点 |

### 8.3 故障定位流程

1. **问题识别**：确认问题现象和影响范围
2. **信息收集**：收集相关日志、配置和状态信息
3. **问题分析**：分析收集到的信息，定位问题根源
4. **解决方案**：根据分析结果制定解决方案
5. **方案实施**：实施解决方案并验证效果
6. **问题记录**：记录问题和解决方案，便于未来参考

## 9. 最佳实践

### 9.1 系统部署

- **硬件要求**：根据终端设备数量和网络规模选择合适的硬件配置
- **网络规划**：合理规划网络拓扑，确保网络连接稳定
- **安全配置**：配置防火墙规则，限制不必要的访问
- **备份策略**：建立定期备份机制，防止数据丢失

### 9.2 日常使用

- **权限管理**：根据用户角色分配适当的权限
- **操作规范**：建立标准化的操作流程和规范
- **监控预警**：设置合理的监控阈值，及时发现异常
- **文档记录**：记录系统配置和重要操作，便于问题追溯

### 9.3 性能优化

- **配置优化**：根据实际需求调整系统配置参数
- **资源管理**：合理分配系统资源，避免资源浪费
- **负载均衡**：在大型部署中考虑负载均衡
- **缓存策略**：合理使用缓存，提高系统响应速度

### 9.4 安全管理

- **认证安全**：使用强密码并定期更换
- **网络安全**：限制API访问IP，使用HTTPS
- **权限控制**：实施最小权限原则
- **日志审计**：定期检查系统日志，监控异常操作
- **漏洞修复**：及时更新系统和依赖库

## 10. 附录

### 10.1 API 接口列表

| 接口路径 | 方法 | 功能描述 | 节点 |
|---------|------|----------|------|
| `/api/health/overview` | GET | 获取健康检查概览 | MCP |
| `/api/health/system/status` | GET | 获取系统状态 | MCP |
| `/api/health/network/status` | GET | 获取网络状态 | MCP |
| `/api/health/service/status` | GET | 获取服务状态 | MCP |
| `/api/health/service/check-all` | POST | 检查所有服务状态 | MCP |
| `/api/config/mcp` | GET | 获取MCP配置 | MCP |
| `/api/config/mcp` | PUT | 更新MCP配置 | MCP |
| `/api/config/route` | GET | 获取Route配置 | Route |
| `/api/config/route` | PUT | 更新Route配置 | Route |
| `/api/config/end` | GET | 获取End配置 | End |
| `/api/config/end` | PUT | 更新End配置 | End |
| `/api/config/reset/{configType}` | POST | 重置配置为默认值 | 通用 |
| `/api/network/route/list` | GET | 获取路由列表 | Route |
| `/api/network/route/detail/{routeId}` | GET | 获取路由详情 | Route |
| `/api/network/route/add` | POST | 添加路由 | Route |
| `/api/network/route/delete/{routeId}` | DELETE | 删除路由 | Route |
| `/api/network/route/discover` | POST | 发现路由 | Route |
| `/api/network/endagent/list` | GET | 获取终端列表 | End |
| `/api/network/endagent/detail/{agentId}` | GET | 获取终端详情 | End |
| `/api/network/endagent/add` | POST | 添加终端 | End |
| `/api/network/endagent/delete/{agentId}` | DELETE | 删除终端 | End |
| `/api/network/endagent/discover` | POST | 发现终端 | End |
| `/api/devices/list` | GET | 获取设备列表 | End |
| `/api/devices/detail/{deviceId}` | GET | 获取设备详情 | End |
| `/api/devices/control/{deviceId}` | POST | 控制设备 | End |
| `/api/command/send` | POST | 发送命令 | 通用 |
| `/api/command/queue` | GET | 获取命令队列 | 通用 |

### 10.2 配置参数参考

#### MCP 配置参数

| 参数名称 | 描述 | 默认值 | 建议范围 |
|---------|------|--------|----------|
| version | 版本信息 | 0.6.5 | 固定值 |
| servicePort | 服务端口 | 8080 | 1024-65535 |
| heartbeatInterval | 心跳间隔(ms) | 30000 | 10000-60000 |
| logLevel | 日志级别 | INFO | ERROR, WARN, INFO, DEBUG |
| maxConnections | 最大连接数 | 1000 | 100-5000 |
| connectionTimeout | 连接超时(ms) | 60000 | 30000-120000 |
| threadPoolSize | 线程池大小 | 20 | 5-100 |
| bufferSize | 缓冲区大小 | 8192 | 1024-65536 |

#### Route 配置参数

| 参数名称 | 描述 | 默认值 | 建议范围 |
|---------|------|--------|----------|
| maxRoutes | 最大路由数 | 1000 | 100-5000 |
| routeTimeout | 路由超时(ms) | 30000 | 10000-60000 |
| routeRetryCount | 路由重试次数 | 3 | 1-5 |
| routeRetryDelay | 路由重试延迟(ms) | 1000 | 500-3000 |
| routeDiscoveryInterval | 路由发现间隔(ms) | 300000 | 60000-600000 |
| routeHealthCheckInterval | 路由健康检查间隔(ms) | 60000 | 30000-120000 |
| routeLatencyThreshold | 路由延迟阈值(ms) | 1000 | 500-5000 |

#### End 配置参数

| 参数名称 | 描述 | 默认值 | 建议范围 |
|---------|------|--------|----------|
| maxEndAgents | 最大终端数 | 500 | 100-2000 |
| endAgentTimeout | 终端超时(ms) | 60000 | 30000-120000 |
| endAgentHeartbeatInterval | 终端心跳间隔(ms) | 45000 | 15000-90000 |
| endAgentMaxHeartbeatMisses | 终端最大心跳丢失次数 | 3 | 1-5 |
| endAgentDiscoveryInterval | 终端发现间隔(ms) | 600000 | 300000-1800000 |
| endAgentCommandTimeout | 终端命令超时(ms) | 30000 | 15000-60000 |

### 10.3 术语表

| 术语 | 英文全称 | 描述 |
|------|---------|------|
| MCP | Master Control Point | 主控节点，系统核心，负责整体协调和管理 |
| Route | Route Agent | 路由节点，负责网络通信和数据传输 |
| End | End Agent | 终端节点，负责设备控制和操作执行 |
| SDK | Software Development Kit | 软件开发工具包，提供系统核心功能 |
| API | Application Programming Interface | 应用程序编程接口，系统与外部交互的接口 |
| RESTful | Representational State Transfer | 一种软件架构风格，用于设计网络应用程序接口 |
| VFS | Virtual File System | 虚拟文件系统，用于管理文件和目录 |
| Topology | Network Topology | 网络拓扑，网络中设备和连接的布局 |
| Heartbeat | 心跳 | 定期发送的信号，用于确认设备或服务是否正常运行 |
| Discovery | 发现 | 自动识别网络中的设备和服务的过程 |

## 11. 总结

MCP Agent 三端架构为网络管理和设备控制提供了一个完整、高效的解决方案。通过主控节点（MCP）、路由节点（Route）和终端节点（End）的协同工作，系统实现了从指令发起、传递到执行、反馈的完整流程。

### 11.1 核心优势

- **分层架构**：清晰的三层架构设计，职责明确，易于管理
- **统一管理**：通过MCP控制台实现对所有节点的统一管理
- **实时监控**：提供实时的系统状态和设备状态监控
- **灵活配置**：支持细粒度的配置管理，适应不同场景
- **智能发现**：支持自动发现网络中的路由和终端节点
- **安全可靠**：内置安全监控和告警机制

### 11.2 应用场景

- **企业网络管理**：管理企业内部网络设备和服务
- **智能家居控制**：控制和监控智能家居设备
- **工业设备监控**：监控和管理工业设备
- **网络运维**：简化网络运维工作，提高效率
- **远程管理**：实现设备的远程监控和控制

MCP Agent 系统通过其强大的功能和灵活的架构，为用户提供了一个统一、高效的网络管理和设备控制平台，是现代网络环境中不可或缺的管理工具。