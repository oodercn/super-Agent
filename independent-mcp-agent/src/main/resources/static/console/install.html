﻿<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OoderAgent - 安装导览</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- 主题切换按钮 -->
    <button class="theme-toggle" onclick="toggleTheme()">🌙 暗色模式</button>
    
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <h1>OoderAgent 安装导览</h1>
            <p class="subtitle">欢迎使用 OoderAgent 安装向导，我们将引导您完成初始设置和配置</p>
        </div>
        
        <!-- 步骤导航 -->
        <div class="steps-nav">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">场景选择</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">管理员设置</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">VFS配置</div>
            </div>
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">网络配置</div>
            </div>
            <div class="step" data-step="5">
                <div class="step-number">5</div>
                <div class="step-label">完成安装</div>
            </div>
        </div>
        
        <!-- 步骤内容 -->
        <div class="step-content" id="step-1">
            <h2>场景选择</h2>
            <p style="margin-bottom: 24px; color: var(--ooder-secondary);">请选择适合您的使用场景，不同场景将提供不同的功能配置</p>
            
            <div class="card" data-function="home">
                <h3>家庭场景</h3>
                <p>适合家庭用户，提供基础的设备管理和控制功能</p>
                <ul class="features">
                    <li>家庭仪表盘</li>
                    <li>设备管理与控制</li>
                    <li>家庭安全监控</li>
                    <li>简单易用的界面</li>
                </ul>
            </div>
            
            <div class="card" data-function="lan">
                <h3>局域网场景</h3>
                <p>适合小型局域网环境，提供完整的网络管理功能</p>
                <ul class="features">
                    <li>局域网仪表盘</li>
                    <li>网络设备管理</li>
                    <li>网络配置与监控</li>
                    <li>带宽使用分析</li>
                </ul>
            </div>
            
            <div class="card" data-function="enterprise">
                <h3>企业场景</h3>
                <p>适合企业环境，提供完整的系统管理和监控功能</p>
                <ul class="features">
                    <li>企业仪表盘</li>
                    <li>系统管理与配置</li>
                    <li>全面的监控与分析</li>
                    <li>高级安全功能</li>
                </ul>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="nextStep(1)">下一步 →</button>
            </div>
        </div>
        
        <div class="step-content hidden" id="step-2">
            <h2>管理员设置</h2>
            <p style="margin-bottom: 24px; color: var(--ooder-secondary);">请创建临时管理员账户，用于首次登录和系统配置</p>
            
            <div class="form-row">
                <div>
                    <label class="form-label">管理员用户名</label>
                    <input type="text" class="form-input" id="admin-username" placeholder="请输入管理员用户名" required>
                </div>
                <div>
                    <label class="form-label">管理员密码</label>
                    <input type="password" class="form-input" id="admin-password" placeholder="请输入管理员密码" required>
                </div>
            </div>
            
            <div class="form-row">
                <div>
                    <label class="form-label">确认密码</label>
                    <input type="password" class="form-input" id="admin-confirm-password" placeholder="请再次输入密码" required>
                </div>
                <div>
                    <label class="form-label">管理员邮箱（可选）</label>
                    <input type="email" class="form-input" id="admin-email" placeholder="请输入管理员邮箱">
                </div>
            </div>
            
            <div class="form-checkbox">
                <input type="checkbox" id="remember-admin" checked>
                <label for="remember-admin">记住管理员账户</label>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevStep(2)">← 上一步</button>
                <button class="btn btn-primary" onclick="nextStep(2)">下一步 →</button>
            </div>
        </div>
        
        <div class="step-content hidden" id="step-3">
            <h2>VFS 配置</h2>
            <p style="margin-bottom: 24px; color: var(--ooder-secondary);">请配置 VFS 地址和目录结构</p>
            
            <div class="form-row">
                <div>
                    <label class="form-label">VFS 根目录地址</label>
                    <input type="text" class="form-input" id="vfs-root" placeholder="请输入 VFS 根目录地址" value="/opt/ooder/vfs" required>
                </div>
                <div>
                    <label class="form-label">VFS 存储类型</label>
                    <select class="form-select" id="vfs-type">
                        <option value="local">本地存储</option>
                        <option value="network">网络存储</option>
                        <option value="cloud">云存储</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">VFS 目录结构</label>
                <div class="vfs-browser" id="vfs-browser">
                    <div class="vfs-item directory">/ (根目录)</div>
                    <div class="vfs-item directory">/config (配置目录)</div>
                    <div class="vfs-item directory">/logs (日志目录)</div>
                    <div class="vfs-item directory">/data (数据目录)</div>
                    <div class="vfs-item directory">/temp (临时目录)</div>
                    <div class="vfs-item file">/config/agent.json</div>
                    <div class="vfs-item file">/config/network.json</div>
                </div>
            </div>
            
            <div class="form-checkbox">
                <input type="checkbox" id="enable-vfs-sync" checked>
                <label for="enable-vfs-sync">启用 VFS 同步功能</label>
            </div>
            
            <div class="form-checkbox">
                <input type="checkbox" id="enable-log-sync" checked>
                <label for="enable-log-sync">启用命令日志同步</label>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevStep(3)">← 上一步</button>
                <button class="btn btn-primary" onclick="nextStep(3)">下一步 →</button>
            </div>
        </div>
        
        <div class="step-content hidden" id="step-4">
            <h2>网络配置</h2>
            <p style="margin-bottom: 24px; color: var(--ooder-secondary);">请配置 UDP 网络设置</p>
            
            <div class="network-info">
                <h3>UDP 网络配置说明</h3>
                <p>Ooder MCP Agent 使用 UDP 协议进行节点间通信，请确保以下设置正确：</p>
                <ul>
                    <li>默认 UDP 端口：9876</li>
                    <li>确保防火墙允许 UDP 端口通信</li>
                    <li>如果在 NAT 环境下，请配置端口映射</li>
                    <li>网络延迟应控制在 100ms 以内</li>
                </ul>
            </div>
            
            <div class="form-row">
                <div>
                    <label class="form-label">UDP 端口</label>
                    <input type="number" class="form-input" id="udp-port" placeholder="请输入 UDP 端口" value="9876" required>
                </div>
                <div>
                    <label class="form-label">网络超时时间 (ms)</label>
                    <input type="number" class="form-input" id="network-timeout" placeholder="请输入网络超时时间" value="30000" required>
                </div>
            </div>
            
            <div class="form-row">
                <div>
                    <label class="form-label">心跳间隔 (ms)</label>
                    <input type="number" class="form-input" id="heartbeat-interval" placeholder="请输入心跳间隔" value="5000" required>
                </div>
                <div>
                    <label class="form-label">最大重试次数</label>
                    <input type="number" class="form-input" id="max-retry" placeholder="请输入最大重试次数" value="3" required>
                </div>
            </div>
            
            <div class="form-checkbox">
                <input type="checkbox" id="enable-network-monitor" checked>
                <label for="enable-network-monitor">启用网络监控</label>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevStep(4)">← 上一步</button>
                <button class="btn btn-primary" onclick="nextStep(4)">下一步 →</button>
            </div>
        </div>
        
        <div class="step-content hidden" id="step-5">
            <h2>安装完成</h2>
            <p style="margin-bottom: 24px; color: var(--ooder-secondary);">所有配置已完成，点击完成按钮启动服务</p>
            
            <div style="background-color: var(--ooder-light); border-radius: var(--ooder-radius); padding: 24px; margin-bottom: 24px;">
                <h3 style="margin-bottom: 16px; color: var(--ooder-text);">配置摘要</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div>
                        <p style="font-weight: 500; margin-bottom: 8px;">管理员账户</p>
                        <p id="summary-admin" style="color: var(--ooder-secondary);">-</p>
                    </div>
                    <div>
                        <p style="font-weight: 500; margin-bottom: 8px;">安装模式</p>
                        <p id="summary-mode" style="color: var(--ooder-secondary);">-</p>
                    </div>
                    <div>
                        <p style="font-weight: 500; margin-bottom: 8px;">VFS 根目录</p>
                        <p id="summary-vfs" style="color: var(--ooder-secondary);">-</p>
                    </div>
                    <div>
                        <p style="font-weight: 500; margin-bottom: 8px;">UDP 端口</p>
                        <p id="summary-udp" style="color: var(--ooder-secondary);">-</p>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevStep(5)">← 上一步</button>
                <button class="btn btn-success" onclick="completeInstall()">完成安装</button>
            </div>
        </div>
    </div>
    
    <script>
        // 当前步骤
        let currentStep = 1;
        // 保存配置
        let config = {};
        
        // 初始化
        function init() {
            // 绑定卡片点击事件
            document.querySelectorAll('.card').forEach(card => {
                card.addEventListener('click', function() {
                    // 移除其他卡片的激活状态
                    document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
                    // 添加当前卡片的激活状态
                    this.classList.add('active');
                });
            });
        }
        
        // 切换主题
        function toggleTheme() {
            const body = document.body;
            const button = document.querySelector('.theme-toggle');
            
            if (body.classList.contains('light-theme')) {
                body.classList.remove('light-theme');
                button.textContent = '☀️ 亮色模式';
            } else {
                body.classList.add('light-theme');
                button.textContent = '🌙 暗色模式';
            }
        }
        
        // 下一步
        function nextStep(step) {
            // 验证当前步骤
            if (!validateStep(step)) {
                return;
            }
            
            // 保存当前步骤配置
            saveStepConfig(step);
            
            // 更新步骤状态
            document.querySelector(`.step[data-step="${step}"]`).classList.remove('active');
            document.querySelector(`.step[data-step="${step}"]`).classList.add('completed');
            
            const nextStepNum = step + 1;
            document.querySelector(`.step[data-step="${nextStepNum}"]`).classList.add('active');
            
            // 隐藏当前步骤，显示下一步
            document.getElementById(`step-${step}`).classList.add('hidden');
            document.getElementById(`step-${nextStepNum}`).classList.remove('hidden');
            
            currentStep = nextStepNum;
            
            // 如果是最后一步，更新配置摘要
            if (nextStepNum === 5) {
                updateSummary();
            }
        }
        
        // 上一步
        function prevStep(step) {
            // 更新步骤状态
            document.querySelector(`.step[data-step="${step}"]`).classList.remove('active');
            
            const prevStepNum = step - 1;
            document.querySelector(`.step[data-step="${prevStepNum}"]`).classList.remove('completed');
            document.querySelector(`.step[data-step="${prevStepNum}"]`).classList.add('active');
            
            // 隐藏当前步骤，显示上一步
            document.getElementById(`step-${step}`).classList.add('hidden');
            document.getElementById(`step-${prevStepNum}`).classList.remove('hidden');
            
            currentStep = prevStepNum;
        }
        
        // 验证步骤
        function validateStep(step) {
            switch(step) {
                case 1:
                    const selectedFunction = document.querySelector('.card.active');
                    if (!selectedFunction) {
                        alert('请选择使用场景');
                        return false;
                    }
                    return true;
                    
                case 2:
                    const username = document.getElementById('admin-username').value;
                    const password = document.getElementById('admin-password').value;
                    const confirmPassword = document.getElementById('admin-confirm-password').value;
                    
                    if (!username) {
                        alert('请输入管理员用户名');
                        return false;
                    }
                    
                    if (!password) {
                        alert('请输入管理员密码');
                        return false;
                    }
                    
                    if (password !== confirmPassword) {
                        alert('两次输入的密码不一致');
                        return false;
                    }
                    
                    return true;
                    
                case 3:
                    const vfsRoot = document.getElementById('vfs-root').value;
                    if (!vfsRoot) {
                        alert('请输入 VFS 根目录地址');
                        return false;
                    }
                    return true;
                    
                case 4:
                    const udpPort = document.getElementById('udp-port').value;
                    if (!udpPort) {
                        alert('请输入 UDP 端口');
                        return false;
                    }
                    return true;
                    
                default:
                    return true;
            }
        }
        
        // 保存步骤配置
        function saveStepConfig(step) {
            switch(step) {
                case 1:
                    const selectedFunction = document.querySelector('.card.active');
                    config.functionType = {
                        type: selectedFunction.dataset.function,
                        name: selectedFunction.querySelector('h3').textContent
                    };
                    break;
                    
                case 2:
                    config.admin = {
                        username: document.getElementById('admin-username').value,
                        password: document.getElementById('admin-password').value,
                        email: document.getElementById('admin-email').value,
                        remember: document.getElementById('remember-admin').checked
                    };
                    break;
                    
                case 3:
                    config.vfs = {
                        root: document.getElementById('vfs-root').value,
                        type: document.getElementById('vfs-type').value,
                        enableSync: document.getElementById('enable-vfs-sync').checked,
                        enableLogSync: document.getElementById('enable-log-sync').checked
                    };
                    break;
                    
                case 4:
                    config.network = {
                        udpPort: document.getElementById('udp-port').value,
                        timeout: document.getElementById('network-timeout').value,
                        heartbeatInterval: document.getElementById('heartbeat-interval').value,
                        maxRetry: document.getElementById('max-retry').value,
                        enableMonitor: document.getElementById('enable-network-monitor').checked
                    };
                    break;
            }
        }
        
        // 更新配置摘要
        function updateSummary() {
            document.getElementById('summary-admin').textContent = config.admin ? config.admin.username : '-';
            document.getElementById('summary-mode').textContent = config.functionType ? config.functionType.name : '-';
            document.getElementById('summary-vfs').textContent = config.vfs.root;
            document.getElementById('summary-udp').textContent = config.network.udpPort;
        }
        
        // 完成安装
        function completeInstall() {
            // 显示安装进度
            alert('正在安装...请稍候');
            
            // 模拟安装过程
            setTimeout(() => {
                // 保存配置到本地存储
                localStorage.setItem('ooder-mcp-config', JSON.stringify(config));
                
                // 根据选择的功能分类跳转到相应页面
                let redirectUrl = 'index.html';
                if (config.functionType) {
                    switch(config.functionType.type) {
                        case 'home':
                            redirectUrl = 'pages/home/home-dashboard.html';
                            break;
                        case 'lan':
                            redirectUrl = 'pages/lan/lan-dashboard.html';
                            break;
                        case 'enterprise':
                            redirectUrl = 'pages/enterprise/enterprise-dashboard.html';
                            break;
                    }
                }
                
                // 跳转到相应页面
                window.location.href = redirectUrl;
            }, 2000);
        }
        
        // 初始化
        init();
    </script>
</body>
</html>
