<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备列表 - 家庭功能</title>
    <style>
        /* Ooder-Rad 风格基础样式 */
        :root {
            /* 亮色主题 */
            --ooder-primary: #1a73e8;
            --ooder-secondary: #5f6368;
            --ooder-success: #34a853;
            --ooder-warning: #fbbc04;
            --ooder-danger: #ea4335;
            --ooder-light: #f8f9fa;
            --ooder-dark: #202124;
            --ooder-border: #dadce0;
            --ooder-shadow: 0 1px 3px rgba(0,0,0,0.1);
            --ooder-radius: 8px;
            --ooder-spacing: 16px;
            --ooder-background: #ffffff;
            --ooder-text: #202124;
            --ooder-card-bg: #ffffff;
        }
        
        /* 暗色主题 */
        @media (prefers-color-scheme: dark) {
            :root {
                --ooder-primary: #8ab4f8;
                --ooder-secondary: #9aa0a6;
                --ooder-success: #81c995;
                --ooder-warning: #fbbc04;
                --ooder-danger: #f8877f;
                --ooder-light: #303134;
                --ooder-dark: #e8eaed;
                --ooder-border: #5f6368;
                --ooder-shadow: 0 1px 3px rgba(0,0,0,0.3);
                --ooder-background: #202124;
                --ooder-text: #e8eaed;
                --ooder-card-bg: #303134;
            }
        }
        
        /* 手动切换暗色主题 */
        body.dark-theme {
            --ooder-primary: #8ab4f8;
            --ooder-secondary: #9aa0a6;
            --ooder-success: #81c995;
            --ooder-warning: #fbbc04;
            --ooder-danger: #f8877f;
            --ooder-light: #303134;
            --ooder-dark: #e8eaed;
            --ooder-border: #5f6368;
            --ooder-shadow: 0 1px 3px rgba(0,0,0,0.3);
            --ooder-background: #000000;
            --ooder-text: #e8eaed;
            --ooder-card-bg: #1a1a1a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--ooder-background);
            color: var(--ooder-text);
            line-height: 1.5;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px;
        }
        
        /* 头部样式 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--ooder-border);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: var(--ooder-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* 按钮样式 */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--ooder-radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--ooder-primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1565c0;
            box-shadow: 0 2px 4px rgba(26, 115, 232, 0.3);
        }
        
        .btn-secondary {
            background-color: var(--ooder-light);
            color: var(--ooder-text);
            border: 1px solid var(--ooder-border);
        }
        
        .btn-secondary:hover {
            background-color: var(--ooder-border);
        }
        
        .btn-danger {
            background-color: var(--ooder-danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c62828;
            box-shadow: 0 2px 4px rgba(234, 67, 53, 0.3);
        }
        
        /* 卡片样式 */
        .card {
            background-color: var(--ooder-card-bg);
            border-radius: var(--ooder-radius);
            border: 1px solid var(--ooder-border);
            padding: 24px;
            box-shadow: var(--ooder-shadow);
            margin-bottom: 24px;
            transition: all 0.3s ease;
        }
        
        /* 搜索和过滤 */
        .search-filter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 300px;
        }
        
        .search-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--ooder-border);
            border-radius: var(--ooder-radius);
            background-color: var(--ooder-background);
            color: var(--ooder-text);
            font-size: 14px;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid var(--ooder-border);
            border-radius: var(--ooder-radius);
            background-color: var(--ooder-background);
            color: var(--ooder-text);
            font-size: 14px;
            cursor: pointer;
        }
        
        /* 表格样式 */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }
        
        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--ooder-border);
        }
        
        th {
            background-color: var(--ooder-light);
            font-weight: 600;
            color: var(--ooder-text);
        }
        
        tr:hover {
            background-color: var(--ooder-light);
        }
        
        /* 状态指示器 */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-online {
            background-color: var(--ooder-success);
        }
        
        .status-offline {
            background-color: var(--ooder-danger);
        }
        
        .status-warning {
            background-color: var(--ooder-warning);
        }
        
        /* 分页 */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 24px;
        }
        
        .page-btn {
            padding: 6px 12px;
            border: 1px solid var(--ooder-border);
            border-radius: var(--ooder-radius);
            background-color: var(--ooder-background);
            color: var(--ooder-text);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .page-btn:hover {
            background-color: var(--ooder-light);
        }
        
        .page-btn.active {
            background-color: var(--ooder-primary);
            color: white;
            border-color: var(--ooder-primary);
        }
        
        /* 设备图标 */
        .device-icon {
            font-size: 20px;
            color: var(--ooder-primary);
            margin-right: 8px;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .search-filter {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                min-width: unset;
            }
            
            table {
                font-size: 14px;
            }
            
            th, td {
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <h1><i class="ri-list-check"></i> 设备列表</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="toggleTheme()">
                    <i class="ri-moon-line"></i> 切换主题
                </button>
                <button class="btn btn-primary" onclick="addDevice()">
                    <i class="ri-add-line"></i> 添加设备
                </button>
            </div>
        </div>
        
        <!-- 搜索和过滤 -->
        <div class="search-filter">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="搜索设备名称、位置..." id="searchInput">
                <button class="btn btn-secondary" onclick="searchDevices()">
                    <i class="ri-search-line"></i> 搜索
                </button>
            </div>
            <div>
                <select class="filter-select" id="statusFilter">
                    <option value="all">所有状态</option>
                    <option value="online">在线</option>
                    <option value="offline">离线</option>
                    <option value="warning">警告</option>
                </select>
                <select class="filter-select" id="typeFilter">
                    <option value="all">所有类型</option>
                    <option value="light">灯光</option>
                    <option value="socket">插座</option>
                    <option value="lock">门锁</option>
                    <option value="camera">摄像头</option>
                    <option value="other">其他</option>
                </select>
            </div>
        </div>
        
        <!-- 设备表格 -->
        <div class="card">
            <div class="table-container">
                <table id="deviceTable">
                    <thead>
                        <tr>
                            <th>设备名称</th>
                            <th>类型</th>
                            <th>位置</th>
                            <th>状态</th>
                            <th>最后活动</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="deviceTableBody">
                        <!-- 设备数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
            
            <!-- 分页 -->
            <div class="pagination">
                <button class="page-btn" onclick="changePage(1)">首页</button>
                <button class="page-btn" onclick="changePage(currentPage - 1)">上一页</button>
                <button class="page-btn active" id="page1">1</button>
                <button class="page-btn" id="page2">2</button>
                <button class="page-btn" id="page3">3</button>
                <button class="page-btn" onclick="changePage(currentPage + 1)">下一页</button>
                <button class="page-btn" onclick="changePage(3)">末页</button>
            </div>
        </div>
    </div>
    
    <script>
        let currentPage = 1;
        const pageSize = 3;
        let allDevices = [];
        let filteredDevices = [];
        
        // 初始化页面
        function init() {
            loadDevices();
        }
        
        // 加载设备数据
        async function loadDevices() {
            try {
                const statusFilter = document.getElementById('statusFilter').value;
                const typeFilter = document.getElementById('typeFilter').value;
                const searchTerm = document.getElementById('searchInput').value;
                
                // 构建查询参数
                let url = '/api/home/devices';
                const params = new URLSearchParams();
                
                if (statusFilter && statusFilter !== 'all') {
                    params.append('status', statusFilter);
                }
                
                if (typeFilter && typeFilter !== 'all') {
                    params.append('type', typeFilter);
                }
                
                if (searchTerm) {
                    params.append('search', searchTerm);
                }
                
                if (params.toString()) {
                    url += '?' + params.toString();
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.status === 'success') {
                    allDevices = data.devices;
                    filteredDevices = data.devices;
                    
                    renderDevices();
                }
            } catch (error) {
                console.error('加载设备数据错误:', error);
            }
        }
        
        // 渲染设备数据
        function renderDevices() {
            const tableBody = document.getElementById('deviceTableBody');
            tableBody.innerHTML = '';
            
            // 计算分页数据
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageDevices = filteredDevices.slice(startIndex, endIndex);
            
            pageDevices.forEach(device => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>
                        <i class="ri-${getDeviceIcon(device.type)} device-icon"></i>
                        ${device.name}
                    </td>
                    <td>${getDeviceTypeName(device.type)}</td>
                    <td>${device.location}</td>
                    <td>
                        <span class="status-indicator status-${device.status}"></span>
                        ${getStatusText(device.status)}
                    </td>
                    <td>${device.lastActive}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="viewDevice(${device.id})">
                            <i class="ri-eye-line"></i>
                        </button>
                        <button class="btn btn-primary" onclick="controlDevice(${device.id})">
                            <i class="ri-control-line"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteDevice(${device.id})">
                            <i class="ri-delete-line"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // 更新分页按钮
            updatePagination();
        }
        
        // 获取设备图标
        function getDeviceIcon(type) {
            const iconMap = {
                light: 'lightbulb-line',
                socket: 'power-plug-line',
                lock: 'lock-line',
                camera: 'video-line',
                other: 'device-line'
            };
            return iconMap[type] || 'device-line';
        }
        
        // 获取设备类型名称
        function getDeviceTypeName(type) {
            const typeMap = {
                light: '灯光',
                socket: '插座',
                lock: '门锁',
                camera: '摄像头',
                other: '其他'
            };
            return typeMap[type] || '其他';
        }
        
        // 获取状态文本
        function getStatusText(status) {
            const statusMap = {
                online: '在线',
                offline: '离线',
                warning: '警告'
            };
            return statusMap[status] || '未知';
        }
        
        // 更新分页
        function updatePagination() {
            const totalPages = Math.ceil(filteredDevices.length / pageSize);
            
            // 隐藏/显示分页按钮
            for (let i = 1; i <= 3; i++) {
                const pageBtn = document.getElementById(`page${i}`);
                if (pageBtn) {
                    if (i <= totalPages) {
                        pageBtn.style.display = 'inline-block';
                        pageBtn.textContent = i;
                        pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                    } else {
                        pageBtn.style.display = 'none';
                    }
                }
            }
        }
        
        // 搜索设备
        function searchDevices() {
            currentPage = 1;
            loadDevices();
        }
        
        // 切换页面
        function changePage(page) {
            const totalPages = Math.ceil(filteredDevices.length / pageSize);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderDevices();
            }
        }
        
        // 添加设备
        async function addDevice() {
            try {
                // 这里可以实现添加设备的逻辑
                alert('添加设备功能开发中...');
            } catch (error) {
                console.error('添加设备错误:', error);
            }
        }
        
        // 查看设备
        async function viewDevice(id) {
            try {
                const response = await fetch(`/api/home/devices/${id}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    const device = data.device;
                    alert(`设备详情:\n名称: ${device.name}\n类型: ${getDeviceTypeName(device.type)}\n位置: ${device.location}\n状态: ${getStatusText(device.status)}\nIP: ${device.ip}\n最后活动: ${device.lastActive}`);
                } else {
                    alert('设备不存在');
                }
            } catch (error) {
                console.error('查看设备错误:', error);
            }
        }
        
        // 控制设备
        function controlDevice(id) {
            window.location.href = `device-control.html?id=${id}`;
        }
        
        // 删除设备
        async function deleteDevice(id) {
            if (confirm('确定要删除此设备吗？')) {
                try {
                    const response = await fetch(`/api/home/devices/${id}`, {
                        method: 'DELETE'
                    });
                    
                    const data = await response.json();
                    if (data.status === 'success') {
                        alert('设备删除成功');
                        loadDevices();
                    } else {
                        alert('设备删除失败: ' + data.message);
                    }
                } catch (error) {
                    console.error('删除设备错误:', error);
                    alert('删除设备失败');
                }
            }
        }
        
        // 切换主题
        function toggleTheme() {
            const body = document.body;
            if (body.classList.contains('dark-theme')) {
                body.classList.remove('dark-theme');
            } else {
                body.classList.add('dark-theme');
            }
        }
        
        // 初始化
        init();
        
        // 绑定事件
        document.getElementById('searchInput').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                searchDevices();
            }
        });
        
        document.getElementById('statusFilter').addEventListener('change', searchDevices);
        document.getElementById('typeFilter').addEventListener('change', searchDevices);
    </script>
</body>
</html>