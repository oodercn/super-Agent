<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="OoderAgent Console - ä¸»æ§èŠ‚ç‚¹ç®¡ç†æ§åˆ¶å°">
    <meta name="theme-color" content="#000000">
    <title>OoderAgent Console</title>
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css"></noscript>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="container">
        <!-- ä¾§è¾¹å¯¼èˆªæ  -->
        <div class="sidebar">
            <h2 style="display: flex; align-items: center; gap: 12px;"><i class="ri-server-line"></i> OoderAgent</h2>
            <ul class="nav-menu" id="nav-menu"></ul>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="header">
                <h1><i class="ri-server-line"></i> OoderAgent æ§åˆ¶å°</h1>
                <div class="subtitle">
                    <span class="badge" style="background-color: var(--ooder-primary); color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-right: 16px;">v0.6.5</span>
                    <span>Ooder Rad Style</span> | 
                    <span id="timestamp"></span>
                </div>
            </div>
            
            <!-- é¡µé¢å†…å®¹åŒºåŸŸ -->
            <div id="page-content">
                <!-- é¡µé¢å†…å®¹å°†é€šè¿‡é¡µé¢è·³è½¬åŠ è½½ -->
                <div class="section" style="text-align: center; padding: 64px;">
                    <h2>æ¬¢è¿ä½¿ç”¨ MCP Agent æ§åˆ¶å°</h2>
                    <p style="margin-top: 16px; color: var(--ooder-secondary);">è¯·ä»å·¦ä¾§èœå•é€‰æ‹©è¦è®¿é—®çš„åŠŸèƒ½</p>
                    <div style="margin-top: 32px; font-size: 64px;">
                        <i class="ri-server-line"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- åŠ è½½çŠ¶æ€å’Œé”™è¯¯æç¤º -->
    <div class="loading-overlay" id="loading-overlay">
        <div style="text-align: center;">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loading-text">åŠ è½½ä¸­...</div>
        </div>
    </div>
    <div class="error-toast" id="error-toast">
        <div class="message" id="error-message"></div>
        <div class="close" onclick="hideErrorToast()">Ã—</div>
    </div>
    <div class="success-toast" id="success-toast">
        <div class="message" id="success-message"></div>
    </div>
    
    <script defer>
        // é¡µé¢åŠ è½½æ€§èƒ½ä¼˜åŒ–
        (function() {
            // ç¦æ­¢é¼ æ ‡å³é”®èœå•ï¼ˆå¯é€‰ï¼‰
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
            
            // ç¦æ­¢æ–‡æœ¬é€‰æ‹©ï¼ˆå¯é€‰ï¼‰
            document.addEventListener('selectstart', function(e) {
                e.preventDefault();
            });
        })();
        
        // å½“å‰é¡µé¢
        let currentPage = 'dashboard';
        
        // APIåŸºç¡€URL
        const API_BASE_URL = '/api/mcp';
        
        // å½“å‰ç”¨æˆ·åœºæ™¯
        let currentScenario = null;
        
        // èœå•é…ç½®
        let menuConfig = null;
        
        // åˆå§‹åŒ–é¡µé¢
        function init() {
            updateTimestamp();
            loadMenuConfig();
            loadPage('dashboard');
            setInterval(updateTimestamp, 60000); // æ¯åˆ†é’Ÿæ›´æ–°æ—¶é—´æˆ³
        }
        
        // åŠ è½½èœå•é…ç½®
        async function loadMenuConfig() {
            try {
                const response = await fetch('menu-config.json');
                if (!response.ok) {
                    throw new Error('èœå•é…ç½®åŠ è½½å¤±è´¥');
                }
                menuConfig = await response.json();
                renderMenu();
            } catch (error) {
                console.error('åŠ è½½èœå•é…ç½®é”™è¯¯:', error);
                // åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé»˜è®¤èœå•
                renderDefaultMenu();
            }
        }
        
        // æ¸²æŸ“èœå•
        function renderMenu() {
            const navMenu = document.getElementById('nav-menu');
            navMenu.innerHTML = '';
            
            menuConfig.menu.forEach(item => {
                // åªæ˜¾ç¤ºå·²å®ç°çš„åŠŸèƒ½ï¼ˆstatusä¸ºimplementedï¼‰
                if (item.status === 'implemented' || item.id === 'dashboard') {
                    const menuItem = createMenuItem(item);
                    navMenu.appendChild(menuItem);
                    // æ·»åŠ èœå•åˆ†éš”çº¿
                    if (item.id !== 'dashboard') {
                        const divider = document.createElement('div');
                        divider.className = 'menu-divider';
                        navMenu.appendChild(divider);
                    }
                }
            });
            
            setupNavigation();
        }
        
        // åˆ›å»ºèœå•é¡¹
        function createMenuItem(menuItem) {
            const li = document.createElement('li');
            
            if (menuItem.children && menuItem.children.length > 0) {
                // æœ‰å­èœå•çš„èœå•é¡¹
                const a = document.createElement('a');
                a.href = `#${menuItem.id}`;
                a.innerHTML = `
                    <i class="${menuItem.icon}"></i>
                    ${menuItem.name}
                    <span class="toggle-icon">â€º</span>
                `;
                
                // å¤„ç†ç‚¹å‡»äº‹ä»¶
                a.addEventListener('click', function(e) {
                    e.preventDefault();
                    const toggleIcon = this.querySelector('.toggle-icon');
                    const submenu = this.nextElementSibling;
                    
                    if (submenu) {
                        submenu.classList.toggle('hidden');
                        toggleIcon.classList.toggle('collapsed');
                    }
                });
                
                li.appendChild(a);
                
                // åˆ›å»ºå­èœå•
                const submenu = document.createElement('ul');
                submenu.className = 'submenu';
                
                menuItem.children.forEach(childItem => {
                    // åªæ˜¾ç¤ºå·²å®ç°çš„å­åŠŸèƒ½
                    if (childItem.status === 'implemented') {
                        const childLi = createMenuItem(childItem);
                        submenu.appendChild(childLi);
                    }
                });
                
                // åªæœ‰å½“å­èœå•ä¸ä¸ºç©ºæ—¶æ‰æ·»åŠ 
                if (submenu.children.length > 0) {
                    li.appendChild(submenu);
                }
            } else {
                // æ— å­èœå•çš„èœå•é¡¹
                const a = document.createElement('a');
                if (menuItem.url) {
                    a.href = menuItem.url;
                } else {
                    a.href = `#${menuItem.id}`;
                    a.setAttribute('data-page', menuItem.page || menuItem.id);
                }
                a.innerHTML = `
                    <i class="${menuItem.icon}"></i>
                    ${menuItem.name}
                `;
                li.appendChild(a);
            }
            
            return li;
        }
        
        // æ¸²æŸ“é»˜è®¤èœå•ï¼ˆåŠ è½½å¤±è´¥æ—¶ä½¿ç”¨ï¼‰
        function renderDefaultMenu() {
            const navMenu = document.getElementById('nav-menu');
            navMenu.innerHTML = `
                <li><a href="#dashboard" class="active" data-page="dashboard"><i class="ri-dashboard-line"></i> ä»ªè¡¨ç›˜</a></li>
                <li><a href="#system" data-page="system"><i class="ri-computer-line"></i> ç³»ç»Ÿä¿¡æ¯</a></li>
                <li><a href="#network" data-page="network"><i class="ri-network-line"></i> ç½‘ç»œçŠ¶æ€</a></li>
                <li><a href="#logs" data-page="logs"><i class="ri-file-text-line"></i> æ—¥å¿—æŸ¥çœ‹</a></li>
                <li><a href="#tests" data-page="tests"><i class="ri-test-tube-line"></i> æµ‹è¯•ç”¨ä¾‹</a></li>
                <li><a href="#config" data-page="config"><i class="ri-settings-3-line"></i> é…ç½®ç®¡ç†</a></li>
            `;
            setupNavigation();
        }
        
        // è¿›å…¥ç”¨æˆ·åœºæ™¯
        function enterScenario(scenario) {
            currentScenario = scenario;
            
            // éšè—åœºæ™¯é€‰æ‹©ï¼Œæ˜¾ç¤ºç³»ç»Ÿæ¦‚è§ˆ
            document.querySelector('.section').classList.add('hidden');
            document.getElementById('system-overview-section').classList.remove('hidden');
            
            // æ ¹æ®åœºæ™¯åŠ è½½ä¸åŒçš„åŠŸèƒ½
            loadScenarioFeatures(scenario);
            
            // åŠ è½½ç³»ç»ŸçŠ¶æ€
            loadDashboard();
        }
        
        // åŠ è½½åœºæ™¯ç‰¹å®šåŠŸèƒ½
        function loadScenarioFeatures(scenario) {
            console.log('è¿›å…¥åœºæ™¯:', scenario);
            
            // æ ¹æ®åœºæ™¯æ˜¾ç¤ºä¸åŒçš„å¯¼èˆªèœå•
            const navMenu = document.querySelector('.nav-menu');
            const navItems = navMenu.querySelectorAll('li');
            
            // é‡ç½®æ‰€æœ‰å¯¼èˆªé¡¹
            navItems.forEach(item => item.style.display = 'none');
            
            // æ ¹æ®åœºæ™¯æ˜¾ç¤ºä¸åŒçš„å¯¼èˆªé¡¹
            switch(scenario) {
                case 'enterprise':
                    // å°å¾®ä¼ä¸šåœºæ™¯ï¼šæ˜¾ç¤ºæ‰€æœ‰åŠŸèƒ½
                    navItems.forEach(item => item.style.display = 'block');
                    break;
                case 'personal':
                    // ä¸ªäººç”¨æˆ·åœºæ™¯ï¼šåªæ˜¾ç¤ºåŸºæœ¬åŠŸèƒ½
                    navItems[0].style.display = 'block'; // ä»ªè¡¨ç›˜
                    navItems[1].style.display = 'block'; // ç³»ç»Ÿä¿¡æ¯
                    navItems[2].style.display = 'block'; // ç½‘ç»œçŠ¶æ€
                    break;
                case 'multi-network':
                    // é›†ä¸­å¤šç½‘ç«¯åœºæ™¯ï¼šæ˜¾ç¤ºé«˜çº§åŠŸèƒ½
                    navItems.forEach(item => item.style.display = 'block');
                    break;
            }
            
            // æ˜¾ç¤ºåœºæ™¯ä¿¡æ¯
            const header = document.querySelector('.header h1');
            switch(scenario) {
                case 'enterprise':
                    header.innerHTML = '<span>ğŸ¢</span> å°å¾®ä¼ä¸šæ§åˆ¶å°';
                    break;
                case 'personal':
                    header.innerHTML = '<span>ğŸ‘¤</span> ä¸ªäººç”¨æˆ·æ§åˆ¶å°';
                    break;
                case 'multi-network':
                    header.innerHTML = '<span>ğŸŒ</span> é›†ä¸­å¤šç½‘ç«¯æ§åˆ¶å°';
                    break;
            }
        }
        
        // æ›´æ–°æ—¶é—´æˆ³
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('timestamp').textContent = now.toLocaleString('zh-CN');
        }
        
        // è®¾ç½®å¯¼èˆª
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-menu a');
            navLinks.forEach(link => {
                // åªå¤„ç†å¸¦æœ‰data-pageå±æ€§çš„é“¾æ¥ï¼ˆå³å¶å­èŠ‚ç‚¹ä¸”æ²¡æœ‰urlå±æ€§ï¼‰
                if (link.hasAttribute('data-page') && !link.hasAttribute('href') && link.getAttribute('href') !== '#') {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // æ›´æ–°æ´»è·ƒçŠ¶æ€
                        navLinks.forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                        
                        // åŠ è½½å¯¹åº”é¡µé¢
                        const page = this.getAttribute('data-page');
                        loadPage(page);
                    });
                }
            });
        }
        
        // åŠ è½½é¡µé¢
        function loadPage(page) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            
            // æŸ¥æ‰¾ç›®æ ‡é¡µé¢
            const targetPage = document.getElementById(`page-${page}`);
            
            if (targetPage) {
                // æ˜¾ç¤ºå·²å­˜åœ¨çš„é¡µé¢
                targetPage.classList.remove('hidden');
            } else {
                // å¯¹äºä¸å­˜åœ¨çš„é¡µé¢ï¼Œæ˜¾ç¤ºé»˜è®¤å†…å®¹
                const mainContent = document.querySelector('.main-content');
                // æŸ¥æ‰¾æˆ–åˆ›å»ºé»˜è®¤é¡µé¢å®¹å™¨
                let defaultPage = document.getElementById('page-default');
                if (!defaultPage) {
                    defaultPage = document.createElement('div');
                    defaultPage.id = 'page-default';
                    defaultPage.className = 'page';
                    mainContent.appendChild(defaultPage);
                }
                // è®¾ç½®é»˜è®¤é¡µé¢å†…å®¹
                defaultPage.innerHTML = `
                    <div class="header">
                        <h1><i class="ri-page-line"></i> ${getPageName(page)}</h1>
                        <div class="subtitle">é¡µé¢æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…</div>
                    </div>
                    <div class="section">
                        <h2>é¡µé¢ä¿¡æ¯</h2>
                        <div class="status-grid">
                            <div class="status-item ok">
                                <div class="key">é¡µé¢ID</div>
                                <div class="value">${page}</div>
                            </div>
                            <div class="status-item ok">
                                <div class="key">çŠ¶æ€</div>
                                <div class="value">å¼€å‘ä¸­</div>
                            </div>
                            <div class="status-item ok">
                                <div class="key">æœ€åæ›´æ–°</div>
                                <div class="value">${new Date().toLocaleString('zh-CN')}</div>
                            </div>
                        </div>
                    </div>
                    <div class="section">
                        <h2>åŠŸèƒ½é¢„è§ˆ</h2>
                        <p>æ­¤é¡µé¢å°†åœ¨åç»­ç‰ˆæœ¬ä¸­å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
                        <ul style="margin-left: 24px; margin-top: 16px; color: var(--ooder-secondary);">
                            <li>é¡µé¢ç›¸å…³çš„æ ¸å¿ƒåŠŸèƒ½</li>
                            <li>æ•°æ®å¯è§†åŒ–å±•ç¤º</li>
                            <li>äº¤äº’æ“ä½œåŠŸèƒ½</li>
                            <li>ä¸åç«¯APIçš„é›†æˆ</li>
                        </ul>
                    </div>
                `;
                defaultPage.classList.remove('hidden');
            }
            
            currentPage = page;
            
            // åŠ è½½é¡µé¢æ•°æ®
            switch(page) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'system':
                    loadSystemInfo();
                    break;
                case 'network':
                    loadNetworkInfo();
                    break;
                case 'logs':
                    loadLogs();
                    break;
                case 'tests':
                    loadTests();
                    break;
                case 'settings':
                    loadSettings();
                    break;
                case 'config':
                    loadConfig();
                    break;
            }
        }
        
        // è·å–é¡µé¢åç§°
        function getPageName(pageId) {
            // ä»èœå•é…ç½®ä¸­æŸ¥æ‰¾é¡µé¢åç§°
            if (menuConfig) {
                const findPageName = (menuItems) => {
                    for (const item of menuItems) {
                        if (item.page === pageId || item.id === pageId) {
                            return item.name;
                        }
                        if (item.children) {
                            const name = findPageName(item.children);
                            if (name) {
                                return name;
                            }
                        }
                    }
                    return null;
                };
                const name = findPageName(menuConfig.menu);
                if (name) {
                    return name;
                }
            }
            // é»˜è®¤é¡µé¢åç§°
            return pageId.charAt(0).toUpperCase() + pageId.slice(1).replace('-', ' ');
        }
        
        // APIè¯·æ±‚ç¼“å­˜
        const apiCache = new Map();
        const CACHE_EXPIRY = 30000; // ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        
        // APIè°ƒç”¨å‡½æ•°
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const url = `${API_BASE_URL}${endpoint}`;
                
                // ç”Ÿæˆç¼“å­˜é”®
                const cacheKey = `${method}:${url}${data ? ':' + JSON.stringify(data) : ''}`;
                
                // æ£€æŸ¥ç¼“å­˜
                if (method === 'GET' && apiCache.has(cacheKey)) {
                    const cached = apiCache.get(cacheKey);
                    if (Date.now() - cached.timestamp < CACHE_EXPIRY) {
                        console.log(`APIç¼“å­˜å‘½ä¸­: ${url}`);
                        return cached.data;
                    } else {
                        apiCache.delete(cacheKey);
                    }
                }
                
                console.log(`APIè°ƒç”¨: ${method} ${url}`, data);
                
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin',
                    cache: 'no-store'
                };
                
                if (data && (method === 'POST' || method === 'PUT')) {
                    options.body = JSON.stringify(data);
                }
                
                // å‘èµ·è¯·æ±‚
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10ç§’è¶…æ—¶
                options.signal = controller.signal;
                
                const response = await fetch(url, options);
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status} ${errorData.message || ''}`);
                }
                
                const responseData = await response.json();
                console.log(`APIå“åº”: ${url}`, responseData);
                
                // ç¼“å­˜GETè¯·æ±‚ç»“æœ
                if (method === 'GET') {
                    apiCache.set(cacheKey, {
                        data: responseData,
                        timestamp: Date.now()
                    });
                    
                    // é™åˆ¶ç¼“å­˜å¤§å°
                    if (apiCache.size > 50) {
                        const oldestKey = apiCache.keys().next().value;
                        apiCache.delete(oldestKey);
                    }
                }
                
                return responseData;
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.error('APIè°ƒç”¨è¶…æ—¶:', error);
                    return { status: 'error', message: 'APIè°ƒç”¨è¶…æ—¶' };
                }
                console.error('APIè°ƒç”¨é”™è¯¯:', error);
                return { status: 'error', message: error.message };
            }
        }
        
        // æ‰¹é‡APIè°ƒç”¨å‡½æ•°
        async function batchApiCall(calls) {
            try {
                const promises = calls.map(({ endpoint, method = 'GET', data }) => 
                    apiCall(endpoint, method, data)
                );
                
                return await Promise.all(promises);
            } catch (error) {
                console.error('æ‰¹é‡APIè°ƒç”¨é”™è¯¯:', error);
                return [];
            }
        }
        
        // æ¸…é™¤APIç¼“å­˜
        function clearApiCache() {
            apiCache.clear();
            console.log('APIç¼“å­˜å·²æ¸…é™¤');
        }
        
        // åŠ è½½çŠ¶æ€ç®¡ç†
        function showLoading(text = 'åŠ è½½ä¸­...') {
            const overlay = document.getElementById('loading-overlay');
            const loadingText = document.getElementById('loading-text');
            if (overlay && loadingText) {
                loadingText.textContent = text;
                overlay.classList.add('active');
            }
        }
        
        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
        }
        
        // é”™è¯¯æç¤ºç®¡ç†
        function showErrorToast(message, duration = 3000) {
            const toast = document.getElementById('error-toast');
            const errorMessage = document.getElementById('error-message');
            if (toast && errorMessage) {
                errorMessage.textContent = message;
                toast.classList.add('active');
                
                setTimeout(() => {
                    hideErrorToast();
                }, duration);
            }
        }
        
        function hideErrorToast() {
            const toast = document.getElementById('error-toast');
            if (toast) {
                toast.classList.remove('active');
            }
        }
        
        // æˆåŠŸæç¤ºç®¡ç†
        function showSuccessToast(message, duration = 3000) {
            const toast = document.getElementById('success-toast');
            const successMessage = document.getElementById('success-message');
            if (toast && successMessage) {
                successMessage.textContent = message;
                toast.classList.add('active');
                
                setTimeout(() => {
                    hideSuccessToast();
                }, duration);
            }
        }
        
        function hideSuccessToast() {
            const toast = document.getElementById('success-toast');
            if (toast) {
                toast.classList.remove('active');
            }
        }
        
        // ç»Ÿä¸€é”™è¯¯å¤„ç†
        function handleError(error, showToast = true) {
            console.error('é”™è¯¯å¤„ç†:', error);
            
            const errorMessage = error.message || String(error);
            
            if (showToast) {
                showErrorToast(errorMessage);
            }
            
            // å¯ä»¥æ·»åŠ é”™è¯¯æ—¥å¿—è®°å½•ç­‰å…¶ä»–å¤„ç†
            return { status: 'error', message: errorMessage };
        }
        
        // åŠ è½½ä»ªè¡¨ç›˜æ•°æ®
        async function loadDashboard() {
            // æ£€æŸ¥DOMå…ƒç´ æ˜¯å¦å­˜åœ¨
            const systemStatusEl = document.getElementById('system-status');
            const networkCountEl = document.getElementById('network-count');
            const cpuUsageEl = document.getElementById('cpu-usage');
            const memoryUsageEl = document.getElementById('memory-usage');
            const diskUsageEl = document.getElementById('disk-usage');
            const systemLoadEl = document.getElementById('system-load');
            const systemOverviewEl = document.getElementById('system-overview');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading('åŠ è½½ä»ªè¡¨ç›˜æ•°æ®...');
            if (systemStatusEl) systemStatusEl.textContent = 'åŠ è½½ä¸­...';
            if (networkCountEl) networkCountEl.textContent = 'åŠ è½½ä¸­...';
            if (cpuUsageEl) cpuUsageEl.textContent = 'åŠ è½½ä¸­...';
            if (memoryUsageEl) memoryUsageEl.textContent = 'åŠ è½½ä¸­...';
            
            try {
                // å¹¶è¡Œè°ƒç”¨å¤šä¸ªAPI
                const [healthData, networkData] = await Promise.all([
                    apiCall('/health'),
                    apiCall('/network/status')
                ]);
                
                // éšè—åŠ è½½çŠ¶æ€
                hideLoading();
                
                // æ›´æ–°ç³»ç»ŸçŠ¶æ€
                if (systemStatusEl) {
                    if (healthData.status === 'healthy') {
                        systemStatusEl.textContent = 'æ­£å¸¸è¿è¡Œ';
                    } else {
                        systemStatusEl.textContent = 'å¼‚å¸¸';
                    }
                }
                
                // æ›´æ–°ç½‘ç»œè¿æ¥æ•°
                if (networkCountEl) {
                    if (networkData.status && networkData.status.links) {
                        networkCountEl.textContent = networkData.status.links.length;
                    } else {
                        networkCountEl.textContent = '0';
                    }
                }
                
                // æ¨¡æ‹Ÿç³»ç»Ÿèµ„æºä½¿ç”¨ç‡ï¼ˆå®é™…é¡¹ç›®ä¸­å¯ä»¥é€šè¿‡ç³»ç»ŸAPIè·å–ï¼‰
                if (cpuUsageEl) cpuUsageEl.textContent = Math.floor(Math.random() * 100) + '%';
                if (memoryUsageEl) memoryUsageEl.textContent = Math.floor(Math.random() * 100) + '%';
                if (diskUsageEl) diskUsageEl.textContent = Math.floor(Math.random() * 100) + '%';
                if (systemLoadEl) systemLoadEl.textContent = (Math.random() * 4).toFixed(2);
                
                // ç³»ç»Ÿæ¦‚è§ˆ
                if (systemOverviewEl) {
                    systemOverviewEl.innerHTML = `
                        <div class="status-item ok">
                            <div class="key">å¯åŠ¨æ—¶é—´</div>
                            <div class="value">${new Date(healthData.timestamp).toLocaleString('zh-CN')}</div>
                        </div>
                        <div class="status-item ok">
                            <div class="key">æœåŠ¡çŠ¶æ€</div>
                            <div class="value">${healthData.status}</div>
                        </div>
                        <div class="status-item ok">
                            <div class="key">æœåŠ¡åç§°</div>
                            <div class="value">${healthData.service}</div>
                    </div>
                    <div class="status-item ok">
                        <div class="key">SDKç‰ˆæœ¬</div>
                        <div class="value">v0.6.5</div>
                    </div>
                `;
                }
                
                // ç½‘ç»œæ‹“æ‰‘
                const networkTopologyEl = document.getElementById('network-topology');
                if (networkTopologyEl) {
                    networkTopologyEl.innerHTML = `
                        <div class="status-grid">
                            <div class="status-item ok">
                                <div class="key">æœ¬åœ°èŠ‚ç‚¹</div>
                                <div class="value">mcp-agent-01</div>
                            </div>
                            <div class="status-item ok">
                                <div class="key">è¿æ¥èŠ‚ç‚¹</div>
                                <div class="value">${networkData.status && networkData.status.links ? networkData.status.links.length : 0}ä¸ªèŠ‚ç‚¹</div>
                            </div>
                            <div class="status-item ok">
                                <div class="key">ç½‘ç»œçŠ¶æ€</div>
                                <div class="value">${networkData.status ? 'æ­£å¸¸' : 'å¼‚å¸¸'}</div>
                            </div>
                            <div class="status-item ok">
                                <div class="key">æ›´æ–°æ—¶é—´</div>
                                <div class="value">${networkData.timestamp ? new Date(networkData.timestamp).toLocaleString('zh-CN') : '-'}</div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                // éšè—åŠ è½½çŠ¶æ€
                hideLoading();
                
                // å¤„ç†é”™è¯¯
                handleError(error);
                
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                if (systemStatusEl) systemStatusEl.textContent = 'é”™è¯¯';
                if (networkCountEl) networkCountEl.textContent = 'é”™è¯¯';
                if (cpuUsageEl) cpuUsageEl.textContent = 'é”™è¯¯';
                if (memoryUsageEl) memoryUsageEl.textContent = 'é”™è¯¯';
                if (diskUsageEl) diskUsageEl.textContent = 'é”™è¯¯';
                if (systemLoadEl) systemLoadEl.textContent = 'é”™è¯¯';
            }
        }
        
        // åŠ è½½ç³»ç»Ÿä¿¡æ¯
        async function loadSystemInfo() {
            try {
                // è°ƒç”¨åç«¯APIè·å–ç³»ç»Ÿç®¡ç†æ•°æ®
                const systemData = await apiCall('/system/status');
                
                console.log('ç³»ç»Ÿç®¡ç†æ•°æ®:', systemData);
                
                // æ˜¾ç¤ºåŠ è½½æˆåŠŸæç¤º
                const pageSystem = document.getElementById('page-system');
                // ç§»é™¤å·²æœ‰çš„æç¤º
                const existingAlert = pageSystem.querySelector('.alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // åˆ›å»ºæ–°çš„æˆåŠŸæç¤º
                const alert = document.createElement('div');
                alert.className = 'alert alert-success';
                alert.textContent = 'ç³»ç»Ÿç®¡ç†æ•°æ®åŠ è½½æˆåŠŸ';
                
                const firstSection = pageSystem.querySelector('.section');
                if (firstSection) {
                    pageSystem.insertBefore(alert, firstSection);
                }
                
                // 3ç§’åç§»é™¤æç¤º
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 3000);
                
                // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…è¿”å›çš„æ•°æ®æ›´æ–°é¡µé¢å†…å®¹
                // ç›®å‰é¡µé¢ä½¿ç”¨çš„æ˜¯é™æ€æ•°æ®ï¼Œåç»­å¯ä»¥æ ¹æ®åç«¯APIè¿”å›çš„æ•°æ®è¿›è¡ŒåŠ¨æ€æ›´æ–°
                
            } catch (error) {
                console.error('åŠ è½½ç³»ç»Ÿä¿¡æ¯é”™è¯¯:', error);
                
                // æ˜¾ç¤ºé”™è¯¯æç¤º
                const pageSystem = document.getElementById('page-system');
                // ç§»é™¤å·²æœ‰çš„æç¤º
                const existingAlert = pageSystem.querySelector('.alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // åˆ›å»ºæ–°çš„é”™è¯¯æç¤º
                const alert = document.createElement('div');
                alert.className = 'alert alert-error';
                alert.textContent = `ç³»ç»Ÿç®¡ç†æ•°æ®åŠ è½½å¤±è´¥: ${error.message}`;
                
                const firstSection = pageSystem.querySelector('.section');
                if (firstSection) {
                    pageSystem.insertBefore(alert, firstSection);
                }
                
                // 3ç§’åç§»é™¤æç¤º
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 3000);
            }
        }
        
        // åŠ è½½ç½‘ç»œä¿¡æ¯
        async function loadNetworkInfo() {
            try {
                // è°ƒç”¨åç«¯APIè·å–ç½‘ç»œç®¡ç†æ•°æ®
                const networkData = await apiCall('/network/status');
                
                console.log('ç½‘ç»œç®¡ç†æ•°æ®:', networkData);
                
                // æ˜¾ç¤ºåŠ è½½æˆåŠŸæç¤º
                const pageNetwork = document.getElementById('page-network');
                // ç§»é™¤å·²æœ‰çš„æç¤º
                const existingAlert = pageNetwork.querySelector('.alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // åˆ›å»ºæ–°çš„æˆåŠŸæç¤º
                const alert = document.createElement('div');
                alert.className = 'alert alert-success';
                alert.textContent = 'ç½‘ç»œç®¡ç†æ•°æ®åŠ è½½æˆåŠŸ';
                
                const firstSection = pageNetwork.querySelector('.section');
                if (firstSection) {
                    pageNetwork.insertBefore(alert, firstSection);
                }
                
                // 3ç§’åç§»é™¤æç¤º
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 3000);
                
                // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…è¿”å›çš„æ•°æ®æ›´æ–°é¡µé¢å†…å®¹
                // ç›®å‰é¡µé¢ä½¿ç”¨çš„æ˜¯é™æ€æ•°æ®ï¼Œåç»­å¯ä»¥æ ¹æ®åç«¯APIè¿”å›çš„æ•°æ®è¿›è¡ŒåŠ¨æ€æ›´æ–°
                
            } catch (error) {
                console.error('åŠ è½½ç½‘ç»œä¿¡æ¯é”™è¯¯:', error);
                
                // æ˜¾ç¤ºé”™è¯¯æç¤º
                const pageNetwork = document.getElementById('page-network');
                // ç§»é™¤å·²æœ‰çš„æç¤º
                const existingAlert = pageNetwork.querySelector('.alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // åˆ›å»ºæ–°çš„é”™è¯¯æç¤º
                const alert = document.createElement('div');
                alert.className = 'alert alert-error';
                alert.textContent = `ç½‘ç»œç®¡ç†æ•°æ®åŠ è½½å¤±è´¥: ${error.message}`;
                
                const firstSection = pageNetwork.querySelector('.section');
                if (firstSection) {
                    pageNetwork.insertBefore(alert, firstSection);
                }
                
                // 3ç§’åç§»é™¤æç¤º
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 3000);
            }
        }
        
        // æ›´æ–°è·¯ç”±åˆ—è¡¨
        function updateRouteList() {
            const routeList = document.getElementById('route-list');
            routeList.innerHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>è·¯ç”±ID</th>
                                <th>ç±»å‹</th>
                                <th>çŠ¶æ€</th>
                                <th>æœ€åæ›´æ–°æ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>route_1</td>
                                <td>ç›´æ¥è·¯ç”±</td>
                                <td>æ´»è·ƒ</td>
                                <td>${new Date().toLocaleString('zh-CN')}</td>
                                <td>
                                    <button class="btn btn-secondary">è¯¦æƒ…</button>
                                </td>
                            </tr>
                            <tr>
                                <td>route_2</td>
                                <td>é—´æ¥è·¯ç”±</td>
                                <td>æ´»è·ƒ</td>
                                <td>${new Date().toLocaleString('zh-CN')}</td>
                                <td>
                                    <button class="btn btn-secondary">è¯¦æƒ…</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // æ›´æ–°ç»ˆç«¯åˆ—è¡¨
        function updateEndAgentList() {
            // è¿™é‡Œå¯ä»¥æ·»åŠ ç»ˆç«¯åˆ—è¡¨çš„æ›´æ–°é€»è¾‘
        }
        
        // æ˜¾ç¤ºé“¾è·¯è¯¦æƒ…
        function showLinkDetails(linkId) {
            alert(`æ˜¾ç¤ºé“¾è·¯ ${linkId} çš„è¯¦æƒ…`);
        }
        
        // ç§»é™¤é“¾è·¯
        function removeLink(linkId) {
            if (confirm(`ç¡®å®šè¦ç§»é™¤é“¾è·¯ ${linkId} å—ï¼Ÿ`)) {
                alert(`é“¾è·¯ ${linkId} å·²ç§»é™¤`);
                // é‡æ–°åŠ è½½ç½‘ç»œä¿¡æ¯
                loadNetworkInfo();
            }
        }
        
        // åŠ è½½æ—¥å¿—
        function loadLogs() {
            // æ¨¡æ‹Ÿæ•°æ®åŠ è½½ï¼ˆå®é™…é¡¹ç›®ä¸­å¯ä»¥é€šè¿‡æ—¥å¿—APIè·å–ï¼‰
            setTimeout(() => {
                const logsContent = document.getElementById('logs-content');
                logsContent.innerHTML = `
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>æ—¶é—´</th>
                                    <th>çº§åˆ«</th>
                                    <th>å†…å®¹</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2026-01-30 14:46:43</td>
                                    <td>INFO</td>
                                    <td>MCP Agent started successfully</td>
                                </tr>
                                <tr>
                                    <td>2026-01-30 14:46:43</td>
                                    <td>INFO</td>
                                    <td>Network service initialized</td>
                                </tr>
                                <tr>
                                    <td>2026-01-30 14:46:43</td>
                                    <td>INFO</td>
                                    <td>Agent SDK initialized (v0.6.5)</td>
                                </tr>
                                <tr>
                                    <td>2026-01-30 14:46:40</td>
                                    <td>INFO</td>
                                    <td>Spring Boot application starting</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;
            }, 500);
        }
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
            setTimeout(() => {
                const settingsContent = document.getElementById('settings-content');
                settingsContent.innerHTML = `
                    <div id="config-form">
                        <div class="status-grid">
                            <div class="status-item ok">
                                <div class="key">SDKç‰ˆæœ¬</div>
                                <div class="value">v0.6.5</div>
                            </div>
                            <div class="status-item ok">
                                <div class="key">æœåŠ¡ç«¯å£</div>
                                <div class="value">8080</div>
                            </div>
                            <div class="status-item ok">
                                <div class="key">å¿ƒè·³é—´éš”</div>
                                <div class="value">30ç§’</div>
                            </div>
                            <div class="status-item ok">
                                <div class="key">æ—¥å¿—çº§åˆ«</div>
                                <div class="value">INFO</div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveConfig()">ä¿å­˜é…ç½®</button>
                        <button class="btn btn-secondary" onclick="resetConfig()">é‡ç½®é…ç½®</button>
                    </div>
                `;
            }, 500);
        }
        
        // æ·»åŠ é“¾è·¯
        function addLink() {
            const linkForm = document.getElementById('link-form');
            if (linkForm.classList.contains('hidden')) {
                linkForm.classList.remove('hidden');
                // æ·»åŠ è¡¨å•æäº¤äº‹ä»¶
                const form = linkForm.querySelector('button.btn-success');
                form.onclick = async function() {
                    const source = document.getElementById('source').value;
                    const target = document.getElementById('target').value;
                    const linkType = document.getElementById('link-type').value;
                    const linkId = document.getElementById('link-id').value;
                    
                    if (!source || !target) {
                        alert('è¯·è¾“å…¥æºèŠ‚ç‚¹å’Œç›®æ ‡èŠ‚ç‚¹');
                        return;
                    }
                    
                    try {
                        const response = await apiCall('/network/link', 'POST', {
                            linkId: linkId || 'link-' + Date.now(),
                            sourceAgentId: source,
                            targetAgentId: target,
                            linkType: linkType
                        });
                        
                        if (response.status === 'success') {
                            alert('é“¾è·¯æ·»åŠ æˆåŠŸ');
                            linkForm.classList.add('hidden');
                            document.getElementById('source').value = '';
                            document.getElementById('target').value = '';
                            document.getElementById('link-type').value = 'direct';
                            document.getElementById('link-id').value = '';
                            // é‡æ–°åŠ è½½ç½‘ç»œä¿¡æ¯
                            loadNetworkInfo();
                        } else {
                            alert('é“¾è·¯æ·»åŠ å¤±è´¥: ' + response.message);
                        }
                    } catch (error) {
                        alert('é“¾è·¯æ·»åŠ å¤±è´¥: ' + error.message);
                    }
                };
            } else {
                linkForm.classList.add('hidden');
            }
        }
        
        // æ·»åŠ ç»ˆç«¯
        function addEndAgent() {
            const endagentForm = document.getElementById('endagent-form');
            endagentForm.classList.remove('hidden');
            
            // æ·»åŠ è¡¨å•æäº¤äº‹ä»¶
            const form = endagentForm.querySelector('button.btn-success');
            form.onclick = async function() {
                const endagentId = document.getElementById('endagent-id').value;
                const endagentName = document.getElementById('endagent-name').value;
                const endagentType = document.getElementById('endagent-type').value;
                const endagentDesc = document.getElementById('endagent-desc').value;
                
                if (!endagentId || !endagentName) {
                    alert('è¯·è¾“å…¥ç»ˆç«¯IDå’Œç»ˆç«¯åç§°');
                    return;
                }
                
                try {
                    // æ¨¡æ‹Ÿæ·»åŠ ç»ˆç«¯ï¼ˆå®é™…é¡¹ç›®ä¸­åº”è¯¥è°ƒç”¨çœŸå®çš„APIï¼‰
                    // è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æµ‹è¯•å‘½ä»¤APIæ¥æ¨¡æ‹Ÿæ·»åŠ ç»ˆç«¯
                    const response = await apiCall('/command/test', 'POST', {
                        commandType: 'ENDAGENT_ADD',
                        data: {
                            endagentId: endagentId,
                            endagentName: endagentName,
                            endagentType: endagentType,
                            endagentDesc: endagentDesc
                        }
                    });
                    
                    if (response.status === 'success') {
                        alert('ç»ˆç«¯æ·»åŠ æˆåŠŸ');
                        endagentForm.classList.add('hidden');
                        document.getElementById('endagent-id').value = '';
                        document.getElementById('endagent-name').value = '';
                        document.getElementById('endagent-type').value = '';
                        document.getElementById('endagent-desc').value = '';
                        // é‡æ–°åŠ è½½ç½‘ç»œä¿¡æ¯
                        loadNetworkInfo();
                    } else {
                        alert('ç»ˆç«¯æ·»åŠ å¤±è´¥: ' + response.message);
                    }
                } catch (error) {
                    alert('ç»ˆç«¯æ·»åŠ å¤±è´¥: ' + error.message);
                }
            };
        }
        
        // å‘ç°ç»ˆç«¯
        function discoverEndAgents() {
            alert('å¼€å§‹å‘ç°ç»ˆç«¯...');
            
            // æ¨¡æ‹Ÿå‘ç°ç»ˆç«¯
            setTimeout(async function() {
                try {
                    const response = await apiCall('/command/test', 'POST', {
                        commandType: 'ENDAGENT_DISCOVER'
                    });
                    
                    if (response.status === 'success') {
                        alert('ç»ˆç«¯å‘ç°å®Œæˆ');
                        // é‡æ–°åŠ è½½ç½‘ç»œä¿¡æ¯
                        loadNetworkInfo();
                    } else {
                        alert('ç»ˆç«¯å‘ç°å¤±è´¥: ' + response.message);
                    }
                } catch (error) {
                    alert('ç»ˆç«¯å‘ç°å¤±è´¥: ' + error.message);
                }
            }, 1000);
        }
        
        // å‘ç°è·¯ç”±
        function discoverRoutes() {
            alert('å¼€å§‹å‘ç°è·¯ç”±...');
            
            // æ¨¡æ‹Ÿå‘ç°è·¯ç”±
            setTimeout(async function() {
                try {
                    const response = await apiCall('/command/test', 'POST', {
                        commandType: 'ROUTE_QUERY'
                    });
                    
                    if (response.status === 'success') {
                        alert('è·¯ç”±å‘ç°å®Œæˆ');
                        // é‡æ–°åŠ è½½ç½‘ç»œä¿¡æ¯
                        loadNetworkInfo();
                    } else {
                        alert('è·¯ç”±å‘ç°å¤±è´¥: ' + response.message);
                    }
                } catch (error) {
                    alert('è·¯ç”±å‘ç°å¤±è´¥: ' + error.message);
                }
            }, 1000);
        }
        
        // åˆ·æ–°è·¯ç”±
        function refreshRoutes() {
            alert('åˆ·æ–°è·¯ç”±åˆ—è¡¨...');
            // é‡æ–°åŠ è½½ç½‘ç»œä¿¡æ¯
            loadNetworkInfo();
        }
        
        // æŸ¥çœ‹RouteAgentè¯¦æƒ…
        async function viewRouteAgentDetails() {
            const routeAgentId = 'route-agent-001';
            const detailsSection = document.getElementById('routeagent-details');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            detailsSection.innerHTML = '<div style="text-align: center; padding: 48px;"><div class="loading"></div><p style="margin-top: 16px;">åŠ è½½RouteAgentè¯¦æƒ…...</p></div>';
            detailsSection.classList.remove('hidden');
            
            try {
                // å¹¶è¡Œè·å–æ‰€æœ‰RouteAgentæ•°æ®
                const [detailsData, vfsData, capabilitiesData, linksData] = await Promise.all([
                    apiCall(`/network/routeagent/${routeAgentId}`),
                    apiCall(`/network/routeagent/${routeAgentId}/vfs`),
                    apiCall(`/network/routeagent/${routeAgentId}/capabilities`),
                    apiCall(`/network/routeagent/${routeAgentId}/links`)
                ]);
                
                // æ„å»ºè¯¦æƒ…é¡µé¢
                let html = `
                    <h3 style="margin-bottom: 16px;">RouteAgentè¯¦æƒ…</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <div>
                            <h4>åŸºæœ¬ä¿¡æ¯</h4>
                            <div class="status-grid">
                                <div class="status-item ok">
                                    <div class="key">RouteAgent ID</div>
                                    <div class="value">${detailsData.data.id}</div>
                                </div>
                                <div class="status-item ok">
                                    <div class="key">çŠ¶æ€</div>
                                    <div class="value">${detailsData.data.status}</div>
                                </div>
                                <div class="status-item ok">
                                    <div class="key">ç‰ˆæœ¬</div>
                                    <div class="value">${detailsData.data.version}</div>
                                </div>
                                <div class="status-item ok">
                                    <div class="key">æœ€åæ›´æ–°</div>
                                    <div class="value">${new Date(detailsData.data.lastUpdate).toLocaleString('zh-CN')}</div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4>èƒ½åŠ›åˆ—è¡¨</h4>
                            <div class="status-grid">
                `;
                
                // æ·»åŠ èƒ½åŠ›åˆ—è¡¨
                const capabilities = capabilitiesData.data;
                Object.entries(capabilities).forEach(([key, value]) => {
                    html += `
                                <div class="status-item ok">
                                    <div class="key">${key}</div>
                                    <div class="value">${value ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}</div>
                                </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 24px;">
                        <h4>VFSæ–‡ä»¶ç³»ç»Ÿ</h4>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>è·¯å¾„</th>
                                        <th>ç±»å‹</th>
                                        <th>å¤§å°</th>
                                        <th>æœ€åä¿®æ”¹</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                // æ·»åŠ VFSæ–‡ä»¶åˆ—è¡¨
                const files = vfsData.data.files;
                files.forEach(file => {
                    html += `
                                    <tr>
                                        <td>${vfsData.data.path}/${file.name}</td>
                                        <td>${file.type}</td>
                                        <td>${file.size}</td>
                                        <td>${new Date(file.lastModified).toLocaleString('zh-CN')}</td>
                                    </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div style="margin-top: 24px;">
                        <h4>å†…éƒ¨é“¾è·¯</h4>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>é“¾è·¯ID</th>
                                        <th>æºèŠ‚ç‚¹</th>
                                        <th>ç›®æ ‡èŠ‚ç‚¹</th>
                                        <th>çŠ¶æ€</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                // æ·»åŠ é“¾è·¯åˆ—è¡¨
                const links = linksData.data;
                links.forEach(link => {
                    html += `
                                    <tr>
                                        <td>${link.linkId}</td>
                                        <td>${link.source}</td>
                                        <td>${link.target}</td>
                                        <td>${link.status}</td>
                                    </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="document.getElementById('routeagent-details').classList.add('hidden')" style="margin-top: 24px;">å…³é—­</button>
                `;
                
                detailsSection.innerHTML = html;
            } catch (error) {
                console.error('åŠ è½½RouteAgentè¯¦æƒ…é”™è¯¯:', error);
                detailsSection.innerHTML = `
                    <div class="alert alert-error">
                        <strong>é”™è¯¯:</strong> åŠ è½½RouteAgentè¯¦æƒ…å¤±è´¥
                    </div>
                    <button class="btn btn-secondary" onclick="document.getElementById('routeagent-details').classList.add('hidden')">å…³é—­</button>
                `;
            }
        }
        
        // ç§»é™¤é“¾è·¯
        function removeLink() {
            alert('è¯·é€‰æ‹©è¦ç§»é™¤çš„é“¾è·¯');
        }
        
        // ä¿å­˜é…ç½®
        function saveConfig() {
            alert('é…ç½®ä¿å­˜æˆåŠŸ');
        }
        
        // é‡ç½®é…ç½®
        function resetConfig() {
            alert('é…ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
        }
        
        // åŠ è½½é…ç½®ç®¡ç†é¡µé¢
        async function loadConfig() {
            try {
                // è°ƒç”¨åç«¯APIè·å–é…ç½®æ•°æ®
                const configData = await apiCall('/config/status');
                
                console.log('é…ç½®æ•°æ®:', configData);
                
                // æ˜¾ç¤ºåŠ è½½æˆåŠŸæç¤º
                const pageConfig = document.getElementById('page-config');
                // ç§»é™¤å·²æœ‰çš„æç¤º
                const existingAlert = pageConfig.querySelector('.alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // åˆ›å»ºæ–°çš„æˆåŠŸæç¤º
                const alert = document.createElement('div');
                alert.className = 'alert alert-success';
                alert.textContent = 'é…ç½®ä¸­å¿ƒæ•°æ®åŠ è½½æˆåŠŸ';
                
                const firstSection = pageConfig.querySelector('.section');
                if (firstSection) {
                    pageConfig.insertBefore(alert, firstSection);
                }
                
                // 3ç§’åç§»é™¤æç¤º
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 3000);
                
                // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…è¿”å›çš„æ•°æ®æ›´æ–°é¡µé¢å†…å®¹
                // ç›®å‰é¡µé¢ä½¿ç”¨çš„æ˜¯é™æ€æ•°æ®ï¼Œåç»­å¯ä»¥æ ¹æ®åç«¯APIè¿”å›çš„æ•°æ®è¿›è¡ŒåŠ¨æ€æ›´æ–°
                
            } catch (error) {
                console.error('åŠ è½½é…ç½®é”™è¯¯:', error);
                
                // æ˜¾ç¤ºé”™è¯¯æç¤º
                const pageConfig = document.getElementById('page-config');
                // ç§»é™¤å·²æœ‰çš„æç¤º
                const existingAlert = pageConfig.querySelector('.alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // åˆ›å»ºæ–°çš„é”™è¯¯æç¤º
                const alert = document.createElement('div');
                alert.className = 'alert alert-error';
                alert.textContent = `é…ç½®ä¸­å¿ƒæ•°æ®åŠ è½½å¤±è´¥: ${error.message}`;
                
                const firstSection = pageConfig.querySelector('.section');
                if (firstSection) {
                    pageConfig.insertBefore(alert, firstSection);
                }
                
                // 3ç§’åç§»é™¤æç¤º
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 3000);
            }
        }
        
        // ä¿å­˜MCPé…ç½®
        function saveMcpConfig() {
            alert('MCPé…ç½®ä¿å­˜æˆåŠŸ');
        }
        
        // é‡ç½®MCPé…ç½®
        function resetMcpConfig() {
            alert('MCPé…ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
        }
        
        // ä¿å­˜Routeé…ç½®
        function saveRouteConfig() {
            alert('Routeé…ç½®ä¿å­˜æˆåŠŸ');
        }
        
        // é‡ç½®Routeé…ç½®
        function resetRouteConfig() {
            alert('Routeé…ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
        }
        
        // ä¿å­˜Endé…ç½®
        function saveEndConfig() {
            alert('Endé…ç½®ä¿å­˜æˆåŠŸ');
        }
        
        // é‡ç½®Endé…ç½®
        function resetEndConfig() {
            alert('Endé…ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
        }
        
        // åŠ è½½æµ‹è¯•ç”¨ä¾‹æ•°æ®
        function loadTests() {
            // ç»˜åˆ¶æµ‹è¯•ç”¨ä¾‹åˆ†å¸ƒå›¾è¡¨
            drawTestDistributionChart();
            
            // ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ç»“æœ
            generateTestResults();
        }
        
        // ç»˜åˆ¶æµ‹è¯•ç”¨ä¾‹åˆ†å¸ƒå›¾è¡¨
        function drawTestDistributionChart() {
            const chartContainer = document.getElementById('test-distribution-chart');
            chartContainer.innerHTML = '';
            
            // æµ‹è¯•ç”¨ä¾‹åˆ†ç±»æ•°æ®
            const testCategories = [
                { name: 'æ³¨å†ŒåŠŸèƒ½', count: 15, color: 'var(--ooder-primary)' },
                { name: 'æ³¨é”€åŠŸèƒ½', count: 10, color: 'var(--ooder-secondary)' },
                { name: 'å¿ƒè·³åŠŸèƒ½', count: 20, color: 'var(--ooder-success)' },
                { name: 'çŠ¶æ€æŸ¥è¯¢', count: 18, color: 'var(--ooder-warning)' },
                { name: 'å‘ç°åŠŸèƒ½', count: 15, color: 'var(--ooder-danger)' },
                { name: 'è·¯ç”±æŸ¥è¯¢', count: 12, color: '#1abc9c' },
                { name: 'è®¤è¯åŠŸèƒ½', count: 10, color: '#34495e' },
                { name: 'å…¶ä»–åŠŸèƒ½', count: 8, color: '#95a5a6' }
            ];
            
            // è®¡ç®—æ€»æµ‹è¯•ç”¨ä¾‹æ•°
            const totalTests = testCategories.reduce((sum, category) => sum + category.count, 0);
            
            // è®¡ç®—æ¯ä¸ªç±»åˆ«çš„å®½åº¦å’Œä½ç½®
            const containerWidth = chartContainer.offsetWidth;
            const containerHeight = chartContainer.offsetHeight;
            const barWidth = (containerWidth - 48) / testCategories.length;
            const maxHeight = containerHeight - 48;
            
            // åˆ›å»ºæŸ±çŠ¶å›¾
            testCategories.forEach((category, index) => {
                const barHeight = (category.count / totalTests) * maxHeight;
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.width = barWidth - 12 + 'px';
                bar.style.height = barHeight + 'px';
                bar.style.left = 24 + index * barWidth + 'px';
                bar.style.backgroundColor = category.color;
                bar.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
                bar.title = `${category.name}: ${category.count}ä¸ªæµ‹è¯•ç”¨ä¾‹`;
                chartContainer.appendChild(bar);
                
                // æ·»åŠ ç±»åˆ«æ ‡ç­¾
                const label = document.createElement('div');
                label.style.position = 'absolute';
                label.style.bottom = '8px';
                label.style.left = 24 + index * barWidth + 'px';
                label.style.width = barWidth - 12 + 'px';
                label.style.textAlign = 'center';
                label.style.fontSize = '12px';
                label.style.color = 'var(--ooder-secondary)';
                label.style.fontWeight = '500';
                label.textContent = category.name;
                chartContainer.appendChild(label);
                
                // æ·»åŠ æ•°å€¼æ ‡ç­¾
                const valueLabel = document.createElement('div');
                valueLabel.style.position = 'absolute';
                valueLabel.style.bottom = barHeight + 12 + 'px';
                valueLabel.style.left = 24 + index * barWidth + 'px';
                valueLabel.style.width = barWidth - 12 + 'px';
                valueLabel.style.textAlign = 'center';
                valueLabel.style.fontSize = '12px';
                valueLabel.style.color = 'var(--ooder-dark)';
                valueLabel.style.fontWeight = '600';
                valueLabel.textContent = category.count;
                chartContainer.appendChild(valueLabel);
            });
        }
        
        // ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ç»“æœ
        function generateTestResults() {
            const testResultsList = document.getElementById('test-results-list');
            testResultsList.innerHTML = '';
            
            // æ¨¡æ‹Ÿæµ‹è¯•ç”¨ä¾‹ç»“æœ
            const testCases = [
                { name: 'MCPæ³¨å†Œå‘½ä»¤å¤„ç†', status: 'passed', message: 'æ³¨å†Œå‘½ä»¤å¤„ç†æˆåŠŸ' },
                { name: 'MCPæ³¨é”€å‘½ä»¤å¤„ç†', status: 'passed', message: 'æ³¨é”€å‘½ä»¤å¤„ç†æˆåŠŸ' },
                { name: 'MCPå¿ƒè·³å‘½ä»¤å¤„ç†', status: 'passed', message: 'å¿ƒè·³å‘½ä»¤å¤„ç†æˆåŠŸ' },
                { name: 'MCPçŠ¶æ€æŸ¥è¯¢å¤„ç†', status: 'passed', message: 'çŠ¶æ€æŸ¥è¯¢å¤„ç†æˆåŠŸ' },
                { name: 'MCPå‘ç°å‘½ä»¤å¤„ç†', status: 'passed', message: 'å‘ç°å‘½ä»¤å¤„ç†æˆåŠŸ' },
                { name: 'MCPè·¯ç”±æŸ¥è¯¢å¤„ç†', status: 'passed', message: 'è·¯ç”±æŸ¥è¯¢å¤„ç†æˆåŠŸ' },
                { name: 'MCPè®¤è¯å‘½ä»¤å¤„ç†', status: 'failed', message: 'è®¤è¯å‘½ä»¤å¤„ç†å¤±è´¥ï¼šç¼ºå°‘è®¤è¯å‚æ•°' },
                { name: 'MCPç«¯å£å¼€æ”¾æµ‹è¯•', status: 'passed', message: 'ç«¯å£å¼€æ”¾æµ‹è¯•æˆåŠŸ' },
                { name: 'MCPç½‘ç»œé“¾è·¯æµ‹è¯•', status: 'failed', message: 'ç½‘ç»œé“¾è·¯æµ‹è¯•å¤±è´¥ï¼šé“¾è·¯å»ºç«‹è¶…æ—¶' },
                { name: 'MCPç³»ç»ŸçŠ¶æ€æµ‹è¯•', status: 'passed', message: 'ç³»ç»ŸçŠ¶æ€æµ‹è¯•æˆåŠŸ' }
            ];
            
            // æ·»åŠ æµ‹è¯•ç”¨ä¾‹ç»“æœ
            testCases.forEach(testCase => {
                const testElement = document.createElement('div');
                testElement.className = `test-case ${testCase.status}`;
                testElement.innerHTML = `
                    <div class="test-name">${testCase.name}</div>
                    <div class="test-message">${testCase.message}</div>
                `;
                testResultsList.appendChild(testElement);
            });
            
            // æ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹ï¼ˆæ¨¡æ‹Ÿ118ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
            for (let i = 11; i <= 118; i++) {
                const status = i <= 115 ? 'passed' : 'failed';
                const testElement = document.createElement('div');
                testElement.className = `test-case ${status}`;
                testElement.innerHTML = `
                    <div class="test-name">æµ‹è¯•ç”¨ä¾‹ ${i}</div>
                    <div class="test-message">${status === 'passed' ? 'æµ‹è¯•é€šè¿‡' : 'æµ‹è¯•å¤±è´¥'}</div>
                `;
                testResultsList.appendChild(testElement);
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>